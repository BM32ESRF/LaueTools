

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>LaueTools.GUI.PeakSearchGUI &mdash; LaueTools  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> LaueTools
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getStarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../GUIs.html">Graphical User Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../LaueToolsModules.html">LaueTools Modules</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">LaueTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>LaueTools.GUI.PeakSearchGUI</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for LaueTools.GUI.PeakSearchGUI</h1><div class="highlight"><pre>
<span></span><span class="c1"># --- ------------  IMAGE VIEWER and PEAK SEARCH Tools GUI</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">wx</span>

<span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&lt;</span> <span class="s2">&quot;4.&quot;</span><span class="p">:</span>
    <span class="n">WXPYTHON4</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">WXPYTHON4</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">wx</span><span class="o">.</span><span class="n">OPEN</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FD_OPEN</span>

    <span class="k">def</span> <span class="nf">sttip</span><span class="p">(</span><span class="n">argself</span><span class="p">,</span> <span class="n">strtip</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">wx</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span><span class="n">argself</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ToolTip</span><span class="p">(</span><span class="n">strtip</span><span class="p">))</span>

    <span class="n">wx</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">SetToolTipString</span> <span class="o">=</span> <span class="n">sttip</span>

<span class="kn">from</span> <span class="nn">pylab</span> <span class="k">import</span> <span class="n">cm</span> <span class="k">as</span> <span class="n">pcm</span>
<span class="kn">from</span> <span class="nn">pylab</span> <span class="k">import</span> <span class="n">Rectangle</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="k">import</span> <span class="n">LogNorm</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="k">import</span> <span class="n">Circle</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="k">import</span> <span class="n">Rectangle</span> <span class="k">as</span> <span class="n">PatchRectangle</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">FuncFormatter</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="k">import</span> <span class="n">Figure</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_wxagg</span> <span class="k">import</span> <span class="p">(</span><span class="n">FigureCanvasWxAgg</span> <span class="k">as</span> <span class="n">FigCanvas</span><span class="p">,</span>
                                                <span class="n">NavigationToolbar2WxAgg</span> <span class="k">as</span> <span class="n">NavigationToolbar</span><span class="p">)</span>

<span class="n">WXPYTHON3</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&gt;=</span> <span class="s2">&quot;3.0.0&quot;</span><span class="p">:</span>
    <span class="n">WXPYTHON3</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="k">import</span> <span class="n">RectangleSelector</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">ObjectListView</span> <span class="k">import</span> <span class="n">ObjectListView</span><span class="p">,</span> <span class="n">ColumnDefn</span> <span class="c1">#, GroupListView</span>

    <span class="n">ObjectListView_Present</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ObjectListView not found. You may like to install it ?&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;unzip ObjectListView-1.2.zip in lauetools/trunk&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;or download it at:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;http://objectlistview.sourceforge.net/samples/ObjectListView-1.2.zip&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;from the website:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;https://pypi.python.org/pypi/ObjectListView&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;and type (linux): (sudo) python setup.py install&quot;</span><span class="p">)</span>
    <span class="n">ObjectListView_Present</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># LaueTools modules</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">dragpoints</span> <span class="k">as</span> <span class="n">DGP</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">mosaic</span> <span class="k">as</span> <span class="n">MOS</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">SpotModel</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">dict_LaueTools</span> <span class="k">as</span> <span class="n">DictLT</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">readmccd</span> <span class="k">as</span> <span class="n">RMCCD</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">fit2Dintensity</span> <span class="k">as</span> <span class="n">fit2d</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">LaueGeometry</span> <span class="k">as</span> <span class="n">F2TC</span>
    <span class="c1"># from . import peaklistfit2d as plf2d</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Plot1DFrame</span> <span class="k">as</span> <span class="n">PLOT1D</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">HistogramPlot</span> <span class="k">as</span> <span class="n">HISTOPLOT</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">ImshowFrame</span> <span class="k">as</span> <span class="n">IMSHOW</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">generaltools</span> <span class="k">as</span> <span class="n">GT</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">CCDFileParametersGUI</span> <span class="k">as</span> <span class="n">CCDParamGUI</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">IOLaueTools</span> <span class="k">as</span> <span class="n">IOLT</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">PeaksListBoard</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">IOimagefile</span> <span class="k">as</span> <span class="n">IOimage</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">imageprocessing</span> <span class="k">as</span> <span class="n">ImProc</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">dragpoints</span> <span class="k">as</span> <span class="nn">DGP</span>
    <span class="kn">import</span> <span class="nn">GUI.mosaic</span> <span class="k">as</span> <span class="nn">MOS</span>
    <span class="kn">import</span> <span class="nn">SpotModel</span>
    <span class="kn">import</span> <span class="nn">dict_LaueTools</span> <span class="k">as</span> <span class="nn">DictLT</span>
    <span class="kn">import</span> <span class="nn">readmccd</span> <span class="k">as</span> <span class="nn">RMCCD</span>
    <span class="kn">import</span> <span class="nn">fit2Dintensity</span> <span class="k">as</span> <span class="nn">fit2d</span>
    <span class="kn">import</span> <span class="nn">LaueGeometry</span> <span class="k">as</span> <span class="nn">F2TC</span>
    <span class="c1"># import peaklistfit2d as plf2d</span>
    <span class="kn">import</span> <span class="nn">GUI.Plot1DFrame</span> <span class="k">as</span> <span class="nn">PLOT1D</span>
    <span class="kn">import</span> <span class="nn">GUI.HistogramPlot</span> <span class="k">as</span> <span class="nn">HISTOPLOT</span>
    <span class="kn">import</span> <span class="nn">GUI.ImshowFrame</span> <span class="k">as</span> <span class="nn">IMSHOW</span>
    <span class="kn">import</span> <span class="nn">generaltools</span> <span class="k">as</span> <span class="nn">GT</span>
    <span class="kn">import</span> <span class="nn">GUI.CCDFileParametersGUI</span> <span class="k">as</span> <span class="nn">CCDParamGUI</span>
    <span class="kn">import</span> <span class="nn">IOLaueTools</span> <span class="k">as</span> <span class="nn">IOLT</span>
    <span class="kn">import</span> <span class="nn">GUI.PeaksListBoard</span>
    <span class="kn">import</span> <span class="nn">IOimagefile</span> <span class="k">as</span> <span class="nn">IOimage</span>
    <span class="kn">import</span> <span class="nn">imageprocessing</span> <span class="k">as</span> <span class="nn">ImProc</span>

<span class="n">LaueToolsProjectFolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LaueToolsProjectFolder&quot;</span><span class="p">,</span> <span class="n">LaueToolsProjectFolder</span><span class="p">)</span>


<div class="viewcode-block" id="ViewColorPanel"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ViewColorPanel">[docs]</a><span class="k">class</span> <span class="nc">ViewColorPanel</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;class to play with color LUT and intensity scale</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>  <span class="c1"># layout2()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexcirclespatchlist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DetFilename</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># widgets</span>
        <span class="n">luttxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;LUT&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboLUT</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">LastLUT</span><span class="p">,</span> <span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                                    <span class="n">choices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">mapsLUT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">comboLUT</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnChangeLUT</span><span class="p">)</span>

        <span class="n">posv</span> <span class="o">=</span> <span class="mi">40</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">slider_label</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Imin: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vminctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">vmin</span><span class="p">),</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">posv</span><span class="p">),</span>
                                                                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                                        <span class="nb">min</span><span class="o">=-</span><span class="mi">200</span><span class="p">,</span>
                                                                        <span class="nb">max</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vminctrl</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SPINCTRL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnSpinCtrl_IminDisplayed</span><span class="p">)</span>

        <span class="c1"># second horizontal band</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_label2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Imax: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">35</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vmaxctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">vmaxmax</span><span class="p">),</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">30</span><span class="p">),</span>
                                                            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmaxctrl</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SPINCTRL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnSpinCtrl_ImaxDisplayed</span><span class="p">)</span>

        <span class="c1">#         self.slider_label = wx.StaticText(self, -1,</span>
        <span class="c1">#             &quot;peak tilt (%): &quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmin</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">5</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                            <span class="n">value</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">vmin</span><span class="p">),</span>
                            <span class="n">minValue</span><span class="o">=-</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">vminmax</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">vmin</span><span class="p">),</span>
                            <span class="n">maxValue</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">vminmax</span><span class="p">),</span>
                            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SL_AUTOTICKS</span><span class="p">)</span>  <span class="c1"># | wx.SL_LABELS)</span>
        <span class="k">if</span> <span class="n">WXPYTHON4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmin</span><span class="o">.</span><span class="n">SetTickFreq</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmin</span><span class="o">.</span><span class="n">SetTickFreq</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmin</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMMAND_SCROLL_THUMBTRACK</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">on_slider_IminDisplayed</span><span class="p">)</span>

        <span class="c1"># second horizontal band</span>
        <span class="c1">#         self.slider_label2 = wx.StaticText(self, -1,</span>
        <span class="c1">#             &quot;data size (%): &quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmax</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">35</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                        <span class="n">value</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">vmax</span><span class="p">),</span>
                                                        <span class="n">minValue</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">vmin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                                        <span class="n">maxValue</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">vmaxmax</span><span class="p">),</span>
                                                        <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SL_AUTOTICKS</span><span class="p">)</span>  <span class="c1"># | wx.SL_LABELS)</span>
        <span class="k">if</span> <span class="n">WXPYTHON4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmax</span><span class="o">.</span><span class="n">SetTickFreq</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmax</span><span class="o">.</span><span class="n">SetTickFreq</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmax</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMMAND_SCROLL_THUMBTRACK</span><span class="p">,</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">on_slider_ImaxDisplayed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Iminvaltxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">vmin</span><span class="p">),</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Imaxvaltxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">vmax</span><span class="p">),</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">35</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lineXYprofilechck</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Enable X Y profiler&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">60</span><span class="p">))</span>
        <span class="n">InitStateXYProfile</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineXYprofilechck</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">InitStateXYProfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineXYprofilechck</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnTogglelineXYprofiles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span> <span class="o">=</span> <span class="n">InitStateXYProfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span> <span class="o">=</span> <span class="n">InitStateXYProfile</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lineprof_btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Open LineProfiler&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">60</span><span class="p">),</span> <span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineprof_btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnShowLineProfiler</span><span class="p">)</span>

        <span class="n">savefig_btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;SaveFig&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">savefig_btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnSaveFigure</span><span class="p">)</span>

        <span class="n">replot_btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Replot&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">replot_btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnReplot</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show2thetachi</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Show 2theta Chi&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">100</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detfiletxtctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opendetfilebtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">100</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show2thetachi</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opendetfilebtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onOpenDetFile</span><span class="p">)</span>

        <span class="n">showhisto_btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Intensity Distribution&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">260</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">showhisto_btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ShowHisto</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y2</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">1800</span><span class="p">,</span> <span class="mi">1800</span>

        <span class="c1"># tooltip</span>
        <span class="n">tp1</span> <span class="o">=</span> <span class="s2">&quot;selection of various intensity mapping color Looking_up table (LUT)&quot;</span>

        <span class="n">luttxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;selection of various intensity mappingcolor Looking_up table (LUT)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboLUT</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp1</span><span class="p">)</span>

        <span class="n">showhisto_btn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Show histogram of pixel intensity distribution of raw image&quot;</span><span class="p">)</span>

        <span class="n">tp2</span> <span class="o">=</span> <span class="s2">&quot;Coarse color scale intensity: min and max&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">slider_label</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vminctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_label2</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmaxctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp2</span><span class="p">)</span>

        <span class="n">tp3</span> <span class="o">=</span> <span class="s2">&quot;fine color scale intensity minimum&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmin</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp3</span><span class="p">)</span>
        <span class="n">tp4</span> <span class="o">=</span> <span class="s2">&quot;fine color scale intensity maximum&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmax</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp4</span><span class="p">)</span>

        <span class="n">tpmin</span> <span class="o">=</span> <span class="s2">&quot;current color scale intensity minimum&quot;</span>
        <span class="n">tpmax</span> <span class="o">=</span> <span class="s2">&quot;current color scale intensity maximum&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Iminvaltxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpmin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Imaxvaltxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpmax</span><span class="p">)</span>

        <span class="n">savefig_btn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Save current plot figure in png format file&quot;</span><span class="p">)</span>

        <span class="n">replot_btn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Reset and replot displayed image in plot&quot;</span><span class="p">)</span>

        <span class="n">tiplineprof</span> <span class="o">=</span> <span class="s2">&quot;Open/Close Draggable Line Pixel intensity Profiler.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">tiplineprof</span> <span class="o">+=</span> <span class="s2">&quot;Press left mouse button to move line.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">tiplineprof</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;Press right mouse button to change line length (or, press + or -).</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lineprof_btn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tiplineprof</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lineXYprofilechck</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Open X and Y pixel intensity line cross sections&quot;</span><span class="p">)</span>
        <span class="n">tipst2</span> <span class="o">=</span> <span class="s2">&quot;Show in status bar the 2 scattering angles. It needs a calibration file .det&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show2thetachi</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tipst2</span><span class="p">)</span>

<div class="viewcode-block" id="ViewColorPanel.OnReplot"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ViewColorPanel.OnReplot">[docs]</a>    <span class="k">def</span> <span class="nf">OnReplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;trigger main self.mainframe.OnReplot(1)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnReplot</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">showprofiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updateLineProfile</span><span class="p">()</span>
        <span class="c1">#         print &#39;event update&#39;, event</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">backend_bases</span><span class="o">.</span><span class="n">MouseEvent</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OnShowLineXYProfiler</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnTogglelineXYprofiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">showprofiles</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getlineXYprofiledata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="c1"># warning of ymax and ymin swapping!</span>
        <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)]</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrictxylimits_to_imagearray</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

        <span class="c1">#         print &quot;xmin, xmax, ymin, ymax&quot;, xmin, xmax, ymin, ymax</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Extract the values along the line</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI</span>

        <span class="n">xyc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getclickposition</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xyc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span> <span class="o">=</span> <span class="n">xyc</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">zx</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yc</span><span class="p">)),</span> <span class="n">xmin</span> <span class="p">:</span> <span class="n">xmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">zy</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">ymin</span> <span class="p">:</span> <span class="n">ymax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">))]</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span>

<div class="viewcode-block" id="ViewColorPanel.getclickposition"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ViewColorPanel.getclickposition">[docs]</a>    <span class="k">def</span> <span class="nf">getclickposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return closest pixel integer coordinates to clicked pt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">backend_bases</span><span class="o">.</span><span class="n">MouseEvent</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span></div>

<div class="viewcode-block" id="ViewColorPanel.OnShowLineXYProfiler"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ViewColorPanel.OnShowLineXYProfiler">[docs]</a>    <span class="k">def</span> <span class="nf">OnShowLineXYProfiler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show line X and Y profilers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LINEPROFILE_WIDTH</span><span class="p">,</span> <span class="n">LINEPROFILE_HEIGHT</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">300</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.plotlineXprofile and self.plotlineYprofile == &quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span><span class="p">:</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>

                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlineXYprofiledata</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

                <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestposition</span><span class="p">(</span><span class="n">LINEPROFILE_WIDTH</span><span class="p">,</span> <span class="n">LINEPROFILE_HEIGHT</span><span class="p">)</span>

                <span class="c1"># -- Plot lineprofile...</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span> <span class="o">=</span> <span class="n">PLOT1D</span><span class="o">.</span><span class="n">Plot1DFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Intensity profile X&quot;</span><span class="p">,</span>
                                                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                                    <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">zx</span><span class="p">],</span>
                                                    <span class="n">logscale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                                                    <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                                    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">LINEPROFILE_WIDTH</span><span class="p">,</span> <span class="n">LINEPROFILE_HEIGHT</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">((</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span> <span class="o">=</span> <span class="n">PLOT1D</span><span class="o">.</span><span class="n">Plot1DFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Intensity profile Y&quot;</span><span class="p">,</span>
                                                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                                    <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">zy</span><span class="p">],</span>
                                                    <span class="n">logscale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                                                    <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                                    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">LINEPROFILE_WIDTH</span><span class="p">,</span> <span class="n">LINEPROFILE_HEIGHT</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">((</span><span class="n">xp</span> <span class="o">-</span> <span class="mi">200</span><span class="p">,</span> <span class="n">yp</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateLineXYProfile</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="ViewColorPanel.bestposition"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ViewColorPanel.bestposition">[docs]</a>    <span class="k">def</span> <span class="nf">bestposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">LINEPROFILE_WIDTH</span><span class="p">,</span> <span class="n">LINEPROFILE_HEIGHT</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return xp, yp (best position) &quot;&quot;&quot;</span>
        <span class="c1"># screen size</span>
        <span class="n">dws</span><span class="p">,</span> <span class="n">dhs</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">DisplaySize</span><span class="p">()</span>
        <span class="c1"># peaksearchframe size</span>
        <span class="n">wf</span><span class="p">,</span> <span class="n">hf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wf, hf&quot;</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">hf</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dws, dhs&quot;</span><span class="p">,</span> <span class="n">dws</span><span class="p">,</span> <span class="n">dhs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dws</span> <span class="o">&gt;</span> <span class="n">wf</span><span class="p">:</span>
            <span class="n">Xwindow</span> <span class="o">=</span> <span class="n">dws</span> <span class="o">-</span> <span class="n">LINEPROFILE_WIDTH</span>
        <span class="k">if</span> <span class="n">dhs</span> <span class="o">&gt;</span> <span class="n">hf</span><span class="p">:</span>
            <span class="n">Ywindow</span> <span class="o">=</span> <span class="n">dhs</span> <span class="o">-</span> <span class="n">LINEPROFILE_HEIGHT</span>

        <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Xwindow</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">Ywindow</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xp,yp&quot;</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span></div>

<div class="viewcode-block" id="ViewColorPanel.restrictxylimits_to_imagearray"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ViewColorPanel.restrictxylimits_to_imagearray">[docs]</a>    <span class="k">def</span> <span class="nf">restrictxylimits_to_imagearray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return compatible extremal value of x,y</span>
<span class="sd">        xmin, ymin, xmax, ymax</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">framedim</span>

        <span class="n">xmin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymin</span><span class="p">)</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymax</span><span class="p">,</span> <span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span></div>

<div class="viewcode-block" id="ViewColorPanel.getlineprofiledata"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ViewColorPanel.getlineprofiledata">[docs]</a>    <span class="k">def</span> <span class="nf">getlineprofiledata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get pixel intensities array between two points (x0,y0) and (x2,y2)</span>

<span class="sd">        return dataX, dataY</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrictxylimits_to_imagearray</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

        <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y0</span><span class="p">))</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">+</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">+</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">length</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Extract the values along the line</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI</span>

        <span class="c1"># transpose data</span>
        <span class="n">i_ind</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
        <span class="n">j_ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>

        <span class="n">zi</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">i_ind</span><span class="p">,</span> <span class="n">j_ind</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">x0</span> <span class="o">!=</span> <span class="n">x2</span><span class="p">:</span>
            <span class="n">signabscissa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signabscissa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>

        <span class="n">dataX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">signabscissa</span>
        <span class="n">dataY</span> <span class="o">=</span> <span class="n">zi</span>

        <span class="k">return</span> <span class="n">dataX</span><span class="p">,</span> <span class="n">dataY</span></div>

<div class="viewcode-block" id="ViewColorPanel.OnShowLineProfiler"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ViewColorPanel.OnShowLineProfiler">[docs]</a>    <span class="k">def</span> <span class="nf">OnShowLineProfiler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        show a movable and draggable line profiler and draw line and circle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineXYprofilechck</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lineprof_btn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Close LineProfiler&quot;</span><span class="p">)</span>

            <span class="c1"># -- Plot lineprofile...</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">zi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlineprofiledata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y2</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span> <span class="o">=</span> <span class="n">PLOT1D</span><span class="o">.</span><span class="n">Plot1DFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Intensity profile&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                                            <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">zi</span><span class="p">],</span> <span class="n">logscale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># plot line on canvas (CCD image)</span>

            <span class="n">pt1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">]</span>
            <span class="n">pt2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y2</span><span class="p">]</span>
            <span class="n">ptcenter</span> <span class="o">=</span> <span class="n">DGP</span><span class="o">.</span><span class="n">center_pts</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>

            <span class="n">circles</span> <span class="o">=</span> <span class="p">[</span><span class="n">Circle</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
                        <span class="n">Circle</span><span class="p">(</span><span class="n">ptcenter</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
                        <span class="n">Circle</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)]</span>

            <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ptcenter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                            <span class="p">[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ptcenter</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                            <span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="n">c</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexcirclespatchlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">init_patches_nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">patches</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">circ</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">circles</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indexcirclespatchlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init_patches_nb</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
            <span class="c1">#             print &quot;building draggable line&quot;</span>
            <span class="c1">#             print &quot;peak search canvas&quot;, self.mainframe.canvas</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drg</span> <span class="o">=</span> <span class="n">DGP</span><span class="o">.</span><span class="n">DraggableLine</span><span class="p">(</span><span class="n">circles</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="p">,</span>
                                            <span class="n">framedim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">framedim</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;pixels&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2047</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">2047</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineprof_btn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Open LineProfiler&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">drg</span><span class="o">.</span><span class="n">connectingline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># empty line</span>

            <span class="c1"># warning patches list can contain circle marker from peak search</span>
            <span class="c1">#             print &quot;self.mainframe.axes.patches&quot;, self.mainframe.axes.patches</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexcirclespatchlist</span><span class="p">)):</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indexcirclespatchlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">framedim</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drg</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ViewColorPanel.updateLineXYProfile"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ViewColorPanel.updateLineXYProfile">[docs]</a>    <span class="k">def</span> <span class="nf">updateLineXYProfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;recompute line section intensity profile</span>
<span class="sd">        horizontal (x, zx)</span>
<span class="sd">        vertical (y, zy)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlineXYprofiledata</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zx</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zy</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STRANGE&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">xyc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getclickposition</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xyc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span> <span class="o">=</span> <span class="n">xyc</span>

            <span class="n">lineXprofileframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span>

            <span class="n">lineXprofileframe</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">zx</span><span class="p">)</span>
            <span class="n">lineXprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">@y=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span><span class="p">))</span>
            <span class="n">lineXprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
            <span class="n">lineXprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">lineXprofileframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlineXYprofiledata</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zx</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zy</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STRANGE&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">xyc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getclickposition</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xyc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span> <span class="o">=</span> <span class="n">xyc</span>

            <span class="n">lineYprofileframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span>

            <span class="n">lineYprofileframe</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">zy</span><span class="p">)</span>
            <span class="n">lineYprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">@x=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">))</span>
            <span class="n">lineYprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
            <span class="n">lineYprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">lineYprofileframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">updateLineProfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># print(&quot;updateLineProfile&quot;)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">x</span><span class="p">,</span> <span class="n">zi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlineprofiledata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y2</span><span class="p">)</span>
            <span class="c1"># print(&quot;x&quot;, x)</span>
            <span class="c1"># print(&quot;xmin=&quot;, min(x))</span>
            <span class="c1"># print(&quot;xmax=&quot;, max(x))</span>
            <span class="c1"># print(&quot;Imin=&quot;, min(zi))</span>
            <span class="c1"># print(&quot;Imax=&quot;, max(zi))</span>
            <span class="n">lineprofileframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span>

            <span class="n">lineprofileframe</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">zi</span><span class="p">)</span>
            <span class="n">lineprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">line [</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">]-[</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">]&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y2</span><span class="p">))</span>
            <span class="n">lineprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
            <span class="n">lineprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">lineprofileframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

<div class="viewcode-block" id="ViewColorPanel.onOpenDetFile"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ViewColorPanel.onOpenDetFile">[docs]</a>    <span class="k">def</span> <span class="nf">onOpenDetFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;open and read .det file with geometry detection calibration parameters</span>

<span class="sd">        set self.DetFilename</span>
<span class="sd">        set self.mainframe.DetFilename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;onOpenDetFile&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ReadDetFile</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DetFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">DetFilename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detfiletxtctrl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DetFilename</span><span class="p">)</span></div>

<div class="viewcode-block" id="ViewColorPanel.showImage"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ViewColorPanel.showImage">[docs]</a>    <span class="k">def</span> <span class="nf">showImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        branching from button of ViewColorPanel class: show blur/raw image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;entering showImage() of ViewColorPanel class with Imagetype </span><span class="si">%s</span><span class="s2">&quot;</span>
                                                <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">ImageType</span><span class="p">)</span>

        <span class="c1"># display raw after having displayed blur image</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">ImageType</span> <span class="o">==</span> <span class="s2">&quot;Blur&quot;</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">ShowblurImagebtn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Show Raw Image&quot;</span><span class="p">)</span>
            <span class="c1"># if auto_backgroiund image is already there</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">blurimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">blurimage</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">Show_Image</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;Blur Image&quot;</span><span class="p">)</span>
            <span class="c1"># if auto_backgroiund image is missing, compute it!</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">onComputeBlurImage</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># display blur after having displayed raw image</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">ImageType</span> <span class="o">==</span> <span class="s2">&quot;Raw&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">ShowblurImagebtn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Show Blur Image&quot;</span><span class="p">)</span>
            <span class="c1"># if substract blur as bck is checked</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">FilterImage</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">filteredimage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">Computefilteredimage</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">filteredimage</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">Show_Image</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;Raw Image - Background&quot;</span><span class="p">)</span>
            <span class="c1"># raw image</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">Show_Image</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;Raw Image&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FilterBackGroundPanel"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.FilterBackGroundPanel">[docs]</a><span class="k">class</span> <span class="nc">FilterBackGroundPanel</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;class to handle image background tools</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>  <span class="c1"># layout2()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">BImageFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">BImageFilename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BlackListedPeaks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BlackListFilename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blurimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filteredimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">KERNELSIZE</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageType_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageTypes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Raw&quot;</span><span class="p">,</span> <span class="s2">&quot;Blur&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageTypes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ImageType_index</span><span class="p">]</span>

        <span class="c1"># print(&quot;mainframe of FilterBackGroundPanel&quot;, self.mainframe)</span>
        <span class="c1"># widgets -------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ComputeBlurredImage</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Blur Image&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ShowblurImagebtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Show Blur Image&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SaveBlurredImage</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Save Blur Image&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">FilterImage</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Substract blur as background&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">35</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">FilterImage</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnSwitchFilterRawImage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FilterImage</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ComputeBlurredImage</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onComputeBlurImage</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ShowblurImagebtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOGGLEBUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnSwitchBlurRawImage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SaveBlurredImage</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onSaveBlurImage</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">UseImage</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Update A = f(A,B) &quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bequal</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;B = &quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageBctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">BImageFilename</span><span class="p">,</span> <span class="p">(</span><span class="mi">55</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span> <span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openImagebtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">290</span><span class="p">,</span> <span class="mi">88</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UseImage</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openImagebtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onGetBImagefilename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UseImage</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnChangeUseFormula</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">usealsoforfit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;use also for fit&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">270</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usealsoforfit</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;in formula (A: current image)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">125</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formulatxtctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;A-1.1*B&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span> <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">btnsaveformularesult</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Save result&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">120</span><span class="p">))</span>
        <span class="n">btnsaveformularesult</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onSaveFormulaResultImage</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveBlackpeaks</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Remove BlackListed Peaks&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">150</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BlackListtoltxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Max. Distance&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">152</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BlackListRejection_pixeldistanceMax</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;15&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
                                                                <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BlackListedPeaks</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openBlackListFile</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">265</span><span class="p">,</span> <span class="mi">180</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveBlackpeaks</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openBlackListFile</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onGetBlackListfilename</span><span class="p">)</span>

        <span class="c1"># tooltip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveBlackpeaks</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Peaks from current PeakSearch belonging to the &quot;</span>
                                                            <span class="s2">&quot;blackList will be removed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ShowblurImagebtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Toggle button to show either blurred or raw image&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ComputeBlurredImage</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Apply a blur filter to the raw image&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UseImage</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Compute a new image according to the formula with A and B &quot;</span>
                                                            <span class="s2">&quot;resp. the raw and other input image &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openBlackListFile</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Browse a File containing a list of blacklisted peaks&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openImagebtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Browse a image File as B (with the same format of &quot;</span>
                                                                                <span class="s2">&quot;the raw image A)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageBctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Current B image path&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BlackListedPeaks</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Current blacklisted peaks File path&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">FilterImage</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;set raw image = raw image - blur image)&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">usealsoforfit</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Use resulting image to refine peak position and shape&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">formulatxtctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Mathematical expression to compute a new A as f(A,B) &quot;</span>
                        <span class="s2">&quot;for local Maxima search</span><span class="se">\n</span><span class="s2">(to have initial peak position guesses for fit)&quot;</span><span class="p">)</span>
        <span class="n">btnsaveformularesult</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Save current image (resulting from mathematical &quot;</span>
                                                                <span class="s2">&quot;operation according to formula)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SaveBlurredImage</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Save blur image.&quot;</span><span class="p">)</span>

        <span class="n">tpbl</span> <span class="o">=</span> <span class="s2">&quot;Maximum pixel distance between peaks in blacklisted peaks list and current peaks &quot;</span>
        <span class="s2">&quot;(found by peak search) to be rejected&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BlackListtoltxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpbl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BlackListRejection_pixeldistanceMax</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpbl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnSwitchFilterRawImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageType</span> <span class="o">!=</span> <span class="s2">&quot;Raw&quot;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blurimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">showImage</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;You need to compute first a blur image!&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="FilterBackGroundPanel.Computefilteredimage"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.FilterBackGroundPanel.Computefilteredimage">[docs]</a>    <span class="k">def</span> <span class="nf">Computefilteredimage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        remove background if self.blurimage exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blurimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ok, I have got self.blurimage&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing self.filteredimage&quot;</span><span class="p">)</span>
            <span class="n">CCDlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">CCDlabel</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">filteredimage</span> <span class="o">=</span> <span class="n">ImProc</span><span class="o">.</span><span class="n">computefilteredimage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">,</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">blurimage</span><span class="p">,</span> <span class="n">CCDlabel</span><span class="p">,</span> <span class="n">kernelsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.blurimage is None !!&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilterBackGroundPanel.onComputeBlurImage"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.FilterBackGroundPanel.onComputeBlurImage">[docs]</a>    <span class="k">def</span> <span class="nf">onComputeBlurImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Compute background, blurred, filtered or low frequency spatial image</span>
<span class="sd">        from current image</span>

<span class="sd">        set self.blurimage</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blurimage</span> <span class="o">=</span> <span class="n">ImProc</span><span class="o">.</span><span class="n">compute_autobackground_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">,</span>
                                                                                <span class="n">boxsizefilter</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.blurimage.shape&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blurimage</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blurimage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Binning and Image dimensions are not compatible&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">showImage</span><span class="p">()</span></div>

<div class="viewcode-block" id="FilterBackGroundPanel.OnSwitchBlurRawImage"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.FilterBackGroundPanel.OnSwitchBlurRawImage">[docs]</a>    <span class="k">def</span> <span class="nf">OnSwitchBlurRawImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set viewing of raw image (- background) or background (=filtered image)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageType_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageType_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageType_index</span> <span class="o">%</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageTypes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ImageType_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">showImage</span><span class="p">()</span></div>

<div class="viewcode-block" id="FilterBackGroundPanel.onSaveBlurImage"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.FilterBackGroundPanel.onSaveBlurImage">[docs]</a>    <span class="k">def</span> <span class="nf">onSaveBlurImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;save on hard disk blurred or background image obtained from current image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">imagefilename</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dirname</span>
        <span class="n">OUTPUTFILENAME_BLURIMAGE</span> <span class="o">=</span> <span class="s2">&quot;blur_&quot;</span> <span class="o">+</span> <span class="n">filename</span>

        <span class="n">_header</span> <span class="o">=</span> <span class="n">IOimage</span><span class="o">.</span><span class="n">readheader</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>

        <span class="n">fullpathname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">OUTPUTFILENAME_BLURIMAGE</span><span class="p">)</span>

        <span class="n">RMCCD</span><span class="o">.</span><span class="n">writeimage</span><span class="p">(</span><span class="n">fullpathname</span><span class="p">,</span> <span class="n">_header</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blurimage</span><span class="p">))</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Blurred Image written in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fullpathname</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilterBackGroundPanel.onSaveFormulaResultImage"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.FilterBackGroundPanel.onSaveFormulaResultImage">[docs]</a>    <span class="k">def</span> <span class="nf">onSaveFormulaResultImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;save image on hard disk of data obtained by arithmetical formula</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">imagefilename</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dirname</span>
        <span class="n">OUTPUTFILENAME_RESULTIMAGE</span> <span class="o">=</span> <span class="s2">&quot;result_&quot;</span> <span class="o">+</span> <span class="n">filename</span>

        <span class="n">CCDlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">CCDlabel</span>

        <span class="n">_header</span> <span class="o">=</span> <span class="n">IOimage</span><span class="o">.</span><span class="n">readheader</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">CCDLabel</span><span class="o">=</span><span class="n">CCDlabel</span><span class="p">)</span>

        <span class="n">fullpathname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">OUTPUTFILENAME_RESULTIMAGE</span><span class="p">)</span>

        <span class="n">RMCCD</span><span class="o">.</span><span class="n">writeimage</span><span class="p">(</span><span class="n">fullpathname</span><span class="p">,</span> <span class="n">_header</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span><span class="p">))</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Blurred Image written in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fullpathname</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilterBackGroundPanel.onGetBImagefilename"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.FilterBackGroundPanel.onGetBImagefilename">[docs]</a>    <span class="k">def</span> <span class="nf">onGetBImagefilename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;open image as B image</span>
<span class="sd">        set self.BImageFilename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">onOpenBImage</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BImageFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">BImageFilename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageBctrl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">BImageFilename</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilterBackGroundPanel.onGetBlackListfilename"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.FilterBackGroundPanel.onGetBlackListfilename">[docs]</a>    <span class="k">def</span> <span class="nf">onGetBlackListfilename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; open black peakslist file</span>
<span class="sd">        set self.BlackListFilename</span>
<span class="sd">        set self.mainframe.BlackListFilename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">onOpenBlackListFile</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BlackListFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">BlackListFilename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BlackListedPeaks</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BlackListFilename</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilterBackGroundPanel.OnChangeUseFormula"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.FilterBackGroundPanel.OnChangeUseFormula">[docs]</a>    <span class="k">def</span> <span class="nf">OnChangeUseFormula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;change arithmetical formula</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OnChangeUseFormula&quot;</span><span class="p">)</span>
        <span class="c1"># use image and formula</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">UseImage</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">BImageFilename</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnUseFormula</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new value for image (dataimage_ROI_display)&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ConvolvedData</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;missing image B to used in formula! Select one, please!&quot;</span><span class="p">,</span> <span class="s2">&quot;Error&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UseImage</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># not use image and formula</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">page3</span><span class="o">.</span><span class="n">TogglebtnState</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># show convolved</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">Show_ConvolvedImage</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">page3</span><span class="o">.</span><span class="n">TogglebtnState</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># show raw image</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;show image&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">Show_Image</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="BrowseCropPanel"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.BrowseCropPanel">[docs]</a><span class="k">class</span> <span class="nc">BrowseCropPanel</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;class to handle crop operation on images&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;init&quot;&quot;&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>  <span class="c1"># layout2()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">startimageindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">imageindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageindexmax</span> <span class="o">=</span> <span class="mi">1000</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;startimageindex&#39;</span><span class="p">,</span> <span class="n">startimageindex</span><span class="p">)</span>

        <span class="n">inivalX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">startimageindex</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span><span class="p">)</span>
        <span class="n">inivalY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">startimageindex</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span><span class="p">)</span>
        <span class="c1"># print(&quot;inivalX&quot;, inivalX)</span>
        <span class="c1"># print(&quot;inivalY&quot;, inivalY)</span>

        <span class="c1"># widgets -----------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggleBtnCrop</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;CropData&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggleBtnCrop</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">onToggleCrop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxsizetxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;boxsize:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxxtxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxxctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">3000</span><span class="p">)</span>
        <span class="c1">#        self.Bind(wx.EVT_SPINCTRL, self.OnBoxSizes, self.boxxctrl)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxytxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxyctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">3000</span><span class="p">)</span>
        <span class="c1">#        self.Bind(wx.EVT_SPINCTRL, self.OnBoxSizes, self.boxyctrl)</span>

        <span class="n">plusbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;index +1&quot;</span><span class="p">)</span>
        <span class="n">plusbtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnPlus</span><span class="p">)</span>
        <span class="n">minusbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;index -1&quot;</span><span class="p">)</span>
        <span class="n">minusbtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnMinus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TIMER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">update</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggleBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Auto index+1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggleBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">onToggle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stepctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepctrl</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SPINCTRL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnStepChange</span><span class="p">)</span>

        <span class="n">imagemintxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Min: &quot;</span><span class="p">)</span>
        <span class="n">imagemaxtxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Max: &quot;</span><span class="p">)</span>
        <span class="n">steptxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Nb images/line: &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imagemintxtctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imagemaxtxtctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageindexmax</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                                        <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imagemintxtctrl</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnChangeImageMin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imagemaxtxtctrl</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnChangeImageMax</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">slider_image</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="n">inivalX</span><span class="p">,</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                        <span class="n">maxValue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                        <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SL_AUTOTICKS</span><span class="p">)</span>  <span class="c1"># | wx.SL_LABELS)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">slider_imagevert</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="n">inivalY</span><span class="p">,</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">maxValue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">imageindexmax</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span><span class="p">,</span>
                        <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SL_AUTOTICKS</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">SL_VERTICAL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">SL_INVERSE</span><span class="p">)</span>  <span class="c1"># | wx.SL_LABELS)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">slider_image</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMMAND_SCROLL_THUMBTRACK</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">onChangeIndex_slider_image</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">slider_imagevert</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMMAND_SCROLL_THUMBTRACK</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">onChangeIndex_slider_imagevert</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">txtnbdigits</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;    Nb of digits</span><span class="se">\n</span><span class="s2">     in ImageFilename&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbdigitsctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">largeplusbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;index +</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">largeplusbtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnLargePlus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">largeminusbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;index -</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">largeminusbtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnLargeMinus</span><span class="p">)</span>

        <span class="n">gotobutton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Go to index&quot;</span><span class="p">)</span>
        <span class="n">gotobutton</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnGoto</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileindexctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">startimageindex</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileindexctrl</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnGoto</span><span class="p">)</span>

        <span class="n">imagepropstxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Image indices properties (2D map arrangement)&quot;</span><span class="p">)</span>
        <span class="n">font3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">MODERN</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span><span class="p">)</span>
        <span class="n">imagepropstxt</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font3</span><span class="p">)</span>

        <span class="c1"># layout ------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggleBtnCrop</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxsizetxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxxtxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxxctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxytxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxyctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">minusbtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">plusbtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;     &quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txtnbdigits</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">largeminusbtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">largeplusbtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;         &quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbdigitsctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">gotobutton</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileindexctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;     &quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggleBtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer4</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer4</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">imagemintxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer4</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagemintxtctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer4</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">steptxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer4</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stepctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer4</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">imagemaxtxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer4</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagemaxtxtctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">vbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">imagepropstxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_image</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="n">vboxslider</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">vboxslider</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_imagevert</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="n">hhbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">hhbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">hhbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vboxslider</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">hhbox</span><span class="p">)</span>

        <span class="c1"># tooltips -----------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggleBtnCrop</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Enable/disable crop of image according to a &quot;</span>
        <span class="s2">&quot;Region of interest centered on pixel clicked by user with size defined by boxsize&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxsizetxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;X and Y pixel HALF size of the box for cropping image&quot;</span><span class="p">)</span>

        <span class="n">tpx</span> <span class="o">=</span> <span class="s2">&quot;Half Size of the crop box in X direction&quot;</span>
        <span class="n">tpy</span> <span class="o">=</span> <span class="s2">&quot;Half Size of the crop box in Y direction&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxxtxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxxctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boxytxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxyctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpy</span><span class="p">)</span>

        <span class="n">plusbtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Increase image filename by 1. In a raster or line scan it &quot;</span>
        <span class="s2">&quot;enables to display to the next image&quot;</span><span class="p">)</span>
        <span class="n">minusbtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Decrease image filename by 1. In a raster or line scan it &quot;</span>
        <span class="s2">&quot;enables to display to the previous image&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">largeplusbtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s1">&#39;Increase image filename by &quot;step index&quot;. &#39;</span>
        <span class="s1">&#39;If &quot;step index&quot; is the number of images per line in a raster scan, it enables to display &#39;</span>
        <span class="s1">&#39;the image directly belonging to next line&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">largeplusbtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span>
            <span class="s1">&#39;Decrease image filename by &quot;step index&quot;. If &quot;step index&quot; is the number of images per &#39;</span>
            <span class="s1">&#39;line in a raster scan, it enables to display the image directly &#39;</span>
            <span class="s1">&#39;belonging to previous line&#39;</span><span class="p">)</span>

        <span class="n">gotobutton</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Display image with corresponding index&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileindexctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Filename index of the image to display&quot;</span><span class="p">)</span>

        <span class="n">tpstep</span> <span class="o">=</span> <span class="s2">&quot;Number of images per line for a raster scan (step index) enabling to display &quot;</span>
        <span class="s2">&quot;images collected just above or below the sample position of the current &quot;</span>
        <span class="s2">&quot;image.(If the number is enrered, press enter to update the buttons label).&quot;</span>
        <span class="n">steptxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpstep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpstep</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toggleBtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Display automatically the next image with filename &quot;</span>
        <span class="s2">&quot;index +1 and keep waiting for the image&quot;</span><span class="p">)</span>

        <span class="n">tpnbdigits</span> <span class="o">=</span> <span class="s2">&quot;Image index is encoded in four digits with zero pads. Set to 4 as default. &quot;</span>
        <span class="s2">&quot;Set to None if image index exceeds 9999. Image filename should contain a &quot;</span>
        <span class="s2">&quot;single _ character, e.g. myimage_1234.tif&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txtnbdigits</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpnbdigits</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbdigitsctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpnbdigits</span><span class="p">)</span></div>


<div class="viewcode-block" id="MosaicAndMonitor"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MosaicAndMonitor">[docs]</a><span class="k">class</span> <span class="nc">MosaicAndMonitor</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict_ROI</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;None&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cselected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mosaic&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_windows</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>  <span class="c1"># layout2()</span>

        <span class="n">font3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">MODERN</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span><span class="p">)</span>

        <span class="n">txt1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Image pixel ROI selection&quot;</span><span class="p">)</span>
        <span class="n">txt1</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boxsizetxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;boxsize:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxxtxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxxctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1">#        self.Bind(wx.EVT_SPINCTRL, self.OnBoxSizes, self.boxxctrl)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxytxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxyctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1">#        self.Bind(wx.EVT_SPINCTRL, self.OnBoxSizes, self.boxyctrl)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnclearwindows</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Clear Windows&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnclearwindows</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnClearChildWindows</span><span class="p">)</span>

        <span class="n">txt2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Image file indices selection&quot;</span><span class="p">)</span>
        <span class="n">txt2</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generalindexradiobtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;--&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generalindexradiobtn</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">startindex</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Start &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startindexctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">300000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1">#        self.Bind(wx.EVT_SPINCTRL, self.OnBoxSizes, self.boxxctrl)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastindex</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Last&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastindexctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">300000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stepimageindex</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepimageindexctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rectangleindexradiobtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;--&gt;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">txtimagecenter</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Center&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centerindexctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">300000</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">txtimagefastindexbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Boxsize (X)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txtimagefastindexboxctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">300000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">txtimageslowindexbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;(Y)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txtimageslowindexboxctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">300000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">predefinedROIradiobtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;--&gt;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">twtROI</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;User-defined ROI&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">comboROI</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
                                        <span class="n">choices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_ROI</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">comboROI</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnChangeROI</span><span class="p">)</span>

        <span class="n">txt3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Counters &amp; Monitors selection&quot;</span><span class="p">)</span>
        <span class="n">txt3</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mosaiccounter</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Mosaic&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meancounter</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Mean Value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxcounter</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Max Value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaktopeakcounter</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Peak to Peak&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Peak Position&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Peak Amplitude&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Peak Displacement&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter4</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Peak Shape&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">normalizechck</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Norm. to Monitor&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitoroffsetctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mosaiccounter</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalizechck</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">txt4</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Map Properties&quot;</span><span class="p">)</span>
        <span class="n">txt4</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txtnbimagesperline</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Nb images per line&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">txtmapstartingindex</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Starting index&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapstartingimageindexctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnMosaic</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnMosaic</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnMosaic</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxsizetxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxxtxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxxctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxytxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxyctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnclearwindows</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">SetFlexibleDirection</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mosaiccounter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meancounter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxcounter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaktopeakcounter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">NavigBoxsizer1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">NavigBoxsizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalizechck</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">NavigBoxsizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitoroffsetctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generalindexradiobtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startindex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startindexctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastindex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastindexctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stepimageindex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stepimageindexctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">NavigBoxsizer2b</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">NavigBoxsizer2b</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rectangleindexradiobtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">NavigBoxsizer2b</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txtimagecenter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">NavigBoxsizer2b</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centerindexctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">NavigBoxsizer2b</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txtimagefastindexbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">NavigBoxsizer2b</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txtimagefastindexboxctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">NavigBoxsizer2b</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txtimageslowindexbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">NavigBoxsizer2b</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txtimageslowindexboxctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">ROIBoxsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">ROIBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predefinedROIradiobtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">ROIBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">twtROI</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">ROIBoxsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comboROI</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txtnbimagesperline</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stepctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txtmapstartingindex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapstartingimageindexctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">vbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">NavigBoxsizer2b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ROIBoxsizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">NavigBoxsizer1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NavigBoxsizer3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnMosaic</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>

        <span class="c1"># tooltips</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxsizetxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span>
            <span class="s2">&quot;HALF sizes in Laue Pattern image of the Region of Interest(ROI) box&quot;</span><span class="p">)</span>

        <span class="n">tpx</span> <span class="o">=</span> <span class="s2">&quot;Pixel HALF box size in Laue Pattern image of the crop box in X direction to be cut&quot;</span>
        <span class="n">tpy</span> <span class="o">=</span> <span class="s2">&quot;Pixel HALF box size in Laue Pattern image of the crop box in Y direction to be cut&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxxtxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxxctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boxytxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxyctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnclearwindows</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Clear children plot windows&quot;</span><span class="p">)</span>

        <span class="n">txt2</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Set parameters to build list of image indices (2 methods)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generalindexradiobtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Set parameters for continuous variation of image index&quot;</span><span class="p">)</span>

        <span class="n">tps</span> <span class="o">=</span> <span class="s2">&quot;Starting image filename index&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startindex</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startindexctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tps</span><span class="p">)</span>

        <span class="n">tpe</span> <span class="o">=</span> <span class="s2">&quot;Last image filename index&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastindex</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastindexctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpe</span><span class="p">)</span>

        <span class="n">tpstep</span> <span class="o">=</span> <span class="s2">&quot;image filename step&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepimageindex</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpstep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepimageindexctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpstep</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rectangleindexradiobtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Set parameters for image indices contained &quot;</span>
                                            <span class="s2">&quot;in rectangle defined by its center and half lengthes&quot;</span><span class="p">)</span>
        <span class="n">tipcenter</span> <span class="o">=</span> <span class="s2">&quot;Image index center of rectangle area&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txtimagecenter</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tipcenter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centerindexctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tipcenter</span><span class="p">)</span>
        <span class="n">tiprectboxX</span> <span class="o">=</span> <span class="s2">&quot;Nb of image indices along X (fast motor scan direction) as half rectangle width&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txtimagefastindexbox</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tiprectboxX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txtimagefastindexboxctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tiprectboxX</span><span class="p">)</span>
        <span class="n">tiprectboxY</span> <span class="o">=</span> <span class="s2">&quot;Nb of image indices along Y (slow motor scan direction) as half rectangle height&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txtimageslowindexbox</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tiprectboxY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txtimageslowindexboxctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tiprectboxY</span><span class="p">)</span>

        <span class="n">txt4</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Sample 2D Map/Mesh/Raster scan properties in terms of image indices&quot;</span><span class="p">)</span>
        <span class="n">tpnb</span> <span class="o">=</span> <span class="s2">&quot;Number of images per line to arrange results in 2D plot&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txtnbimagesperline</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpnb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpnb</span><span class="p">)</span>
        <span class="n">tipstartmap</span> <span class="o">=</span> <span class="s2">&quot;Starting Image index of the raster 2D (mesh) scan&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txtmapstartingindex</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tipstartmap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapstartingimageindexctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tipstartmap</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnMosaic</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Compute and plot Mosaic and Monitors from pixel intensity &quot;</span>
        <span class="s2">&quot;in selected ROI. Check boxes to select type of monitors&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mosaiccounter</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Recompose a 2D raster scan from the selected ROI as &quot;</span>
                                                                <span class="s2">&quot;a function of image index&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meancounter</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Recompose a 2D raster scan with MEAN pixel intensity &quot;</span>
                                                <span class="s2">&quot;in selected ROI as a function of image index&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxcounter</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Recompose a 2D raster scan with MAXIMUM pixel intensity found in selected ROI as a &quot;</span>
                                                                        <span class="s2">&quot;function of image index&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaktopeakcounter</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Recompose a 2D raster scan with largest &quot;</span>
        <span class="s2">&quot;PEAK-TO-PEAK (or Peak-to-Valley) pixel intensity found selected ROI as a function of image index&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Plot X and Y center of mass of the pixel intensity &quot;</span>
        <span class="s2">&quot;distribution of the ROI&quot;</span><span class="p">)</span>

    <span class="c1">#     def onSortROIname(self, evt):</span>
    <span class="c1">#         listROI = self.dict_ROI.keys()</span>
    <span class="c1">#         listROIs = sorted(listROI, key=str.lower)</span>
    <span class="c1">#         self.comboROI.Clear()</span>
    <span class="c1">#         self.comboROI.AppendItems(listROIs)</span>

    <span class="k">def</span> <span class="nf">OnChangeROI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">ROIselected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comboROI</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;selected &quot;</span><span class="p">,</span> <span class="n">ROIselected</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_ROI</span><span class="p">[</span><span class="n">ROIselected</span><span class="p">])</span>

<div class="viewcode-block" id="MosaicAndMonitor.OnMosaic"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MosaicAndMonitor.OnMosaic">[docs]</a>    <span class="k">def</span> <span class="nf">OnMosaic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  launch main procedure of computing mosaic and displaying it</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getcounters</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;current dict of ROIs&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_ROI</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">buildMosaic</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">getcounters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dictCounters</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;mosaic&quot;</span><span class="p">,</span>
                        <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
                        <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span>
                        <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;ptp&quot;</span><span class="p">,</span>
                        <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;Position XY&quot;</span><span class="p">,</span>
                        <span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;Amplitude&quot;</span><span class="p">,</span>
                        <span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;Displacement&quot;</span><span class="p">,</span>
                        <span class="mi">7</span><span class="p">:</span> <span class="s2">&quot;Shape&quot;</span><span class="p">}</span>

        <span class="n">list_chckcounters</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mosaiccounter</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">meancounter</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">maxcounter</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">peaktopeakcounter</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter2</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter3</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter4</span><span class="p">]</span>
        <span class="n">cselected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">chckbtn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_chckcounters</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">chckbtn</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="n">dictCounters</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;counter </span><span class="si">%s</span><span class="s2"> selected&quot;</span> <span class="o">%</span> <span class="n">selected</span><span class="p">)</span>
                <span class="n">cselected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cselected</span> <span class="o">=</span> <span class="n">cselected</span>

    <span class="k">def</span> <span class="nf">OnClearChildWindows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;killing children!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;list_of_windows&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_windows</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_windows</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
                <span class="n">child</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_windows</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="ROISelection"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ROISelection">[docs]</a><span class="k">class</span> <span class="nc">ROISelection</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>  <span class="c1"># layout2()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_windows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_ROI</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;None&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIsarray</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cselected</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># widgets --------------------------------</span>
        <span class="n">font3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">MODERN</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span><span class="p">)</span>

        <span class="n">txt1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Image pixel ROI size&quot;</span><span class="p">)</span>
        <span class="n">txt1</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boxxtxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxxctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;30&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxytxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxyctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;30&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">txt2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;ROI selection mode&quot;</span><span class="p">)</span>
        <span class="n">txt2</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ROIfromPeaklistbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Auto. on peaks&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIfromPeaklistbtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onAddROIsonPeaks</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ROIfromManualtbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Manual Rectangle&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIfromManualtbtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onManualROIsSelection</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">centerROIbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Center on pixel&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centerROIbtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onCenterROI</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">deleteROIsbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Delete ROIs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteROIsbtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onDeleteROIs</span><span class="p">)</span>

        <span class="n">txt3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Export ROIs&quot;</span><span class="p">)</span>
        <span class="n">txt3</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saveROIbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Save ROIs in file&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveROIbtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onSaveROIs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sendROItoSPECbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Send ROIs-&gt;SPEC&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sendROItoSPECbtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onSendToSpec</span><span class="p">)</span>

        <span class="n">NavigBoxsizer0</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxxtxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxxctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxytxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">NavigBoxsizer0</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxyctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">NavigBoxsizer2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROIfromPeaklistbtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROIfromManualtbtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">NavigBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centerROIbtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">NavigBoxsizer3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">NavigBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveROIbtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">NavigBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sendROItoSPECbtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">vbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">NavigBoxsizer0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">NavigBoxsizer2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deleteROIsbtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">NavigBoxsizer3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>

        <span class="c1"># tooltips -----------------------------------------</span>
        <span class="n">tpx</span> <span class="o">=</span> <span class="s2">&quot;Pixel HALF box size in Laue Pattern image of the ROI box in X direction horizontal&quot;</span>
        <span class="n">tpy</span> <span class="o">=</span> <span class="s2">&quot;Pixel HALF box size in Laue Pattern image of the ROI box in Y direction vertical &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxxtxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxxctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boxytxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxyctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ROIfromPeaklistbtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Automatic ROIs centered on current peaks (from &quot;</span>
                                                                    <span class="s2">&quot;the peak search procedure)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centerROIbtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Center ROI on clicked pixel&quot;</span><span class="p">)</span>

        <span class="c1"># txt2.SetToolTipString(&#39;Set parameters to build list of image indices (2 methods)&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ROIfromManualtbtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span>
            <span class="s1">&#39;Select with mouse a rectangle: Accept with &quot;q&quot;, delete with &quot;d&quot;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">buildROIsarray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ROIslist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">roi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ROIs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">minusheight</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">Lauetoolsindex</span><span class="p">,</span> <span class="n">visibleflag</span> <span class="o">=</span> <span class="n">roi</span>
            <span class="k">if</span> <span class="n">visibleflag</span> <span class="ow">is</span> <span class="s2">&quot;visible&quot;</span><span class="p">:</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">xmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">minusheight</span><span class="p">)</span>
                <span class="n">ROIslist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">Lauetoolsindex</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ROIslist</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onSaveROIs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.ROIs&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ROIs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ROIsarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildROIsarray</span><span class="p">()</span>

        <span class="n">outputfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;ROIs.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">outputfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;xmin xmax ymin ymax roiindex</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">outputfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROIsarray</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.6f</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">outputfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">onSendToSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">SpecClient_gevent</span> <span class="k">import</span> <span class="n">SpecVariable</span><span class="p">,</span> <span class="n">SpecVariable</span> <span class="c1">#, SpecCommand</span>
            <span class="kn">import</span> <span class="nn">ConnectPSL</span> <span class="k">as</span> <span class="nn">psl</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s1">&#39;Module to connect to current beamline control software &#39;</span>
                                                                        <span class="s1">&#39;is not installed&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;laue&quot;</span>

        <span class="n">pslroi</span> <span class="o">=</span> <span class="n">SpecVariable</span><span class="o">.</span><span class="n">SpecVariable</span><span class="p">(</span><span class="s2">&quot;PSL_ROI&quot;</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="n">pslnroi</span> <span class="o">=</span> <span class="n">SpecVariable</span><span class="o">.</span><span class="n">SpecVariable</span><span class="p">(</span><span class="s2">&quot;PSL_ROICNT&quot;</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ROIsarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildROIsarray</span><span class="p">()</span>

        <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">roi</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">psl</span><span class="o">.</span><span class="n">SendAndRecv</span><span class="p">(</span><span class="s2">&quot;ClearStatRoi&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">roielem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROIsarray</span><span class="p">:</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roielem</span>
            <span class="n">psl</span><span class="o">.</span><span class="n">SendAndRecv</span><span class="p">(</span><span class="s2">&quot;AddStatRoi;</span><span class="si">%d</span><span class="s2">;</span><span class="si">%d</span><span class="s2">;</span><span class="si">%d</span><span class="s2">;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">))</span>
            <span class="n">psl</span><span class="o">.</span><span class="n">SendAndRecv</span><span class="p">(</span><span class="s2">&quot;DrawStatRoi;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">))</span>
            <span class="n">roi</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xmin&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">xmin</span><span class="p">),</span>
                            <span class="s2">&quot;xmax&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">xmax</span><span class="p">),</span>
                            <span class="s2">&quot;ymin&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">ymin</span><span class="p">),</span>
                            <span class="s2">&quot;ymax&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">ymax</span><span class="p">),</span>
                            <span class="s2">&quot;Meas&quot;</span><span class="p">:</span> <span class="s2">&quot;Sum&quot;</span><span class="p">}</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">spec</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">pslroi</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>
            <span class="n">pslnroi</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># s=  &quot;nroi %d&quot;%(n-1)</span>
            <span class="c1"># pslspeccmd.executeCommand(s)</span>

    <span class="c1">#         ROIsarray = self.buildROIsarray()</span>
    <span class="c1">#         self.speccommand  = &#39;nroi %d&#39;%len(ROIsarray)</span>
    <span class="c1">#</span>
    <span class="c1">#         import specconnection</span>
    <span class="c1">#</span>
    <span class="c1">#         myspec = specconnection.Spec(&#39;&#39;, &quot;crg1:laue&quot;)</span>
    <span class="c1">#</span>
    <span class="c1">#         for k in range(10):</span>
    <span class="c1">#             time.sleep(1)</span>
    <span class="c1">#             if myspec.isSpecConnected() is True:</span>
    <span class="c1">#                 myspec.executeCommand(self.speccommand)</span>
    <span class="c1">#                 break</span>
    <span class="c1">#</span>
    <span class="c1">#         self.speccommand  = &#39;pslsetrois&#39;</span>
    <span class="c1">#         for k in range(10):</span>
    <span class="c1">#             time.sleep(1)</span>
    <span class="c1">#             if myspec.isSpecConnected() is True:</span>
    <span class="c1">#                 myspec.executeCommand(self.speccommand)</span>
    <span class="c1">#                 break</span>

<div class="viewcode-block" id="ROISelection.onCenterROI"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.ROISelection.onCenterROI">[docs]</a>    <span class="k">def</span> <span class="nf">onCenterROI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;simply click and later press q</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">onManualROIsSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ROIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">roiindex</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ROIs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">roiindex</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">onAddROIsonPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>

        <span class="n">peakslist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">peaklistPixels</span>

        <span class="k">if</span> <span class="n">peakslist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span>
                <span class="s1">&#39;Peaks list is empty! Please, search for peaks by pressing on &quot;Search All Peaks&quot; button for instance&#39;</span><span class="p">,</span>
                <span class="s2">&quot;Info&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># correction only to fit peak position to the display</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">position_definition</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">offset_convention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">peakslist</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">10</span><span class="p">,):</span>
                <span class="n">XYlist</span> <span class="o">=</span> <span class="p">(</span><span class="n">peakslist</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">offset_convention</span><span class="p">,)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">XYlist</span> <span class="o">=</span> <span class="n">peakslist</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">offset_convention</span>

            <span class="n">halfboxx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxxctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="n">halfboxy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxyctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

            <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">halfboxx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">halfboxy</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">po</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">XYlist</span><span class="p">):</span>

                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">halfboxx</span><span class="p">,</span> <span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">halfboxy</span>

                <span class="n">rectproperties</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ROIs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rectproperties</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">addPatchRectangleROI</span><span class="p">(</span><span class="n">rectproperties</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;updated ROIs&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ROIs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">update_draw</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onDeleteROIs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">rect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ROIs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="n">rect</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rect</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_picker</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ROIs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">roiindex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">update_draw</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnMosaic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">getcounters</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;current dict of ROIs&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_ROI</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">buildMosaic</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getcounters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dictCounters</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;mosaic&quot;</span><span class="p">,</span>
                        <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
                        <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span>
                        <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;ptp&quot;</span><span class="p">,</span>
                        <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;Position XY&quot;</span><span class="p">,</span>
                        <span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;Amplitude&quot;</span><span class="p">,</span>
                        <span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;Displacement&quot;</span><span class="p">,</span>
                        <span class="mi">7</span><span class="p">:</span> <span class="s2">&quot;Shape&quot;</span><span class="p">}</span>

        <span class="n">list_chckcounters</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mosaiccounter</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">meancounter</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">maxcounter</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">peaktopeakcounter</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter2</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter3</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">maxposcounter4</span><span class="p">]</span>
        <span class="n">cselected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">chckbtn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_chckcounters</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">chckbtn</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="n">dictCounters</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;counter </span><span class="si">%s</span><span class="s2"> selected&quot;</span> <span class="o">%</span> <span class="n">selected</span><span class="p">)</span>
                <span class="n">cselected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cselected</span> <span class="o">=</span> <span class="n">cselected</span>

    <span class="k">def</span> <span class="nf">OnClearChildWindows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;killing children!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;list_of_windows&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_windows</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_windows</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
                <span class="n">child</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_windows</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="PlotPeakListPanel"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.PlotPeakListPanel">[docs]</a><span class="k">class</span> <span class="nc">PlotPeakListPanel</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;panel class to handle peaks list within GUI</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>  <span class="c1"># layout2()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexcirclespatchlist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DetFilename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#         print &quot;mainframe of ViewColorPanel&quot;, self.mainframe</span>

        <span class="c1"># widgets -----------------------</span>
        <span class="n">luttxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;LUT&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboLUT</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">LastLUT</span><span class="p">,</span> <span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                                                <span class="n">choices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">mapsLUT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">comboLUT</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnChangeLUT</span><span class="p">)</span>

        <span class="n">posv</span> <span class="o">=</span> <span class="mi">40</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">slider_label</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Imin: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vminctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">posv</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                                            <span class="nb">min</span><span class="o">=-</span><span class="mi">200</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SPINCTRL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnSpinCtrl_IminDisplayed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vminctrl</span><span class="p">)</span>

        <span class="c1"># second horizontal band</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_label2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Imax: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">35</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vmaxctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1000&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">30</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                                            <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SPINCTRL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnSpinCtrl_ImaxDisplayed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vmaxctrl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmin</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">5</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                        <span class="n">minValue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                        <span class="n">maxValue</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                                        <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SL_AUTOTICKS</span><span class="p">)</span>  <span class="c1"># | wx.SL_LABELS)</span>
        <span class="k">if</span> <span class="n">WXPYTHON4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmin</span><span class="o">.</span><span class="n">SetTickFreq</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmin</span><span class="o">.</span><span class="n">SetTickFreq</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmin</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMMAND_SCROLL_THUMBTRACK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">on_slider_IminDisplayed</span><span class="p">)</span>

        <span class="c1"># second horizontal band</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmax</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">35</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                                        <span class="n">minValue</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                        <span class="n">maxValue</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                                        <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SL_AUTOTICKS</span><span class="p">)</span>  <span class="c1"># | wx.SL_LABELS)</span>
        <span class="k">if</span> <span class="n">WXPYTHON4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmax</span><span class="o">.</span><span class="n">SetTickFreq</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmax</span><span class="o">.</span><span class="n">SetTickFreq</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmax</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMMAND_SCROLL_THUMBTRACK</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">on_slider_ImaxDisplayed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Iminvaltxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Imaxvaltxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1000&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">35</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lineXYprofilechck</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Enable X Y profiler&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">60</span><span class="p">))</span>
        <span class="n">InitStateXYProfile</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineXYprofilechck</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">InitStateXYProfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineXYprofilechck</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnTogglelineXYprofiles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span> <span class="o">=</span> <span class="n">InitStateXYProfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span> <span class="o">=</span> <span class="n">InitStateXYProfile</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lineprof_btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Open LineProfiler&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">60</span><span class="p">),</span> <span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineprof_btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnShowLineProfiler</span><span class="p">)</span>

        <span class="n">savefig_btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;SaveFig&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">savefig_btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnSaveFigure</span><span class="p">)</span>

        <span class="n">replot_btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Replot&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">replot_btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnReplot</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show2thetachi</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Show 2theta Chi&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">100</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detfiletxtctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opendetfilebtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="n">posv</span> <span class="o">+</span> <span class="mi">100</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show2thetachi</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opendetfilebtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onOpenDetFile</span><span class="p">)</span>

        <span class="n">showhisto_btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Intensity Distribution&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">260</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">showhisto_btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ShowHisto</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y2</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">1800</span><span class="p">,</span> <span class="mi">1800</span>

        <span class="c1"># tooltip</span>
        <span class="n">tp1</span> <span class="o">=</span> <span class="s2">&quot;selection of various intensity mapping color Looking_up table (LUT) &quot;</span>

        <span class="n">luttxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comboLUT</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp1</span><span class="p">)</span>

        <span class="n">showhisto_btn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Show histogram of pixel intensity distribution of raw image&quot;</span><span class="p">)</span>

        <span class="n">tp2</span> <span class="o">=</span> <span class="s2">&quot;Coarse color scale intensity: min and max&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">slider_label</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vminctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_label2</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmaxctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp2</span><span class="p">)</span>

        <span class="n">tp3</span> <span class="o">=</span> <span class="s2">&quot;fine color scale intensity minimum&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmin</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp3</span><span class="p">)</span>
        <span class="n">tp4</span> <span class="o">=</span> <span class="s2">&quot;fine color scale intensity maximum&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_vmax</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tp4</span><span class="p">)</span>

        <span class="n">tpmin</span> <span class="o">=</span> <span class="s2">&quot;current color scale intensity minimum&quot;</span>
        <span class="n">tpmax</span> <span class="o">=</span> <span class="s2">&quot;current color scale intensity maximum&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Iminvaltxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpmin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Imaxvaltxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tpmax</span><span class="p">)</span>

        <span class="n">savefig_btn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Save current plot figure in png format file&quot;</span><span class="p">)</span>

        <span class="n">replot_btn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Reset and replot displayed image in plot&quot;</span><span class="p">)</span>

        <span class="n">tiplineprof</span> <span class="o">=</span> <span class="s2">&quot;Open/Close Draggable Line Pixel intensity Profiler.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">tiplineprof</span> <span class="o">+=</span> <span class="s2">&quot;Press left mouse button to move line.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">tiplineprof</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;Press right mouse button to change line length (or, press + or -).</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lineprof_btn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tiplineprof</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">showprofiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updateLineProfile</span><span class="p">()</span>
        <span class="c1">#         print &#39;event update&#39;, event</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">backend_bases</span><span class="o">.</span><span class="n">MouseEvent</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OnShowLineXYProfiler</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="c1">#         self.OnShowLineProfiler(evt)</span>

    <span class="k">def</span> <span class="nf">OnTogglelineXYprofiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">showprofiles</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getlineXYprofiledata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="c1"># warning of ymax and ymin swapping!</span>
        <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)]</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrictxylimits_to_imagearray</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

        <span class="c1">#         print &quot;xmin, xmax, ymin, ymax&quot;, xmin, xmax, ymin, ymax</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Extract the values along the line</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI</span>

        <span class="n">xyc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getclickposition</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xyc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span> <span class="o">=</span> <span class="n">xyc</span>

        <span class="c1">#         print &quot;xc, yc&quot;, xc, yc</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">zx</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yc</span><span class="p">)),</span> <span class="n">xmin</span> <span class="p">:</span> <span class="n">xmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">zy</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">ymin</span> <span class="p">:</span> <span class="n">ymax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">))]</span>

        <span class="c1">#         print &quot;len(y)&quot;, len(y)</span>
        <span class="c1">#         print &quot;len(zy)&quot;, len(zy)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span>

    <span class="k">def</span> <span class="nf">getclickposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">backend_bases</span><span class="o">.</span><span class="n">MouseEvent</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span>

<div class="viewcode-block" id="PlotPeakListPanel.OnShowLineXYProfiler"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.PlotPeakListPanel.OnShowLineXYProfiler">[docs]</a>    <span class="k">def</span> <span class="nf">OnShowLineXYProfiler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show line X and Y profilers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LINEPROFILE_WIDTH</span><span class="p">,</span> <span class="n">LINEPROFILE_HEIGHT</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">300</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.plotlineXprofile and self.plotlineYprofile == &quot;</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span><span class="p">:</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>

                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlineXYprofiledata</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

                <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestposition</span><span class="p">(</span><span class="n">LINEPROFILE_WIDTH</span><span class="p">,</span> <span class="n">LINEPROFILE_HEIGHT</span><span class="p">)</span>

                <span class="c1"># -- Plot lineprofile...</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span> <span class="o">=</span> <span class="n">PLOT1D</span><span class="o">.</span><span class="n">Plot1DFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Intensity profile X&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">zx</span><span class="p">],</span> <span class="n">logscale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                                            <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">LINEPROFILE_WIDTH</span><span class="p">,</span> <span class="n">LINEPROFILE_HEIGHT</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">((</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span> <span class="o">=</span> <span class="n">PLOT1D</span><span class="o">.</span><span class="n">Plot1DFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Intensity profile Y&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">zy</span><span class="p">],</span> <span class="n">logscale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                                            <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">LINEPROFILE_WIDTH</span><span class="p">,</span> <span class="n">LINEPROFILE_HEIGHT</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">((</span><span class="n">xp</span> <span class="o">-</span> <span class="mi">200</span><span class="p">,</span> <span class="n">yp</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateLineXYProfile</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">bestposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">LINEPROFILE_WIDTH</span><span class="p">,</span> <span class="n">LINEPROFILE_HEIGHT</span><span class="p">):</span>
        <span class="c1"># screen size</span>
        <span class="n">dws</span><span class="p">,</span> <span class="n">dhs</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">DisplaySize</span><span class="p">()</span>
        <span class="c1"># peaksearchframe size</span>
        <span class="n">wf</span><span class="p">,</span> <span class="n">hf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wf, hf&quot;</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">hf</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dws, dhs&quot;</span><span class="p">,</span> <span class="n">dws</span><span class="p">,</span> <span class="n">dhs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dws</span> <span class="o">&gt;</span> <span class="n">wf</span><span class="p">:</span>
            <span class="n">Xwindow</span> <span class="o">=</span> <span class="n">dws</span> <span class="o">-</span> <span class="n">LINEPROFILE_WIDTH</span>
        <span class="k">if</span> <span class="n">dhs</span> <span class="o">&gt;</span> <span class="n">hf</span><span class="p">:</span>
            <span class="n">Ywindow</span> <span class="o">=</span> <span class="n">dhs</span> <span class="o">-</span> <span class="n">LINEPROFILE_HEIGHT</span>

        <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Xwindow</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">Ywindow</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xp,yp&quot;</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span>

    <span class="k">def</span> <span class="nf">restrictxylimits_to_imagearray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">):</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">framedim</span>

        <span class="n">xmin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymin</span><span class="p">)</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymax</span><span class="p">,</span> <span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span>

<div class="viewcode-block" id="PlotPeakListPanel.getlineprofiledata"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.PlotPeakListPanel.getlineprofiledata">[docs]</a>    <span class="k">def</span> <span class="nf">getlineprofiledata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get pixel intensities array between two points (x0,y0) and (x2,y2)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrictxylimits_to_imagearray</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1">#         print &#39;x0, y0, x2, y2&#39;</span>
        <span class="c1">#         print x0, y0, x2, y2</span>

        <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y0</span><span class="p">))</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">+</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">+</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">length</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Extract the values along the line</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI</span>

        <span class="c1"># transpose data</span>
        <span class="n">i_ind</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
        <span class="n">j_ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>

        <span class="n">zi</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">i_ind</span><span class="p">,</span> <span class="n">j_ind</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">x0</span> <span class="o">!=</span> <span class="n">x2</span><span class="p">:</span>
            <span class="n">signabscissa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signabscissa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>

        <span class="n">dataX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">signabscissa</span>
        <span class="n">dataY</span> <span class="o">=</span> <span class="n">zi</span>

        <span class="k">return</span> <span class="n">dataX</span><span class="p">,</span> <span class="n">dataY</span></div>

<div class="viewcode-block" id="PlotPeakListPanel.OnShowLineProfiler"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.PlotPeakListPanel.OnShowLineProfiler">[docs]</a>    <span class="k">def</span> <span class="nf">OnShowLineProfiler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        show a movable and draggable line profiler and draw line and circle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofile</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofile</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineXYprofilechck</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lineprof_btn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Close LineProfiler&quot;</span><span class="p">)</span>
            <span class="c1">#             self.plotlineXprofile = False</span>
            <span class="c1">#             self.plotlineYprofile = False</span>
            <span class="c1">#             self.lineXYprofilechck.SetValue(False)</span>

            <span class="c1"># -- Plot lineprofile...</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">zi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlineprofiledata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y2</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span> <span class="o">=</span> <span class="n">PLOT1D</span><span class="o">.</span><span class="n">Plot1DFrame</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Intensity profile&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">zi</span><span class="p">],</span> <span class="n">logscale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># plot line on canvas (CCD image)</span>

            <span class="n">pt1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">]</span>
            <span class="n">pt2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y2</span><span class="p">]</span>
            <span class="n">ptcenter</span> <span class="o">=</span> <span class="n">DGP</span><span class="o">.</span><span class="n">center_pts</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>

            <span class="n">circles</span> <span class="o">=</span> <span class="p">[</span><span class="n">Circle</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
                        <span class="n">Circle</span><span class="p">(</span><span class="n">ptcenter</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
                        <span class="n">Circle</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)]</span>

            <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ptcenter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                            <span class="p">[</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ptcenter</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                            <span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="n">c</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexcirclespatchlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">init_patches_nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">patches</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">circ</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">circles</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indexcirclespatchlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init_patches_nb</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
            <span class="c1">#             print &quot;building draggable line&quot;</span>
            <span class="c1">#             print &quot;peak search canvas&quot;, self.mainframe.canvas</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drg</span> <span class="o">=</span> <span class="n">DGP</span><span class="o">.</span><span class="n">DraggableLine</span><span class="p">(</span><span class="n">circles</span><span class="p">,</span>
                                        <span class="n">line</span><span class="p">,</span>
                                        <span class="n">tolerance</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                                        <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="p">,</span>
                                        <span class="n">framedim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">framedim</span><span class="p">,</span>
                                        <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;pixels&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2047</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">2047</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineprof_btn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Open LineProfiler&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">drg</span><span class="o">.</span><span class="n">connectingline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># empty line</span>

            <span class="c1"># warning patches list can contain circle marker from peak search</span>
            <span class="c1">#             print &quot;self.mainframe.axes.patches&quot;, self.mainframe.axes.patches</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexcirclespatchlist</span><span class="p">)):</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indexcirclespatchlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">framedim</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drg</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span></div>

    <span class="k">def</span> <span class="nf">updateLineXYProfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1">#         print &quot;updateLineXYProfile()&quot;</span>
        <span class="c1">#</span>
        <span class="c1">#         print &quot;self.plotlineXprofileframe&quot;, self.plotlineXprofileframe</span>
        <span class="c1">#</span>
        <span class="c1">#         print &quot;event updateLineXYProfile&quot;, event</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlineXYprofiledata</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="c1">#             print &quot;x, y, zx, zy&quot;, x, y, zx, zy</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zx</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zy</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STRANGE&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">xyc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getclickposition</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xyc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span> <span class="o">=</span> <span class="n">xyc</span>
            <span class="c1">#         print &quot;x&quot;, x</span>
            <span class="c1">#             print &quot;xmin=&quot;, min(x)</span>
            <span class="c1">#             print &quot;xmax=&quot;, max(x)</span>
            <span class="c1">#             print &quot;Imin=&quot;, min(zi)</span>
            <span class="c1">#             print &quot;Imax=&quot;, max(zi)</span>
            <span class="n">lineXprofileframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineXprofileframe</span>

            <span class="n">lineXprofileframe</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">zx</span><span class="p">)</span>
            <span class="n">lineXprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">@y=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span><span class="p">))</span>
            <span class="n">lineXprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
            <span class="n">lineXprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">lineXprofileframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlineXYprofiledata</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zx</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zy</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STRANGE&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">xyc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getclickposition</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xyc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span> <span class="o">=</span> <span class="n">xyc</span>
            <span class="c1">#         print &quot;x&quot;, x</span>
            <span class="c1">#             print &quot;xmin=&quot;, min(x)</span>
            <span class="c1">#             print &quot;xmax=&quot;, max(x)</span>
            <span class="c1">#             print &quot;Imin=&quot;, min(zi)</span>
            <span class="c1">#             print &quot;Imax=&quot;, max(zi)</span>
            <span class="n">lineYprofileframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineYprofileframe</span>

            <span class="n">lineYprofileframe</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">zy</span><span class="p">)</span>
            <span class="n">lineYprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">@x=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">))</span>
            <span class="n">lineYprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
            <span class="n">lineYprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">lineYprofileframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">updateLineProfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">x</span><span class="p">,</span> <span class="n">zi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlineprofiledata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y2</span><span class="p">)</span>
            <span class="c1">#         print &quot;x&quot;, x</span>
            <span class="c1">#             print &quot;xmin=&quot;, min(x)</span>
            <span class="c1">#             print &quot;xmax=&quot;, max(x)</span>
            <span class="c1">#             print &quot;Imin=&quot;, min(zi)</span>
            <span class="c1">#             print &quot;Imax=&quot;, max(zi)</span>
            <span class="n">lineprofileframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlineprofileframe</span>

            <span class="n">lineprofileframe</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">zi</span><span class="p">)</span>
            <span class="n">lineprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">line [</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">]-[</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">]&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y2</span><span class="p">))</span>
            <span class="n">lineprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
            <span class="n">lineprofileframe</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">lineprofileframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">onOpenDetFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ReadDetFile</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DetFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">DetFilename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detfiletxtctrl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">DetFilename</span><span class="p">)</span></div>


<div class="viewcode-block" id="findLocalMaxima_Meth_1"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.findLocalMaxima_Meth_1">[docs]</a><span class="k">class</span> <span class="nc">findLocalMaxima_Meth_1</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    class of method 1 for local maxima search (intensity threshold)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">methodnumber</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">CCDlabel</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">CCDlabel</span>
        <span class="k">if</span> <span class="n">CCDlabel</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sCMOS&quot;</span><span class="p">):</span>
            <span class="n">pedestal</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pedestal</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">defaultthreshold</span> <span class="o">=</span> <span class="n">pedestal</span> <span class="o">+</span> <span class="mi">500</span>

        <span class="n">mintxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;MinimumDistance&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PNR</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>

        <span class="n">ittxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;IntensityThreshold&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">35</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">defaultthreshold</span><span class="p">),</span> <span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                                            <span class="nb">min</span><span class="o">=-</span><span class="mi">6000</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">3000000</span><span class="p">)</span>

        <span class="c1"># tooltips</span>
        <span class="n">mintp</span> <span class="o">=</span> <span class="s2">&quot;Minimum pixel distances between local maxima&quot;</span>
        <span class="n">mintxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">mintp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PNR</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">mintp</span><span class="p">)</span>

        <span class="n">ittp</span> <span class="o">=</span> <span class="s2">&quot;Threshold level above which local maxima must be found&quot;</span>
        <span class="n">ittxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">ittp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">ittp</span><span class="p">)</span></div>


<div class="viewcode-block" id="findLocalMaxima_Meth_2"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.findLocalMaxima_Meth_2">[docs]</a><span class="k">class</span> <span class="nc">findLocalMaxima_Meth_2</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    class of method parameters for 2nd method of local maxima(shifted arrays)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">methodnumber</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="c1">#        font3 = wx.Font(10, wx.MODERN, wx.NORMAL, wx.BOLD)</span>
        <span class="c1">#        self.title2 = wx.StaticText(self, -1, &#39;Local Maxima Search Parameters(Shifted Arrays)&#39;, (5, 6))</span>
        <span class="c1">#        self.title2.SetFont(font3)</span>

        <span class="n">pnrtxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;PixelNearRadius&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PNR</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

        <span class="n">ittxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;IntensityThreshold&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">35</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;500&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">65000</span><span class="p">)</span>

        <span class="c1"># tooltips</span>
        <span class="n">pnrtp</span> <span class="o">=</span> <span class="s2">&quot;Minimum pixel distances between local maxima&quot;</span>
        <span class="n">pnrtxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">pnrtp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PNR</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">pnrtp</span><span class="p">)</span>

        <span class="n">ittp</span> <span class="o">=</span> <span class="s2">&quot;Threshold level - RELATIVE to local background- above which local maxima must be found.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">ittp</span> <span class="o">+=</span> <span class="s2">&quot;Local background is a flat level given by the minimum intensity in a box centered on local maximum and with size 2*PixelNearRadius+1&quot;</span>
        <span class="n">ittxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">ittp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">ittp</span><span class="p">)</span></div>


<div class="viewcode-block" id="findLocalMaxima_Meth_3"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.findLocalMaxima_Meth_3">[docs]</a><span class="k">class</span> <span class="nc">findLocalMaxima_Meth_3</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    class of method 3 for local maxima search (convolution by a mexican hat kernel)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        instantiate the panel and widgets for Convolution Method</span>

<span class="sd">        mainframe= parent.GetParent().GetParent())</span>

<span class="sd">        this mainframe must have following attributes and methods:</span>
<span class="sd">        ShowHisto_ConvolvedData()</span>
<span class="sd">        ComputeConvolvedData()</span>
<span class="sd">        Show_ConvolvedImage()</span>
<span class="sd">        Show_Image()</span>
<span class="sd">        OnSpinCtrl_ImaxDisplayed()</span>
<span class="sd">        dataimage_ROI</span>
<span class="sd">        dataimage_ROI_display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">methodnumber</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>

        <span class="c1"># widgets ---------------------------------</span>
        <span class="n">posv</span> <span class="o">=</span> <span class="mi">30</span>

        <span class="n">pnrtxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;PixelNearRadius&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">32</span> <span class="o">-</span> <span class="n">posv</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PNR</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">125</span><span class="p">,</span> <span class="mi">30</span> <span class="o">-</span> <span class="n">posv</span><span class="p">),</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

        <span class="n">showhisto_btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;ShowHisto&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">30</span> <span class="o">-</span> <span class="n">posv</span><span class="p">))</span>
        <span class="n">showhisto_btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ShowHisto_ConvolvedData</span><span class="p">)</span>

        <span class="n">Recompute_btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Compute Conv.&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">30</span> <span class="o">-</span> <span class="n">posv</span><span class="p">))</span>
        <span class="n">Recompute_btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">ComputeConvolvedData</span><span class="p">)</span>

        <span class="n">tctxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;ThresholdConvolve&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">72</span> <span class="o">-</span> <span class="n">posv</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ThresholdConvolveCtrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1000&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">135</span><span class="p">,</span> <span class="mi">70</span> <span class="o">-</span> <span class="n">posv</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                                                <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">200000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SPINCTRL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">Show_ConvolvedImage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ThresholdConvolveCtrl</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">showconvolvedImage_btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Show Conv. Image&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">260</span><span class="p">,</span> <span class="mi">70</span> <span class="o">-</span> <span class="n">posv</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showconvolvedImage_btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOGGLEBUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnSwitchImageDisplay</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TogglebtnState</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># show raw image</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Applythreshold</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Show thresholding&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">110</span> <span class="o">-</span> <span class="n">posv</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Applythreshold</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Applythreshold</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">Show_ConvolvedImage</span><span class="p">)</span>

        <span class="n">vmaxtxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Max. Intensity&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">190</span><span class="p">,</span> <span class="mi">110</span> <span class="o">-</span> <span class="n">posv</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmaxctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;65000&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">290</span><span class="p">,</span> <span class="mi">112</span> <span class="o">-</span> <span class="n">posv</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmaxctrl</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SPINCTRL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">OnSpinCtrl_ImaxDisplayed</span><span class="p">)</span>

        <span class="n">ittxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Intensity Threshold (raw data)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">152</span> <span class="o">-</span> <span class="n">posv</span><span class="p">))</span>
        <span class="n">ittxt2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;with respect to local background&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">172</span> <span class="o">-</span> <span class="n">posv</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;500&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">210</span><span class="p">,</span> <span class="mi">150</span> <span class="o">-</span> <span class="n">posv</span><span class="p">),</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">6500000</span><span class="p">)</span>

        <span class="c1"># tooltips ---------------------------</span>
        <span class="n">pnrtp</span> <span class="o">=</span> <span class="s2">&quot;Minimum pixel distances between local maxima&quot;</span>
        <span class="n">pnrtxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">pnrtp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PNR</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">pnrtp</span><span class="p">)</span>

        <span class="n">ittp</span> <span class="o">=</span> <span class="s2">&quot;Threshold level - RELATIVE to local background- above which local maxima must be found.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">ittp</span> <span class="o">+=</span> <span class="s2">&quot;Local background is a flat level given by the minimum intensity in a box centered on local maximum and with size 2*PixelNearRadius+1&quot;</span>
        <span class="n">ittxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">ittp</span><span class="p">)</span>
        <span class="n">ittxt2</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">ittp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">ittp</span><span class="p">)</span>

        <span class="n">tctp</span> <span class="o">=</span> <span class="s2">&quot;Threshold level -for image convolved by a gaussian kernel- above which local maxima must be found.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">tctp</span> <span class="o">+=</span> <span class="s2">&quot;Take care of larger scale of intensity&quot;</span>
        <span class="n">tctxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tctp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ThresholdConvolveCtrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tctp</span><span class="p">)</span>

        <span class="n">showhisto_btn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Show histogram of the pixel intensity distribution of &quot;</span>
                                                        <span class="s2">&quot;image convoluted by a gaussian kernel&quot;</span><span class="p">)</span>
        <span class="n">Recompute_btn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Compute or Recompute convolution of the raw image by a &quot;</span>
        <span class="s2">&quot;gaussian kernel.</span><span class="se">\n</span><span class="s2">.Raw image is the current displayed image (raw or without background).&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showconvolvedImage_btn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Display convolved image by a gaussian kernel&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Applythreshold</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s1">&#39;Apply on the displayed convolved image the &#39;</span>
                                                        <span class="s1">&#39;threshold given by &quot;thresholdConvolve&quot;.&#39;</span><span class="p">)</span>

        <span class="n">vmaxtp</span> <span class="o">=</span> <span class="s2">&quot;Maximum displayed pixel intensity in convolved image.&quot;</span>
        <span class="n">vmaxtxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">vmaxtp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmaxctrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">vmaxtp</span><span class="p">)</span>

<div class="viewcode-block" id="findLocalMaxima_Meth_3.OnSwitchImageDisplay"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.findLocalMaxima_Meth_3.OnSwitchImageDisplay">[docs]</a>    <span class="k">def</span> <span class="nf">OnSwitchImageDisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        switch between raw and convolved image display (performed by MainPeakSearchFrame class)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TogglebtnState</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TogglebtnState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TogglebtnState</span> <span class="o">%</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TogglebtnState</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># now show conv image</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showconvolvedImage_btn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Show Image&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">Show_ConvolvedImage</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">TogglebtnState</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># now show raw image</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showconvolvedImage_btn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Show Conv. Image&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">Show_Image</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FitParametersPanel"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.FitParametersPanel">[docs]</a><span class="k">class</span> <span class="nc">FitParametersPanel</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        method 1 parameters for method #0 for local maxima search + fit(intensity threshold)</span>

<span class="sd">        parent must have granparent (call of parent.GetParent())</span>

<span class="sd">        this granparent must have following attributes and methods:</span>
<span class="sd">        OnPeakSearch()</span>
<span class="sd">        GetParent().CCDlabel</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">granparent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">methodnumber</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">)</span>

        <span class="n">font3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">MODERN</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span><span class="p">)</span>

        <span class="n">txt0</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;General parameters&quot;</span><span class="p">)</span>
        <span class="n">txt0</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font3</span><span class="p">)</span>

        <span class="n">maxnbtxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Max. Nb of Fits&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NbMaxFits</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;2000&quot;</span><span class="p">)</span>
        <span class="c1">#        self.peaksearchComments = wx.TextCtrl(self, -1, &#39;&#39;, (100, 105))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">onWholeImage</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Apply on whole Image&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onWholeImage</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onWholeImage</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>

        <span class="n">usetxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Use peak position&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keepHottestPixel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Hottest Pixel&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keepCentroid</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Centroid&quot;</span><span class="p">)</span>

        <span class="n">txt1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Fitting parameters&quot;</span><span class="p">)</span>
        <span class="n">txt1</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font3</span><span class="p">)</span>

        <span class="n">fittxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;FitFunction&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitfunc</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">,</span>
                                <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Gaussian&quot;</span><span class="p">,</span> <span class="s2">&quot;Lorentzian&quot;</span><span class="p">,</span> <span class="s2">&quot;NoFit&quot;</span><span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="p">)</span>
        <span class="c1">#        self.fitfunc.Bind(wx.EVT_COMBOBOX, self.OnfitfuncChange)</span>

        <span class="n">xtoltxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;xtol&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xtol</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;0.001&quot;</span><span class="p">)</span>

        <span class="n">boxtxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Boxsize&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxsize</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;15&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">peaksizetxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Peak size&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaksizectrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># rejection</span>

        <span class="n">txt2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Rejection parameters&quot;</span><span class="p">)</span>
        <span class="n">txt2</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font3</span><span class="p">)</span>

        <span class="n">saturation_value</span> <span class="o">=</span> <span class="n">DictLT</span><span class="o">.</span><span class="n">dict_CCD</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">granparent</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">pixdevtxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Max. Deviation (pixel)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FitPixelDev</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;6.0&quot;</span><span class="p">)</span>

        <span class="n">maxItxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Peak Intensity    Max: &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxIctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">saturation_value</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">minItxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Min:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minIctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

        <span class="n">peaksizemaxtxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Peak size   Max :&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaksizemaxctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;3.0&quot;</span><span class="p">)</span>

        <span class="n">peaksizemintxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Min :&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaksizeminctrl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;0.65&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initbuttons</span><span class="p">()</span>

        <span class="c1"># layout</span>
        <span class="n">HBoxsizer1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">HBoxsizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">usetxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keepHottestPixel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keepCentroid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">HBoxsizer2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">HBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">fittxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitfunc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">xtoltxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xtol</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">HBoxsizer3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">HBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">boxtxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxsize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">peaksizetxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer3</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaksizectrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">HBoxsizer4</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">HBoxsizer4</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">pixdevtxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer4</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FitPixelDev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer4b</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">HBoxsizer4b</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">maxItxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer4b</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxIctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer4b</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">minItxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer4b</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minIctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer4c</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">HBoxsizer4c</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">peaksizemaxtxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer4c</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaksizemaxctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer4c</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">peaksizemintxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer4c</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaksizeminctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">HBoxsizer5</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">HBoxsizer5</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">maxnbtxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer5</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NbMaxFits</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">HBoxsizer5</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onWholeImage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">vbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">HBoxsizer5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">HBoxsizer1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">HBoxsizer2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">HBoxsizer3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">HBoxsizer4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">HBoxsizer4b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">HBoxsizer4c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>

        <span class="c1"># tooltips</span>
        <span class="n">usetp</span> <span class="o">=</span> <span class="s2">&quot;Select the intial guessed peak pixel position from results of local maxima search.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">usetp</span> <span class="o">+=</span> <span class="s2">&quot;Hottest Pixel: (integers) pixels position of the highest pixel close the local maxima.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">usetp</span> <span class="o">+=</span> <span class="s2">&quot;Centroid: (floats) pixels position of the center of mass of blob (local cluster of hot pixels).&quot;</span>

        <span class="n">usetxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">usetp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keepHottestPixel</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">usetp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keepCentroid</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">usetp</span><span class="p">)</span>

        <span class="n">fittp</span> <span class="o">=</span> <span class="s2">&quot;Select the 2D peak shape model&quot;</span>
        <span class="n">fittxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">fittp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitfunc</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">fittp</span><span class="p">)</span>

        <span class="n">boxtp</span> <span class="o">=</span> <span class="s2">&quot;HALF size (in pixel) of the squared box length to be fitted by a peak model&quot;</span>
        <span class="n">boxtxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">boxtp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxsize</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">boxtp</span><span class="p">)</span>

        <span class="n">pixdevtp</span> <span class="o">=</span> <span class="s1">&#39;Pixel deviation &quot;FitPixDev&quot; threshold above which a single fitted peak is &#39;</span>
        <span class="s1">&#39;rejected (will not belong to the final peaks list).</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">pixdevtp</span> <span class="o">+=</span> <span class="s2">&quot;Pixel deviation is the pixel distance between peak position result and &quot;</span>
        <span class="s2">&quot;starting initial guessed position given by one of the three local maxima &quot;</span>
        <span class="s2">&quot;search methods and radio button choice (Hottest pixel or Centroid) &quot;</span>
        <span class="s2">&quot;if using Convolution Method.&quot;</span>
        <span class="n">pixdevtxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">pixdevtp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FitPixelDev</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">pixdevtp</span><span class="p">)</span>

        <span class="n">maxnbtp</span> <span class="o">=</span> <span class="s2">&quot;Maximum number of local maxima to be fitted&quot;</span>
        <span class="n">maxnbtxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">maxnbtp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NbMaxFits</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">maxnbtp</span><span class="p">)</span>

        <span class="n">tippeaksize</span> <span class="o">=</span> <span class="s2">&quot;Guess peak size in pixel&quot;</span>
        <span class="n">peaksizetxt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tippeaksize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaksizectrl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">tippeaksize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">granparent</span><span class="o">.</span><span class="n">OnPeakSearch</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initbuttons</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
        <span class="c1"># state resulting from the type of result of page3 (first local maxima method)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keepHottestPixel</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keepCentroid</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keepHottestPixel</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<span class="n">DICT_FIELDS_SIZE</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;intensity&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                    <span class="s2">&quot;pixX&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                    <span class="s2">&quot;pixY&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                    <span class="s2">&quot;spotindex&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
                    <span class="s2">&quot;grainindex&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
                    <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
                    <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
                    <span class="s2">&quot;L&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
                    <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
                    <span class="s2">&quot;twotheta&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
                    <span class="s2">&quot;chi&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
                    <span class="s2">&quot;MatchingRate&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                    <span class="s2">&quot;NbindexedSpots&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                    <span class="s2">&quot;peak_amplitude&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                    <span class="s2">&quot;peak_background&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
                    <span class="s2">&quot;peak_width1&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                    <span class="s2">&quot;peak_width2&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                    <span class="s2">&quot;peak_inclin&quot;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span>
                    <span class="s2">&quot;PixDev_x&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                    <span class="s2">&quot;PixDev_y&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                    <span class="s2">&quot;PixMax&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>

<span class="n">DICT_FIELDS_ALIGN</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;intensity&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;pixX&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;pixY&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;spotindex&quot;</span><span class="p">:</span> <span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;grainindex&quot;</span><span class="p">:</span> <span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;L&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;twotheta&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;chi&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;MatchingRate&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;NbindexedSpots&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;peak_amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;peak_background&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;peak_width1&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;peak_width2&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;peak_inclin&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;PixDev_x&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;PixDev_y&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;PixMax&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">}</span>

<span class="n">LIST_OF_FIELDS_DATAPEAK</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pixX&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;pixY&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;peak_amplitude&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;peak_width1&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;peak_width2&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;peak_inclin&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;PixDev_x&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;PixDev_y&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;peak_background&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;PixMax&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="PeakListOLV"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.PeakListOLV">[docs]</a><span class="k">class</span> <span class="nc">PeakListOLV</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    panel embedding an ObjectListViewer from ObjectListView module</span>

<span class="sd">    need of:</span>
<span class="sd">    self.grangranparent.peaklistPixels</span>
<span class="sd">    self.grangranparent.onRemovePeaktoPeaklist</span>
<span class="sd">    self.grangranparent.OnReplot</span>
<span class="sd">    self.grangranparent.framedim</span>
<span class="sd">    and lot of other things with mainframe...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;init&quot;&quot;&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
        <span class="c1">#        scrolled.ScrolledPanel.__init__(self, parent, -1)</span>

        <span class="c1">#        print self.GetId()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>  <span class="c1"># notebook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">granparent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>  <span class="c1"># MainPeakSearchFrame.panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grangranparent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">granparent</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grangranparent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">methodnumber</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">listofdata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listoffields</span> <span class="o">=</span> <span class="n">LIST_OF_FIELDS_DATAPEAK</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">focuseditem</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">allspots</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_selectedspots</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># widgets ----------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatepeaklist</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;update peaks list&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatepeaklist</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatepeaklist</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateView</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">useselection</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Remove Peak&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useselection</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnRemove</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnremoveall</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Purge List&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnremoveall</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnRemoveAll</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">showROIpeak</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;show peak&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showROIpeak</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnShowPeak</span><span class="p">)</span>

        <span class="c1">#        self.showspecificgrains = wx.CheckBox(self, -1, &quot;show spots of grains&quot;, style=wx.ALIGN_LEFT)</span>
        <span class="c1">#        self.showspecificgrains.Disable()</span>
        <span class="c1">#        self.showspecificgrains.Bind(wx.EVT_CHECKBOX, self.OnShowGrainsSpots)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boxsizetxt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;boxsize(x,y)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxsizex</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;20&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxsizey</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;50&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="p">)</span>

        <span class="c1"># layout -------------------------------------</span>
        <span class="n">sizerh1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">sizerh2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="n">sizerh1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">updatepeaklist</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">sizerh1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">useselection</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">sizerh1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnremoveall</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">sizerh2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showROIpeak</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">sizerh2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxsizetxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">sizerh2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxsizex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">sizerh2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxsizey</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1">#        self.buildlistofspots()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span> <span class="o">=</span> <span class="n">ObjectListView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LC_REPORT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_LIST_ITEM_FOCUSED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnClickRow</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateView</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#        self.InitObjectListView()</span>

        <span class="n">sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sizerh1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sizerh2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">AddSpacer</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">sizer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">buildlistofspots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grangranparent</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Peak List is empty&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">flag</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">updatepeaklist</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="c1"># numpy array of datapeak</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listofdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grangranparent</span><span class="o">.</span><span class="n">peaklistPixels</span>
            <span class="c1"># list of spot objects</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allspots</span> <span class="o">=</span> <span class="n">SpotModel</span><span class="o">.</span><span class="n">GetAllspots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listofdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">listoffields</span><span class="p">)</span>

            <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">flag</span>

    <span class="k">def</span> <span class="nf">AddOneSpot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datapeak</span><span class="p">):</span>
        <span class="n">spotobject</span> <span class="o">=</span> <span class="n">SpotModel</span><span class="o">.</span><span class="n">Spot</span><span class="p">(</span><span class="n">datapeak</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">listoffields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">AddObject</span><span class="p">(</span><span class="n">spotobject</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">RemoveOneSpot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peakXY</span><span class="p">):</span>
        <span class="n">RADIUS</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">peakXY</span>
        <span class="n">listobjects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">GetObjects</span><span class="p">()</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">listobjects</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">pixX</span> <span class="o">-</span> <span class="n">X</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">pixY</span> <span class="o">-</span> <span class="n">Y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">RADIUS</span> <span class="o">**</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">k</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">ind</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>

            <span class="c1">#        selectedobject_filter = self.myOlv.GetObjects()[indexObject]</span>
            <span class="c1">#        print &quot;listobjects&quot;, listobjects</span>
            <span class="c1">#        print self.myOlv.GetItemText(indexObject)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">RemoveObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="c1">#        self.myOlv.RemoveObject(selectedobject_filter)</span>
    <span class="c1">#        print &quot;self.myOlv.GetObjectAt(indexObject)&quot;, self.myOlv.GetObjectAt(indexObject)</span>
    <span class="c1">#        self.myOlv.RemoveObject(self.myOlv.GetObjectAt(indexObject))</span>

    <span class="k">def</span> <span class="nf">InitObjectListView</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#        self.myOlv.SetColumns([</span>
        <span class="c1">#            ColumnDefn(&quot;Title&quot;, &quot;left&quot;, 120, self.listofields[0]),</span>
        <span class="c1">#            ColumnDefn(&quot;Size (MB)&quot;, &quot;center&quot;, 100, self.listofields[1]), #stringConverter=&quot;%.1f&quot;),</span>
        <span class="c1">#            ColumnDefn(&quot;Last Played&quot;, &quot;left&quot;, 100, self.listofields[2]), # stringConverter=&quot;%d-%m-%Y&quot;),</span>
        <span class="c1">#            ColumnDefn(&quot;Rating&quot;, &quot;center&quot;, 100, self.listofields[3])</span>
        <span class="c1">#        ])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allspots</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># columns definition</span>
            <span class="n">coldef</span> <span class="o">=</span> <span class="p">[</span><span class="n">ColumnDefn</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">DICT_FIELDS_ALIGN</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">DICT_FIELDS_SIZE</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">field</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listoffields</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">SetColumns</span><span class="p">(</span><span class="n">coldef</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">SetObjects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allspots</span><span class="p">)</span>

            <span class="c1"># to color row</span>

    <span class="c1">#            self.myOlv.rowFormatter = self.rowFormatter</span>

    <span class="c1">#    def rowFormatter(self, listItem, spot):</span>
    <span class="c1">#        if spot.grainindex &lt;= -1:</span>
    <span class="c1">#            listItem.SetBackgroundColour((225, 0, 0, 0.5))</span>
    <span class="c1">#        elif spot.grainindex == 0:</span>
    <span class="c1">#            listItem.SetBackgroundColour(wx.GREEN)</span>
    <span class="c1">#        elif spot.grainindex &gt;= 1:</span>
    <span class="c1">#            listItem.SetBackgroundColour((0, int(255 * (1 - spot.grainindex / 9.)), 0))</span>

    <span class="k">def</span> <span class="nf">updateView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildlistofspots</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">InitObjectListView</span><span class="p">()</span>
            <span class="c1">#            if not self.showROIpeak.GetValue() and not self.showspecificgrains.GetValue():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showROIpeak</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">SetFilter</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="PeakListOLV.OnRemove"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.PeakListOLV.OnRemove">[docs]</a>    <span class="k">def</span> <span class="nf">OnRemove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; remove one element corresponding to the current highlighted row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grangranparent</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Peak List is empty&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1">#        print dir(self.myOlv)</span>
        <span class="n">selectedRowindices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDataSelected</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;selectedRowindices&quot;</span><span class="p">,</span> <span class="n">selectedRowindices</span><span class="p">)</span>

        <span class="n">peakXY</span> <span class="o">=</span> <span class="n">selectedRowindices</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grangranparent</span><span class="o">.</span><span class="n">onRemovePeaktoPeaklist</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">centerXY</span><span class="o">=</span><span class="n">peakXY</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">OnRemoveAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.peaklistPixels before&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grangranparent</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grangranparent</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">RemoveObjects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">GetObjects</span><span class="p">())</span>
        <span class="c1">#         self.buildlistofspots()</span>

        <span class="c1"># remove marker on image</span>
        <span class="c1">#         self.plotPeaks = True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grangranparent</span><span class="o">.</span><span class="n">OnReplot</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1">#         self.plotPeaks = False</span>

    <span class="c1">#         listpeaks = list(self.grangranparent.peaklistPixels)</span>
    <span class="c1">#         while len(listpeaks)&gt;=1:</span>
    <span class="c1">#             peak=listpeaks.pop()</span>
    <span class="c1">#             self.grangranparent.onRemovePeaktoPeaklist(1, centerXY=peak)</span>
    <span class="c1">#         print &quot;self.peaklistPixels after&quot;,self.grangranparent.peaklistPixels</span>

    <span class="k">def</span> <span class="nf">OnClickRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>

        <span class="n">newitemfocused</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">selectitem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">GetFocusedItem</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">selectitem</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focuseditem</span><span class="p">:</span>
            <span class="n">newitemfocused</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focuseditem</span> <span class="o">=</span> <span class="n">selectitem</span>
        <span class="k">if</span> <span class="n">selectitem</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># name = self.myOlv.GetItemText(selectitem)</span>
        <span class="c1">#        print &quot;hobby&quot;, self.myOlv.GetObjectAt(self.myOlv.GetFocusedRow())</span>
        <span class="c1">#        print &quot;name&quot;, name</span>
        <span class="c1">#        print &quot;selectitem&quot;, selectitem</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showROIpeak</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="c1"># crop image on peak</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OnShowPeak</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">newitemfocused</span><span class="p">:</span>
                <span class="c1"># remove the previous drawn rectangle</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">RemoveLastRectangle</span><span class="p">()</span>
            <span class="c1"># add marker around peak</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OnCrossToSeePeak</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getDataSelected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_selectedspots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">GetSelectedObjects</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.list_selectedspots&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_selectedspots</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;focus on &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">GetFocusedRow</span><span class="p">())</span>
        <span class="n">allselected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sspot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_selectedspots</span><span class="p">:</span>
            <span class="n">listval</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listoffields</span><span class="p">:</span>
                <span class="n">listval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sspot</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>

            <span class="n">allselected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listval</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">allselected</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getObjectAtRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">GetObjectAt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myOlv</span><span class="o">.</span><span class="n">GetFocusedRow</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">getXYatRow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">selected_spot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getObjectAtRow</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">listval</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listoffields</span><span class="p">:</span>
            <span class="n">listval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selected_spot</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">listval</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getXYfromClickOnRow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dataselected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDataSelected</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataselected</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># single selection</span>
            <span class="k">return</span> <span class="n">dataselected</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dataselected</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">OnCrossToSeePeak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getXYatRow</span><span class="p">()</span>

        <span class="c1">#        self.mainframe.reinit_aftercrop_draw()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">addPatchRectangle</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

        <span class="c1">#        self.mainframe.updatePlotTitle()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">OnShowPeak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showROIpeak</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>

            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getXYatRow</span><span class="p">()</span>

            <span class="c1">#            self.mainframe.toggleBtnCrop.SetLabel(&quot;UnCrop Data&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">CropIsOn</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">boxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">boxy</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxsizey</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()),</span>
                                                        <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxsizex</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()))</span>

            <span class="n">centeri</span><span class="p">,</span> <span class="n">centerj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">centery</span>
            <span class="n">boxi</span><span class="p">,</span> <span class="n">boxj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">boxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">boxy</span>

            <span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">,</span> <span class="n">jmax</span> <span class="o">=</span> <span class="p">(</span><span class="n">centeri</span> <span class="o">-</span> <span class="n">boxi</span><span class="p">,</span> <span class="n">centeri</span> <span class="o">+</span> <span class="n">boxi</span><span class="p">,</span> <span class="n">centerj</span> <span class="o">-</span> <span class="n">boxj</span><span class="p">,</span> <span class="n">centerj</span> <span class="o">+</span> <span class="n">boxj</span><span class="p">)</span>

            <span class="c1"># avoid to wrong indices when slicing the data</span>
            <span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">,</span> <span class="n">jmax</span> <span class="o">=</span> <span class="n">ImProc</span><span class="o">.</span><span class="n">check_array_indices</span><span class="p">(</span><span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">,</span> <span class="n">jmax</span><span class="p">,</span>
                                                            <span class="n">framedim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grangranparent</span><span class="o">.</span><span class="n">framedim</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">[</span><span class="n">imin</span><span class="p">:</span><span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">:</span><span class="n">jmax</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">reinit_aftercrop_draw</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">updatePlotTitle</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># show zoomed in region of peak is OFF</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">CropIsOn</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">dataimage_ROI</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">reinit_aftercrop_draw</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">addPeaksMarker</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">updatePlotTitle</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainframe</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>


<div class="viewcode-block" id="MainPeakSearchFrame"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame">[docs]</a><span class="k">class</span> <span class="nc">MainPeakSearchFrame</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to show CCD frame pixel intensities</span>
<span class="sd">    and provide tools for searching peaks</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_id</span><span class="p">,</span> <span class="n">_initialParameter</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span> <span class="o">=</span> <span class="n">_initialParameter</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;imagefilename&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LastLUT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;mapsLUT&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writefolder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;writefolder&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;CCDLabel&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stackedimages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;stackedimages&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;stackimageindex&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nbstackedimages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;Nbstackedimages&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbdigits</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">framedim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saturationvalue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fliprot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headeroffset</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataformat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_extension</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">DictLT</span><span class="o">.</span><span class="n">dict_CCD</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">peaks_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># peaklist results of peaksearch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_peakfit_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_index_increment</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roiindex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># loading LUTS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapsLUT</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">pcm</span><span class="o">.</span><span class="n">datad</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_r&quot;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapsLUT</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">BImageFilename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIRectangleselected</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steppresent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepmissing</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">justcheckedShowValues</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myplot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FileDialog</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bdirname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BlackListFilename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DetFilename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IminDisplayed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastinfo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxsize_fit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guessed_amplitude</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guessed_bkg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position_definition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># read data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getIndex_fromfilename</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imin_crop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jmin_crop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imax_crop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jmax_crop</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>
        <span class="c1"># initial displayed data(no background substraction)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data_display</span> <span class="o">=</span> <span class="s2">&quot;Raw Image&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># panels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">WXPYTHON3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RoiSelector</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">font3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">MODERN</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span><span class="p">)</span>
        <span class="c1"># default method and buttons layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firstdisplay</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># index of method</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">paramsHat</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">largehollowcircles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smallredcircles</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">CCDcalib</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gettime</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">OnFlyMode</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># widgets and layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createMenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreateStatusBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_main_panel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_figure_draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">createMenuBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">menubar</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>

        <span class="n">filemenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>

        <span class="n">menuCCDfileparams</span> <span class="o">=</span> <span class="n">filemenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="mi">5896</span><span class="p">,</span> <span class="s2">&quot;CCD File parameters&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;Open a board to choose paramters to read CCD image file&quot;</span><span class="p">)</span>
        <span class="n">filemenu</span><span class="o">.</span><span class="n">AppendSeparator</span><span class="p">()</span>
        <span class="n">openimagemenu</span> <span class="o">=</span> <span class="n">filemenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Open Image&quot;</span><span class="p">,</span> <span class="s2">&quot;Open binary CCD image file&quot;</span><span class="p">)</span>
        <span class="n">filemenu</span><span class="o">.</span><span class="n">AppendSeparator</span><span class="p">()</span>
        <span class="n">menuFileSeries</span> <span class="o">=</span> <span class="n">filemenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;File Series&quot;</span><span class="p">,</span>
                                                        <span class="s2">&quot;Launch the File Series Peak Search Board&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpenImage</span><span class="p">,</span> <span class="n">openimagemenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnSetFileCCDParam</span><span class="p">,</span> <span class="n">menuCCDfileparams</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnFileSeries</span><span class="p">,</span> <span class="n">menuFileSeries</span><span class="p">)</span>

        <span class="n">filemenu</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">5896</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">preferences</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">menuSetPreference</span> <span class="o">=</span> <span class="n">preferences</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;PeakList Folder&quot;</span><span class="p">,</span>
                                                        <span class="s2">&quot;Set folder to write peaklist .dat files&quot;</span><span class="p">)</span>
        <span class="n">menudisplayprops</span> <span class="o">=</span> <span class="n">preferences</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Set Plot Size&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;Set Minimal plot size to fit with small computer screen&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnFolderPreferences</span><span class="p">,</span> <span class="n">menuSetPreference</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnSetPlotSize</span><span class="p">,</span> <span class="n">menudisplayprops</span><span class="p">)</span>

        <span class="n">helpmenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>

        <span class="n">menuAbout</span> <span class="o">=</span> <span class="n">helpmenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ABOUT</span><span class="p">,</span> <span class="s2">&quot;&amp;About&quot;</span><span class="p">,</span> <span class="s2">&quot; Information about this program&quot;</span><span class="p">)</span>
        <span class="n">menuExit</span> <span class="o">=</span> <span class="n">helpmenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_EXIT</span><span class="p">,</span> <span class="s2">&quot;E&amp;xit&quot;</span><span class="p">,</span> <span class="s2">&quot; Terminate the program&quot;</span><span class="p">)</span>

        <span class="c1"># Set events.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnAbout</span><span class="p">,</span> <span class="n">menuAbout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnExit</span><span class="p">,</span> <span class="n">menuExit</span><span class="p">)</span>

        <span class="n">menubar</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">filemenu</span><span class="p">,</span> <span class="s2">&quot;&amp;File&quot;</span><span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">preferences</span><span class="p">,</span> <span class="s2">&quot;&amp;Preferences&quot;</span><span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">helpmenu</span><span class="p">,</span> <span class="s2">&quot;&amp;Help&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetMenuBar</span><span class="p">(</span><span class="n">menubar</span><span class="p">)</span>

<div class="viewcode-block" id="MainPeakSearchFrame.create_main_panel"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.create_main_panel">[docs]</a>    <span class="k">def</span> <span class="nf">create_main_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates the main panel with all the controls on it:</span>
<span class="sd">             * mpl canvas</span>
<span class="sd">             * mpl navigation toolbar</span>
<span class="sd">             * Control panel for interaction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Create the mpl Figure and FigCanvas objects.</span>
        <span class="c1"># 5x4 inches, 100 dots-per-inch</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figsize</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="n">forward</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">FigCanvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

        <span class="c1"># Since we have only one plot, we can use add_axes</span>
        <span class="c1"># instead of add_subplot, but then the subplot</span>
        <span class="c1"># configuration tool in the navigation toolbar wouldn&#39;t</span>
        <span class="c1"># work.</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s2">&quot;motion_notify_event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_move</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">WXPYTHON4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_PAINT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnPaint</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">EVT_PAINT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnPaint</span><span class="p">)</span>

        <span class="c1">#         self.tooltip = wx.ToolTip(tip=&#39;tip with a long %s line and a newline\n&#39; % (&#39; &#39; * 100))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ToolTip</span><span class="p">(</span><span class="n">tip</span><span class="o">=</span><span class="s2">&quot;Welcome on peaksearch board of LaueTools&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span><span class="o">.</span><span class="n">SetDelay</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s2">&quot;motion_notify_event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onMotion_ToolTip</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s2">&quot;button_press_event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onClick</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s2">&quot;key_press_event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onKeyPressed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s2">&quot;pick_event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onPick</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">WXPYTHON3</span><span class="p">:</span>
            <span class="c1"># drawtype is &#39;box&#39; or &#39;line&#39; or &#39;none&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RS</span> <span class="o">=</span> <span class="n">RectangleSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">line_select_callback</span><span class="p">,</span>
                                        <span class="n">drawtype</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">,</span>
                                        <span class="n">useblit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">button</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>  <span class="c1"># don&#39;t use middle button</span>
                                        <span class="n">minspanx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                        <span class="n">minspany</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                        <span class="n">spancoords</span><span class="o">=</span><span class="s2">&quot;pixels&quot;</span><span class="p">,</span>
                                        <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">numvalues_chck</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Show Values&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numvalues_chck</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># flag when asked to draw values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">justcheckedShowValues</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numvalues_chck</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnCheckPlotValues</span><span class="p">)</span>

        <span class="c1"># notebook on top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toplayout2</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nb</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Notebook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">localfitbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Fit Peak&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddPeak</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Add Peak&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemovePeak</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Remove Peak&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveAllPeaksbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Remove All Peaks&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">localfitbtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onFitOnePeak</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddPeak</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onAddPeaktoPeaklist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemovePeak</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onRemovePeaktoPeaklist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemoveAllPeaksbtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onRemoveAllPeakstoPeaklist</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_singlefitresults_chck</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;plot single fit results&quot;</span><span class="p">,</span>
                                                                                    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_singlefitresults_chck</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">allways_addpeak_chck</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;auto. add peak&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allways_addpeak_chck</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnOpenPeakList</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Open PeakLists&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnOpenPeakList</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onOpenPeakListBoard</span><span class="p">)</span>

        <span class="n">startbutton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Search All Peaks&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
        <span class="n">startbutton</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">MODERN</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span><span class="p">))</span>
        <span class="n">startbutton</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnPeakSearch</span><span class="p">)</span>
        <span class="n">savepeaklistbutton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Save PeakListc&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
        <span class="n">savepeaklistbutton</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SavePeakList_PSPfile</span><span class="p">)</span>

        <span class="n">savelistroibtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Save ROIs from Peaks&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
        <span class="n">savelistroibtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onSaveROIsList</span><span class="p">)</span>

        <span class="n">quitbutton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Quit&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
        <span class="n">quitbutton</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnQuit</span><span class="p">)</span>

        <span class="c1">#        self.page1 = PeakListPanel(nb)</span>
        <span class="c1">#        self.page1 = PeakListOLV(nb)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page1</span> <span class="o">=</span> <span class="n">findLocalMaxima_Meth_1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page2</span> <span class="o">=</span> <span class="n">findLocalMaxima_Meth_2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page3</span> <span class="o">=</span> <span class="n">findLocalMaxima_Meth_3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span> <span class="o">=</span> <span class="n">FitParametersPanel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ObjectListView_Present</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page4</span> <span class="o">=</span> <span class="n">PeakListOLV</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">)</span>  <span class="c1"># PeakListOLV</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">AddPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page1</span><span class="p">,</span> <span class="s2">&quot;1_Threshold&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">AddPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page2</span><span class="p">,</span> <span class="s2">&quot;1_ArrayShift&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">AddPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page3</span><span class="p">,</span> <span class="s2">&quot;1_Convolution&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">AddPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="p">,</span> <span class="s2">&quot;2_FitParams&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ObjectListView_Present</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">AddPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page4</span><span class="p">,</span> <span class="s2">&quot;PeakNavigator&quot;</span><span class="p">)</span>

        <span class="c1"># TODO bind with self.Show_Image ?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_NOTEBOOK_PAGE_CHANGED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnTabChange_PeakSearchMethod</span><span class="p">)</span>
        <span class="c1">#        self.nb.GetPosition()</span>

        <span class="c1"># LAYOUT -------------------------------------------</span>
        <span class="n">vbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">GROW</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="n">btnSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">localfitbtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">AddSpacer</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AddPeak</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RemovePeak</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RemoveAllPeaksbtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">AddSpacer</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">startbutton</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">savepeaklistbutton</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">savelistroibtn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">AddSpacer</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">quitbutton</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">btnSizer2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">btnSizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_singlefitresults_chck</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">)</span>
        <span class="n">btnSizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allways_addpeak_chck</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">)</span>
        <span class="n">btnSizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numvalues_chck</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">)</span>
        <span class="n">btnSizer2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnOpenPeakList</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">)</span>

        <span class="n">vbox2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">vbox2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">vbox2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">hbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vbox</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vbox2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="n">vboxgeneral</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">vboxgeneral</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">hbox</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">vboxgeneral</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnSizer2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">vboxgeneral</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnSizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">vboxgeneral</span><span class="p">)</span>
        <span class="n">vboxgeneral</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>

        <span class="c1"># tooltips</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">localfitbtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s1">&#39;Fit peak position close the last clicked point in &#39;</span>
                        <span class="s1">&#39;image (or press &quot;f&quot;).</span><span class="se">\n</span><span class="s1"> ROI size is set by the boxsize in fitparams tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddPeak</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Add single fitted peak in current list of peaks&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RemovePeak</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s1">&#39;Remove nearest peak from clicked position on plot &#39;</span>
                                            <span class="s1">&#39;(or press &quot;r&quot;).&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_singlefitresults_chck</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Display data pixel intensities and &quot;</span>
                                                        <span class="s2">&quot;fitted gaussian peak.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allways_addpeak_chck</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Always add the fitted peak to the current &quot;</span>
                                                    <span class="s2">&quot;list of peaks.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numvalues_chck</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Draw numerical data values if field of view is &quot;</span>
                                            <span class="s2">&quot;smaller than 25 pixels&quot;</span><span class="p">)</span>

        <span class="n">allpeaks_tp</span> <span class="o">=</span> <span class="s2">&quot;Search all peaks in CURRENT DISPLAYED image.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">allpeaks_tp</span> <span class="o">+=</span> <span class="s2">&quot;1- Find local maxima by using one of the three methods</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">allpeaks_tp</span> <span class="o">+=</span> <span class="s2">&quot;(Threshold, ArrayShift, Convolution) whose parameters are defined in &quot;</span>
        <span class="s2">&quot;respective tabs</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">allpeaks_tp</span> <span class="o">+=</span> <span class="s2">&quot;2- Fit all local maxima (or not) by 2D shaped intensity peak model. &quot;</span>
        <span class="s2">&quot;Parameters are defined in FitParams tab</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">startbutton</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">allpeaks_tp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnOpenPeakList</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ToolTip</span><span class="p">(</span><span class="s2">&quot;Select and plot peaks contained in .dat or .fit file&quot;</span><span class="p">))</span>

        <span class="n">savepeaklistbutton</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Save current peaks list in a file (with incremented name)&quot;</span><span class="p">)</span>
        <span class="n">savelistroibtn</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s1">&#39;Save current peaks list as a list of ROI with current boxsize used in fitparams&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">page1</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Guess initial peaks positions for peak refinement by &quot;</span>
        <span class="s2">&quot;a basic image thresholding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page2</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Guess initial peaks positions for peak refinement by &quot;</span>
        <span class="s2">&quot;array shifting&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page3</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Guess initial peaks positions for peak refinement by &quot;</span>
        <span class="s2">&quot;peak-kernel like convolution&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.toplayout2"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.toplayout2">[docs]</a>    <span class="k">def</span> <span class="nf">toplayout2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        init top notebook tabs for image visualisation and processing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Notebook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span> <span class="o">=</span> <span class="n">ViewColorPanel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span> <span class="o">=</span> <span class="n">FilterBackGroundPanel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span> <span class="o">=</span> <span class="n">BrowseCropPanel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span> <span class="o">=</span> <span class="n">MosaicAndMonitor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">WXPYTHON3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RoiSelector</span> <span class="o">=</span> <span class="n">ROISelection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="o">.</span><span class="n">AddPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="p">,</span> <span class="s2">&quot;View &amp;&amp; Color&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="o">.</span><span class="n">AddPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="p">,</span> <span class="s2">&quot;ImageFilter&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="o">.</span><span class="n">AddPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="p">,</span> <span class="s2">&quot;Browse &amp;&amp; Crop&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="o">.</span><span class="n">AddPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="p">,</span> <span class="s2">&quot;Mosaic &amp;&amp; Monitor&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">WXPYTHON3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="o">.</span><span class="n">AddPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RoiSelector</span><span class="p">,</span> <span class="s2">&quot;ROIs Selector&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_NOTEBOOK_PAGE_CHANGED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnTabChange_nb0</span><span class="p">)</span>

        <span class="c1"># tooltips</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;View and Colors parameters&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Digital image processing to remove Background or undesired peaks&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Browse a set of images arranged in a array over lines  or columns&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Monitor and Tracks a selected ROI properties over the data set&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">WXPYTHON3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RoiSelector</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Pixel ROIs Selector from current peaks list of manual selection&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.line_select_callback"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.line_select_callback">[docs]</a>    <span class="k">def</span> <span class="nf">line_select_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eclick</span><span class="p">,</span> <span class="n">erelease</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;eclick and erelease are the press and release events&quot;&quot;&quot;</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">eclick</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">eclick</span><span class="o">.</span><span class="n">ydata</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">erelease</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">erelease</span><span class="o">.</span><span class="n">ydata</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;(</span><span class="si">%3.2f</span><span class="s2">, </span><span class="si">%3.2f</span><span class="s2">) --&gt; (</span><span class="si">%3.2f</span><span class="s2">, </span><span class="si">%3.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot; The button you used were: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">eclick</span><span class="o">.</span><span class="n">button</span><span class="p">,</span> <span class="n">erelease</span><span class="o">.</span><span class="n">button</span><span class="p">)))</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.OnTabChange_nb0"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.OnTabChange_nb0">[docs]</a>    <span class="k">def</span> <span class="nf">OnTabChange_nb0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        handling changing tab of top notebook</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#selected_tab = self.nb0.GetSelection()</span>
        <span class="c1"># print(&quot;selected tab:&quot;, selected_tab)</span>
        <span class="c1"># print(self.nb0.GetPage(self.nb0.GetSelection()))</span>
        <span class="c1"># print(self.nb0.GetPage(self.nb0.GetSelection()).GetName())</span>

        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>  <span class="c1"># patch for windows to update the tab display</span></div>

    <span class="k">def</span> <span class="nf">OnTabChange_PeakSearchMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1">#        print &#39;tab changed&#39;</span>
        <span class="n">selected_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
        <span class="c1">#         print &quot;selected tab:&quot;, selected_tab</span>
        <span class="c1">#         print self.nb.GetPage(self.nb.GetSelection())</span>
        <span class="c1">#         print self.nb.GetPage(self.nb.GetSelection()).GetName()</span>

        <span class="c1"># display raw data or convolved data</span>
        <span class="k">if</span> <span class="n">selected_tab</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">selected_tab</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,):</span>
            <span class="c1">#            print &quot;self.page3.TogglebtnState&quot;, self.page3.TogglebtnState</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">page3</span><span class="o">.</span><span class="n">TogglebtnState</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># current plot of convolved data</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">getConvolvedData</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Show_ConvolvedImage</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># current plot of raw data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reinit_aftercrop_draw</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addPeaksMarker</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">updatePlotTitle</span><span class="p">(</span><span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;Raw Image&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="c1"># enable or disable position peak results (centroid or hot pixels)</span>
        <span class="k">if</span> <span class="n">selected_tab</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">keepCentroid</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">keepHottestPixel</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">keepHottestPixel</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">selected_tab</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">keepCentroid</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">keepHottestPixel</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">selected_tab</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;selected fitting param panel&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">selected_tab</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ObjectListView_Present</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">page4</span><span class="o">.</span><span class="n">updateView</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>  <span class="c1"># patch for windows OS to update the tab display</span>

    <span class="k">def</span> <span class="nf">OnAbout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span>
            <span class="s1">&#39;Peak Search GUI from Lauetools Package</span><span class="se">\n</span><span class="s1"> Jan 2019.</span><span class="se">\n</span><span class="s1"> Please contact staff of beamline CRG-IF BM32 at ESRF or micha&quot;_at_&quot;esrf&quot;_dot_&quot;fr&#39;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnExit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">OnQuit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

<div class="viewcode-block" id="MainPeakSearchFrame.askUserForDirname"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.askUserForDirname">[docs]</a>    <span class="k">def</span> <span class="nf">askUserForDirname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        provide a dialog to browse the folders and files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">DirDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Choose folder for results .dat file&quot;</span><span class="p">,</span> <span class="n">defaultPath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">userProvidedFilename</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># self.filename = dialog.GetFilename()</span>
            <span class="c1"># #self.dirname = dialog.GetDirectory()</span>

            <span class="n">allpath</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">allpath</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writefolder</span> <span class="o">=</span> <span class="n">allpath</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">userProvidedFilename</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">userProvidedFilename</span></div>

    <span class="k">def</span> <span class="nf">OpenImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="c1"># wcd0 = &quot;All files(*)|*|MAR CCD image(*.mccd)|*.mccd|mar tiff(*.tiff)|*.tiff|mar tif(*.tif)|*.tif|Princeton(*.spe)|*.spe|Frelon(*.edf)|*.edf&quot;</span>

        <span class="n">filepath_dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Select binary image file&quot;</span><span class="p">,</span>
                                                <span class="n">wildcard</span><span class="o">=</span><span class="n">DictLT</span><span class="o">.</span><span class="n">getwildcardstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">filepath_dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>

            <span class="n">abspath</span> <span class="o">=</span> <span class="n">filepath_dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">abspath</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">abspath</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;imagefilename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dirname</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="n">dirname</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">getIndex_fromfilename</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resetfilename_and_plot</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">UseImage</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">imageBctrl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="MainPeakSearchFrame.OnSetFileCCDParam"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.OnSetFileCCDParam">[docs]</a>    <span class="k">def</span> <span class="nf">OnSetFileCCDParam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enter manually CCD file params</span>
<span class="sd">        Launch Entry dialog</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DPBoard</span> <span class="o">=</span> <span class="n">CCDParamGUI</span><span class="o">.</span><span class="n">CCDFileParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;CCD File Parameters Board&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">)</span>
        <span class="n">DPBoard</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="n">DPBoard</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">OnFileSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;not implemented yet. Use better FileSeries/peak_search.py&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnFolderPreferences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">askUserForDirname</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Peak list .dat file will be written in:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">writefolder</span><span class="p">)</span>

<div class="viewcode-block" id="MainPeakSearchFrame.OnSetPlotSize"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.OnSetPlotSize">[docs]</a>    <span class="k">def</span> <span class="nf">OnSetPlotSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set marker size</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;not implemented yet&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.onClick"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.onClick">[docs]</a>    <span class="k">def</span> <span class="nf">onClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; onclick</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;current clicked positions&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#                 print &quot;current local clicked positions&quot;, self.centerx, self.centery</span>
                <span class="c1">#                 print self.imin_crop, self.imax_crop, self.jmin_crop, self.jmax_crop</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">centerx</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jmin_crop</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">centery</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imin_crop</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new clicked positions (crop mode)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">showprofiles</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="MainPeakSearchFrame.onPick"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.onPick">[docs]</a>    <span class="k">def</span> <span class="nf">onPick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; on pick &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">artist</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">artist</span>

            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;onPick Rectangle label:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span><span class="o">.</span><span class="n">get_label</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;onPick Rectangle gid:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span><span class="o">.</span><span class="n">get_gid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;onPick Rectangle picker:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span><span class="o">.</span><span class="n">get_picker</span><span class="p">()))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ROIRectangleselected</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">toggle_selector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Key pressed.a or A&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; RectangleSelector deactivated.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; RectangleSelector activated.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="MainPeakSearchFrame.onKeyPressed"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.onKeyPressed">[docs]</a>    <span class="k">def</span> <span class="nf">onKeyPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle key pressed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;key ==&gt; &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;escape&quot;</span><span class="p">:</span>

            <span class="n">ret</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Are you sure to quit?&quot;</span><span class="p">,</span> <span class="s2">&quot;Question&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">YES_NO</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">NO_DEFAULT</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">YES</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>  <span class="c1"># &#39;s&#39;</span>
            <span class="c1">#            self.timer.Stop()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">)</span>

        <span class="c1"># fit 2D array of pixel intensity centered on click region</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;f&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onFitOnePeak</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># remove peaks close to the region</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onRemovePeaktoPeaklist</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>  <span class="c1"># &#39;c&#39;  continue</span>
            <span class="c1">#            self.imageindex = STARTINDEX</span>
            <span class="c1">#            self.timer.Start(100)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;now CropIsOn is &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">activateCrop</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">readdata_updateplot_aftercrop_uncrop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span>  <span class="c1"># &#39;c&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;zoom&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>  <span class="c1"># &#39;l&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pressed +&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;shift&quot;</span><span class="p">:</span>  <span class="c1"># &#39;l&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shift is pressed&quot;</span><span class="p">)</span>

        <span class="c1"># active or not the mode of rectangle selection for pixel ROI</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">WXPYTHON3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_selector</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c1"># memorize current pixel ROI</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">WXPYTHON3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">roiindex</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.roiindex&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">roiindex</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pressed on q or Q&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;save and draw selected ROI&quot;</span><span class="p">)</span>
                <span class="c1"># print self.RS.extents</span>
                <span class="c1">#                 print dir(self.RS)</span>
                <span class="c1">#                 print dir(self.RS.artists)</span>

                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">extents</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">extents</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">extents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">extents</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">extents</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">extents</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                <span class="n">rectboxproperties</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">roiindex</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">ROIs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roiindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">rectboxproperties</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new ROI&quot;</span><span class="p">,</span> <span class="n">rectboxproperties</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># no rectangle drawn, just a clicked pixel. So building a rectangle</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">width</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centery</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;single click ROI&quot;</span><span class="p">)</span>

                <span class="n">halfboxx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RoiSelector</span><span class="o">.</span><span class="n">boxxctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="n">halfboxy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RoiSelector</span><span class="o">.</span><span class="n">boxyctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

                <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">halfboxy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">halfboxx</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xc</span> <span class="o">-</span> <span class="n">halfboxx</span><span class="p">,</span> <span class="n">yc</span> <span class="o">-</span> <span class="n">halfboxy</span>

                <span class="n">rectboxproperties</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="o">-</span><span class="n">height</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">roiindex</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ROIs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roiindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">rectboxproperties</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new ROI&quot;</span><span class="p">,</span> <span class="n">rectboxproperties</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addPatchRectangleROI</span><span class="p">(</span><span class="n">rectboxproperties</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;updated ROIs&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROIs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_draw</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c1"># delete selected ROI</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">WXPYTHON3</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROIRectangleselected</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.ROIS before&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROIs</span><span class="p">)</span>
                <span class="c1"># print dir(self.axes)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I will delete this ROI&quot;</span><span class="p">)</span>
                <span class="c1">#                 print dir(self.currentROIpatch)</span>
                <span class="c1">#                 print &quot;extents&quot;,self.currentROIpatch.get_extents()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span><span class="o">.</span><span class="n">get_x</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span><span class="o">.</span><span class="n">get_y</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span><span class="o">.</span><span class="n">get_height</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span><span class="o">.</span><span class="n">get_width</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span><span class="o">.</span><span class="n">get_label</span><span class="p">())</span>

                <span class="n">label_roiindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span><span class="o">.</span><span class="n">get_label</span><span class="p">())</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROIs</span><span class="p">[</span><span class="n">label_roiindex</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="ow">is</span> <span class="s2">&quot;visible&quot;</span><span class="p">:</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing &quot;</span><span class="p">,</span> <span class="n">label_roiindex</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">currentROIpatch</span><span class="o">.</span><span class="n">set_picker</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">ROIs</span><span class="p">[</span><span class="n">label_roiindex</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;invisible&quot;</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.ROIS after&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROIs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;caught invisible rectangle&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_draw</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c1">#             self.OnReplot(1)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">WXPYTHON3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.ROIs&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROIs</span><span class="p">)</span>
            <span class="n">visibleROIs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROIs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="s2">&quot;visible&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ROI property&quot;</span><span class="p">)</span>
                    <span class="n">visibleROIs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;visibleROIs&quot;</span><span class="p">,</span> <span class="n">visibleROIs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.gettime"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.gettime">[docs]</a>    <span class="k">def</span> <span class="nf">gettime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set self.currentime to current time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">getdeltatime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;deltatime: </span><span class="si">%.3f</span><span class="s2"> second(s)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentime</span><span class="p">))</span>

<div class="viewcode-block" id="MainPeakSearchFrame.onToggle"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.onToggle">[docs]</a>    <span class="k">def</span> <span class="nf">onToggle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        handling on auto index button</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steppresent</span> <span class="o">=</span> <span class="mi">1500</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepmissing</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">IsRunning</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">toggleBtn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;On Fly&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;timer stopped!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start to on-fly images viewing mode  ----------------&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">toggleBtn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Wait!...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OnFlyMode</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># loop for already present data</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steppresent</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>

            <span class="c1"># timer loop for missing data</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*******  WAITING DATA   !!!! *********&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stepmissing</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">toggleBtn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Stop&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.onToggleCrop"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.onToggleCrop">[docs]</a>    <span class="k">def</span> <span class="nf">onToggleCrop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;activate/deactivate crop image mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># crop already enabled</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">toggleBtnCrop</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Crop Data&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">toggleBtnCrop</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;UnCrop Data&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activateCrop</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">readdata_updateplot_aftercrop_uncrop</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.update"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update at each time step time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">updated: &quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CurrentFileIsReady</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Show_Image</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setfilename</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;waiting for image   :</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">)</span>
            <span class="c1"># stop the first timer</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    <span class="c1"># --- -------  Open File and Navigate on Data Set</span>
<div class="viewcode-block" id="MainPeakSearchFrame.CurrentFileIsReady"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.CurrentFileIsReady">[docs]</a>    <span class="k">def</span> <span class="nf">CurrentFileIsReady</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return True if self.imagefilename is in folder and entire (correct size)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">condexist</span> <span class="o">=</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.currentfilename in CurrentFileIsReady&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="c1">#        print &quot;self.dirname&quot;, self.dirname</span>
        <span class="k">if</span> <span class="n">condexist</span><span class="p">:</span>

            <span class="n">condsize</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">))[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2101248</span>
            <span class="k">if</span> <span class="n">condsize</span><span class="p">:</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;file present and correct size!&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">condition</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.getIndex_fromfilename"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.getIndex_fromfilename">[docs]</a>    <span class="k">def</span> <span class="nf">getIndex_fromfilename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get index of image from the image filename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_with_index</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span> <span class="o">=</span> <span class="n">IOimage</span><span class="o">.</span><span class="n">getIndex_fromfilename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span>
            <span class="n">CCDLabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">,</span> <span class="n">stackimageindex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span><span class="p">,</span> <span class="n">nbdigits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nbdigits</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_with_index</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;************</span><span class="se">\n\n\n</span><span class="s2">self.imageindex </span><span class="si">%d</span><span class="s2"> </span><span class="se">\n\n</span><span class="s2">****************&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.setfilename"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.setfilename">[docs]</a>    <span class="k">def</span> <span class="nf">setfilename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set filename from self.imagefilename, self.imageindex,</span>
<span class="sd">                                                    CCDLabel=self.CCDlabel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_with_index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span> <span class="o">=</span> <span class="n">IOimage</span><span class="o">.</span><span class="n">setfilename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span><span class="p">,</span>
                                                    <span class="n">CCDLabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">,</span> <span class="n">nbdigits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nbdigits</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">OnStepChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">stepindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">stepctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="n">stepindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">stepindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">largeplusbtn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;index +</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stepindex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">largeminusbtn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;index -</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stepindex</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">slider_image</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span> <span class="o">%</span> <span class="n">stepindex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">slider_image</span><span class="o">.</span><span class="n">SetMax</span><span class="p">(</span><span class="n">stepindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">slider_imagevert</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span> <span class="o">//</span> <span class="n">stepindex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">slider_imagevert</span><span class="o">.</span><span class="n">SetMax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">imageindexmax</span> <span class="o">//</span> <span class="n">stepindex</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnChangeImageMin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">OnChangeImageMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">imagemax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">imagemaxtxtctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">stepindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">stepctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="n">stepindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">stepindex</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">slider_imagevert</span><span class="o">.</span><span class="n">SetMax</span><span class="p">(</span><span class="n">imagemax</span> <span class="o">//</span> <span class="n">stepindex</span><span class="p">)</span>

<div class="viewcode-block" id="MainPeakSearchFrame.OnLargePlus"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.OnLargePlus">[docs]</a>    <span class="k">def</span> <span class="nf">OnLargePlus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;increase self.imageindex by self.stepindex (vertical descending in sample raster scan)</span>
<span class="sd">        and read new image and plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#        print self.canvas.GetRect()</span>
        <span class="c1">#        print self.canvas.GetScreenRect()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">stepctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetfilename_and_plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.OnLargeMinus"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.OnLargeMinus">[docs]</a>    <span class="k">def</span> <span class="nf">OnLargeMinus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;decrease self.imageindex by self.stepindex (vertical ascendindg in sample raster scan)</span>
<span class="sd">        and read new image and plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">stepctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetfilename_and_plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.OnPlus"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.OnPlus">[docs]</a>    <span class="k">def</span> <span class="nf">OnPlus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;increase  self.imageindex by 1 (horizontal ascending to the right in sample raster scan)</span>
<span class="sd">        and read new image and plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">GetRect</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">GetScreenRect</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackedimages</span><span class="p">:</span>
            <span class="c1">#         if self.CCDlabel in (&#39;EIGER_4Mstack&#39;,):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nbstackedimages</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resetfilename_and_plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.OnMinus"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.OnMinus">[docs]</a>    <span class="k">def</span> <span class="nf">OnMinus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;decrease  self.imageindex by 1 (horizontal descending to the left in sample raster scan)</span>
<span class="sd">        and read new image and plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackedimages</span><span class="p">:</span>
            <span class="c1">#         if self.CCDlabel in (&#39;EIGER_4Mstack&#39;,):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nbstackedimages</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resetfilename_and_plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.OnGoto"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.OnGoto">[docs]</a>    <span class="k">def</span> <span class="nf">OnGoto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read image with selected self.imageindex and plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackedimages</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">fileindexctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nbstackedimages</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">fileindexctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resetfilename_and_plot</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">onChangeIndex_slider_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">stepctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.ImagesBrowser.slider_image.GetValue()&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">slider_image</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.imageindex before&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackedimages</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1">#             self.stackimageindex=int(self.ImagesBrowser.fileindexctrl.GetValue())</span>
        <span class="c1">#             self.stackimageindex=(self.stackimageindex%self.Nbstackedimages)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">slider_image</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span> <span class="o">+</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">slider_imagevert</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.imageindex after&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resetfilename_and_plot</span><span class="p">()</span>

<div class="viewcode-block" id="MainPeakSearchFrame.onChangeIndex_slider_imagevert"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.onChangeIndex_slider_imagevert">[docs]</a>    <span class="k">def</span> <span class="nf">onChangeIndex_slider_imagevert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plot new image obtained by new index changed by vertical (slow axis) slider</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">stepctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.ImagesBrowser.slider_imagevert.GetValue()&quot;</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">slider_imagevert</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackedimages</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1">#             self.stackimageindex=int(self.ImagesBrowser.fileindexctrl.GetValue())</span>
        <span class="c1">#             self.stackimageindex=(self.stackimageindex%self.Nbstackedimages)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imageindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">slider_image</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepindex</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">slider_imagevert</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resetfilename_and_plot</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">resetfilename_and_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;***   resetfilename_and_plot   *****&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.CCDLabel&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">)</span>

        <span class="n">nbd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">nbdigitsctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nbdigits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nbdigits</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setfilename</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">FilterImage</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">ImageType</span> <span class="o">==</span> <span class="s2">&quot;Raw&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.ImageFilterpanel.ImageType == &#39;Raw&#39;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">blurimage</span> <span class="o">=</span> <span class="n">ImProc</span><span class="o">.</span><span class="n">compute_autobackground_image</span><span class="p">(</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">,</span> <span class="n">boxsizefilter</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">Computefilteredimage</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">showImage</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">UseImage</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">ImageType</span> <span class="o">==</span> <span class="s2">&quot;Raw&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnUseFormula</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Show_Image</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;Raw Image&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">OnChangeUseFormula</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gettime</span><span class="p">()</span>
        <span class="c1">#         self.dataimage_ROI_display = self.dataimage_ROI</span>

        <span class="c1">#         self.Show_Image(1)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new image display execution time :&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getdeltatime</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">updateLineXYProfile</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#         self.viewingLUTpanel.OnShowLineXYProfiler(1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">updateLineProfile</span><span class="p">()</span>

<div class="viewcode-block" id="MainPeakSearchFrame.read_data"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.read_data">[docs]</a>    <span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secondaryImage</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">secondaryImagefilename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read binary image file</span>

<span class="sd">        if secondaryImage update</span>
<span class="sd">            self.dataimage_ROI_B</span>
<span class="sd">        else update</span>
<span class="sd">            self.dataimage_ROI</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">secondaryImage</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading image data:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Directory :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filename :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">)</span>

            <span class="n">imagefilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading B image data:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Directory :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filename :&quot;</span><span class="p">,</span> <span class="n">secondaryImagefilename</span><span class="p">)</span>

            <span class="n">imagefilename</span> <span class="o">=</span> <span class="n">secondaryImagefilename</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">imagefilename</span><span class="p">)</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">framedim</span><span class="p">,</span>
            <span class="n">_</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saturationvalue</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fliprot</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
            <span class="n">_</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extension</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">DictLT</span><span class="o">.</span><span class="n">dict_CCD</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;CCDLabel&quot;</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">extension</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;warning : file extension does not match CCD type set in Set CCD File Parameters&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span> <span class="o">==</span> <span class="s2">&quot;LaueImaging&quot;</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">paramsHat</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CCD label in PeakSearchGUI: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">)</span>

        <span class="c1">#         nolog = wx.LogNull()</span>
        <span class="c1">#         self.gettime()</span>
        <span class="n">dataimage</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">IOimage</span><span class="o">.</span><span class="n">readCCDimage</span><span class="p">(</span><span class="n">imagefilename</span><span class="p">,</span>
                                                        <span class="n">CCDLabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">,</span>
                                                        <span class="n">dirname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">,</span>
                                                        <span class="n">stackimageindex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">secondaryImage</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_B</span> <span class="o">=</span> <span class="n">dataimage</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># type np.int to test with cython module arr.pyx</span>
            <span class="c1">#             self.dataimage_ROI = dataimage.astype(np.int)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span> <span class="o">=</span> <span class="n">dataimage</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span><span class="p">:</span>

            <span class="n">xpic</span><span class="p">,</span> <span class="n">ypic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span> <span class="o">=</span> <span class="n">IOimage</span><span class="o">.</span><span class="n">readrectangle_in_image</span><span class="p">(</span><span class="n">imagefilename</span><span class="p">,</span>
                                                                <span class="n">xpic</span><span class="p">,</span>
                                                                <span class="n">ypic</span><span class="p">,</span>
                                                                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxx</span><span class="p">),</span>
                                                                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boxy</span><span class="p">),</span>
                                                                <span class="n">dirname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">,</span>
                                                                <span class="n">CCDLabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;sCMOS&quot;</span><span class="p">,</span> <span class="s2">&quot;sCMOS_fliplr&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmin</span> <span class="o">=</span> <span class="mi">1000</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmax</span> <span class="o">=</span> <span class="mi">5000</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vminmax</span> <span class="o">=</span> <span class="mi">2000</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmaxmax</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmin</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmax</span> <span class="o">=</span> <span class="mi">1000</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vminmax</span> <span class="o">=</span> <span class="mi">300</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vmaxmax</span> <span class="o">=</span> <span class="mi">2000</span></div>

    <span class="c1"># ---   --- DISPLAY IMAGE</span>
<div class="viewcode-block" id="MainPeakSearchFrame.OnCheckPlotValues"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.OnCheckPlotValues">[docs]</a>    <span class="k">def</span> <span class="nf">OnCheckPlotValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;enable or disable drawing of numerical pixel intensity value on plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numvalues_chck</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">justcheckedShowValues</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">justcheckedShowValues</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.justcheckedShowValues in OnCheckPlotValues &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">justcheckedShowValues</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">numvalues_chck</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">texts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">texts</span><span class="p">:</span>
                    <span class="n">txt</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PlotValues</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.PlotValues"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.PlotValues">[docs]</a>    <span class="k">def</span> <span class="nf">PlotValues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw numerical pixel intensity value on plot</span>
<span class="sd">        if self.numvalues_chck is True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">numvalues_chck</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">texts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">texts</span><span class="p">:</span>
                <span class="n">txt</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDisplayedImageSize</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">25</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="c1">#             wx.MessageBox(&#39;Field of view of pixel intensities is too large! Please zoom in!&#39;,&#39;info&#39;)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Field of view of pixel intensities is too large!&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Add new drawn values on plot</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ymax</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">ymin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">xmin</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">xmax</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="c1">#                 print &quot;label&quot;,label</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

        <span class="c1">#         print &quot;fig.texts&quot;,self.fig.texts # is a list of Text objects</span>
        <span class="c1">#         print &quot;len(axes.texts)&quot;,len(self.axes.texts) # is a list of Text objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">justcheckedShowValues</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.init_figure_draw"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.init_figure_draw">[docs]</a>    <span class="k">def</span> <span class="nf">init_figure_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; init the figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># clear the axes and redraw the plot anew</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1">#        self.axes.set_autoscale_on(False) # Otherwise, infinite loop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_autoscale_on</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">IminDisplayed</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># highest pixel intensity</span>
        <span class="c1">#        self.ImaxDisplayed = DictLT.dict_CCD[self.CCDlabel][2]</span>
        <span class="c1"># value defined</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">vmaxctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span><span class="p">,</span>  <span class="c1"># aspect = &#39;equal&#39;,</span>
                                    <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span>
                                    <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IminDisplayed</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span><span class="p">))</span>

        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackedimages</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">sstack index </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="c1"># self.myplot.set_clim=(1,200)  # work?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myplot</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">comboLUT</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myplot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalizeplot</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.Show_Image"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.Show_Image">[docs]</a>    <span class="k">def</span> <span class="nf">Show_Image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;Raw Image&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        show self.dataimage_ROI_display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data_display</span> <span class="o">=</span> <span class="s2">&quot;Raw Image&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updatePlotTitle</span><span class="p">(</span><span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myplot</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">OnSpinCtrl_ImaxDisplayed</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c1"># update line profiler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">showprofiles</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PlotValues</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.Show_ConvolvedImage"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.Show_ConvolvedImage">[docs]</a>    <span class="k">def</span> <span class="nf">Show_ConvolvedImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;Convolved Image&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set displayed data to be convolved data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculate Convolved Data&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getConvolvedData</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Use already computed Convolved data&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">page3</span><span class="o">.</span><span class="n">Applythreshold</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span><span class="p">,</span>
                                            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page3</span><span class="o">.</span><span class="n">ThresholdConvolveCtrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()),</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getConvolvedData</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_data_display</span> <span class="o">=</span> <span class="s2">&quot;Convolved Image&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updatePlotTitle</span><span class="p">(</span><span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myplot</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">OnSpinCtrl_ImaxDisplayed</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.updatePlotTitle"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.updatePlotTitle">[docs]</a>    <span class="k">def</span> <span class="nf">updatePlotTitle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;update plot title</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">datatype</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">datatype</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">titlestring</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span> <span class="n">datatype</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackedimages</span><span class="p">:</span>
            <span class="n">titlestring</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">sstack index </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span>
        <span class="k">if</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># not self.OnFlyMode:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nbpeaks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nbpeaks</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">titlestring</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%d</span><span class="s2"> peaks&quot;</span> <span class="o">%</span> <span class="n">nbpeaks</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_data_display</span> <span class="o">==</span> <span class="s2">&quot;Raw Image&quot;</span><span class="p">:</span>

                <span class="n">MaxI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span><span class="p">)</span>
                <span class="n">titlestring</span> <span class="o">+=</span> <span class="s2">&quot;  max I= </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MaxI</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titlestring</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.normalizeplot"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.normalizeplot">[docs]</a>    <span class="k">def</span> <span class="nf">normalizeplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;normalize current displayed array according to vmin vmax sliders</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IminDisplayed</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myplot</span><span class="o">.</span><span class="n">set_norm</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span></div>

    <span class="c1">#        self.myplot.set_clim(self.IminDisplayed, self.ImaxDisplayed)</span>

<div class="viewcode-block" id="MainPeakSearchFrame.update_draw"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.update_draw">[docs]</a>    <span class="k">def</span> <span class="nf">update_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;update 2D plot taken into account change of LUT table and vmin vamax values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#        if self.data_2D == None:</span>
        <span class="c1">#            return</span>
        <span class="c1">#</span>
        <span class="c1">#        self.ReadData()</span>
        <span class="c1">#        self.myplot.set_data(self.data_2D)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnFlyMode</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">normalizeplot</span><span class="p">()</span>
        <span class="c1">#            print &#39;normalized data for plot ---&#39;,</span>
        <span class="c1">#            self.getdeltatime()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PlotValues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.getDisplayedImageSize"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.getDisplayedImageSize">[docs]</a>    <span class="k">def</span> <span class="nf">getDisplayedImageSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get xmin, xmax, ymin, ymax from current displayed image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># bbox = self.axes.get_window_extent().transformed(self.fig.dpi_scale_trans.inverted())</span>

        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.set_circleradius"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.set_circleradius">[docs]</a>    <span class="k">def</span> <span class="nf">set_circleradius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artists</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        self.set_circleradius(self.viewingLUTpanel.drg.artists)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDisplayedImageSize</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xmin, xmax, ymin, ymax&quot;</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">xmin</span> <span class="o">-</span> <span class="n">xmax</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymin</span> <span class="o">-</span> <span class="n">ymax</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2048.0</span> <span class="o">*</span> <span class="mi">50</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
            <span class="n">artist</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">r</span></div>

    <span class="c1"># ---  Crop Data</span>
<div class="viewcode-block" id="MainPeakSearchFrame.activateCrop"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.activateCrop">[docs]</a>    <span class="k">def</span> <span class="nf">activateCrop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set boxx and boxy from ctrls</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">boxxctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImagesBrowser</span><span class="o">.</span><span class="n">boxyctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.boxx,self.boxy&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boxy</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.readdata_updateplot_aftercrop_uncrop"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.readdata_updateplot_aftercrop_uncrop">[docs]</a>    <span class="k">def</span> <span class="nf">readdata_updateplot_aftercrop_uncrop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;read data and update data to be displayed and redraw</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reinit_aftercrop_draw</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updatePlotTitle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.reinit_aftercrop_draw"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.reinit_aftercrop_draw">[docs]</a>    <span class="k">def</span> <span class="nf">reinit_aftercrop_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reinit the figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># clear the axes and redraw the plot anew</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span><span class="p">,</span>  <span class="c1"># aspect = &#39;equal&#39;,</span>
                                    <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span>
                                    <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IminDisplayed</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">normalizeplot</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span><span class="p">:</span>

            <span class="n">offset_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jmin_crop</span>
            <span class="n">offset_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imin_crop</span>

            <span class="k">def</span> <span class="nf">tick_indexx</span><span class="p">(</span><span class="n">indexx</span><span class="p">,</span> <span class="vm">__dict__</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;return integer from index</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">indexx</span> <span class="o">+</span> <span class="n">offset_x</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">tick_indexy</span><span class="p">(</span><span class="n">indexy</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;return integer from index</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">indexy</span> <span class="o">+</span> <span class="n">offset_y</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">tick_indexx</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">tick_indexy</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">cropdata_array_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">centeri</span><span class="p">,</span> <span class="n">centerj</span><span class="p">,</span> <span class="n">boxi</span><span class="p">,</span> <span class="n">boxj</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;centeri, centerj&quot;</span><span class="p">,</span> <span class="n">centeri</span><span class="p">,</span> <span class="n">centerj</span><span class="p">)</span>

        <span class="p">(</span><span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">,</span> <span class="n">jmax</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">centeri</span> <span class="o">-</span> <span class="n">boxi</span><span class="p">,</span> <span class="n">centeri</span> <span class="o">+</span> <span class="n">boxi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">centerj</span> <span class="o">-</span> <span class="n">boxj</span><span class="p">,</span> <span class="n">centerj</span> <span class="o">+</span> <span class="n">boxj</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># avoid to wrong indices when slicing the data</span>
        <span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">,</span> <span class="n">jmax</span> <span class="o">=</span> <span class="n">ImProc</span><span class="o">.</span><span class="n">check_array_indices</span><span class="p">(</span><span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">,</span> <span class="n">jmax</span><span class="p">,</span>
                                                                            <span class="n">framedim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">framedim</span><span class="p">)</span>

        <span class="c1">#         print &quot;imin, imax, jmin, jmax&quot;, imin, imax, jmin, jmax</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">imin_crop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imax_crop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jmin_crop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jmax_crop</span> <span class="o">=</span> <span class="p">(</span><span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">,</span> <span class="n">jmax</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">[</span><span class="n">imin</span><span class="p">:</span><span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">:</span><span class="n">jmax</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">cropdata_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">centerx</span><span class="p">,</span> <span class="n">centery</span><span class="p">,</span> <span class="n">boxx</span><span class="p">,</span> <span class="n">boxy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cropdata_array_center</span><span class="p">(</span><span class="n">centery</span><span class="p">,</span> <span class="n">centerx</span><span class="p">,</span> <span class="n">boxy</span><span class="p">,</span> <span class="n">boxx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnReplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>  <span class="c1"># due to a background correction</span>
        <span class="c1"># Create a gaussian bkg and substract the data according to it -------------------</span>
        <span class="c1">#        if self.viewingLUTpanel.SubBKG.GetValue():</span>
        <span class="c1">#            # update self.dataimage_ROI_display</span>
        <span class="c1">#            self.remove_bkg_on_datatodisplay()</span>
        <span class="c1"># ---------------------------------------------------------------------------------</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updatePlotTitle</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addPeaksMarker</span><span class="p">()</span>

        <span class="c1">#        self._replot()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_draw</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

<div class="viewcode-block" id="MainPeakSearchFrame.buildMosaic"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.buildMosaic">[docs]</a>    <span class="k">def</span> <span class="nf">buildMosaic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; launch MOS.buildMosaic3() with GUI inputs as arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.Monitor</span>

        <span class="n">dirname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">]</span>
        <span class="c1"># filename = self.initialParameter[&quot;imagefilename&quot;]</span>

        <span class="c1"># filepathname = os.path.join(dirname, filename)</span>

        <span class="c1"># use images indices from start final and step fields</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">generalindexradiobtn</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>

            <span class="n">startind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">startindexctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="n">endind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">lastindexctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="n">stepind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">stepimageindexctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="c1">#        endind = 9</span>

            <span class="n">nbimages_per_line</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">stepctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

            <span class="n">nbimages_asked</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">startind</span><span class="p">,</span> <span class="n">endind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stepind</span><span class="p">)))</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;in PEAKSEARCHGUI.py------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nbimages_asked&quot;</span><span class="p">,</span> <span class="n">nbimages_asked</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nbimages_per_line&quot;</span><span class="p">,</span> <span class="n">nbimages_per_line</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nbimages_asked&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">nbimages_asked</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nbimages_per_line&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">nbimages_per_line</span><span class="p">))</span>

            <span class="c1"># reminder of integer division of nbimages_asked by nbimages_per_line</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">nbimages_asked</span> <span class="o">%</span> <span class="n">nbimages_per_line</span>
            <span class="k">if</span> <span class="n">rr</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;reminder != 0&quot;</span><span class="p">)</span>
                <span class="n">nb_lines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbimages_asked</span> <span class="o">//</span> <span class="n">nbimages_per_line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;reminder == 0&quot;</span><span class="p">)</span>
                <span class="n">nb_lines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbimages_asked</span> <span class="o">/</span> <span class="n">nbimages_per_line</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nb_lines&quot;</span><span class="p">,</span> <span class="n">nb_lines</span><span class="p">)</span>

            <span class="n">selected2Darray_imageindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">startind</span><span class="p">,</span> <span class="n">startind</span> <span class="o">+</span> <span class="n">nb_lines</span> <span class="o">*</span> <span class="n">nbimages_per_line</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;len(selected2Darray_imageindex)&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected2Darray_imageindex</span><span class="p">))</span>

            <span class="n">selected2Darray_imageindex</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">nb_lines</span><span class="p">,</span> <span class="n">nbimages_per_line</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;selected2Darray_imageindex&quot;</span><span class="p">,</span> <span class="n">selected2Darray_imageindex</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># rectangular 2D slice image index selection</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">rectangleindexradiobtn</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>

                <span class="n">centerimageindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">centerindexctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="n">imageindexboxX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">txtimagefastindexboxctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="n">imageindexboxY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">txtimageslowindexboxctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">predefinedROIradiobtn</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using predefined ROI&quot;</span><span class="p">)</span>
                <span class="n">key_ROI</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">comboROI</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="n">ROI_extent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">dict_ROI</span><span class="p">[</span><span class="n">key_ROI</span><span class="p">]</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ROI_extent&quot;</span><span class="p">,</span> <span class="n">ROI_extent</span><span class="p">)</span>

                <span class="n">centerimageindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ROI_extent</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">imageindexboxX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ROI_extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.75</span><span class="p">)</span>
                <span class="n">imageindexboxY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ROI_extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.75</span><span class="p">)</span>

            <span class="c1"># in all images map data set (from mesh scan in SPEC for instance nb of points + 1 with fast motor)</span>
            <span class="n">nbimages_per_line</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">stepctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

            <span class="n">mapstarting_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">mapstartingimageindexctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;in PEAKSEARCHGUI.py------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;centerimageindex&quot;</span><span class="p">,</span> <span class="n">centerimageindex</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;imageindexboxX&quot;</span><span class="p">,</span> <span class="n">imageindexboxX</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;imageindexboxY&quot;</span><span class="p">,</span> <span class="n">imageindexboxY</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mapstarting_index&quot;</span><span class="p">,</span> <span class="n">mapstarting_index</span><span class="p">)</span>

            <span class="n">nb_lines_max</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">centerimageindex</span> <span class="o">-</span> <span class="n">mapstarting_index</span><span class="p">)</span> <span class="o">//</span> <span class="n">nbimages_per_line</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">imageindexboxY</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">nbmaximages_asked</span> <span class="o">=</span> <span class="n">nb_lines_max</span> <span class="o">*</span> <span class="n">nbimages_per_line</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nbmaximages_asked&quot;</span><span class="p">,</span> <span class="n">nbmaximages_asked</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nb_lines_max&quot;</span><span class="p">,</span> <span class="n">nb_lines_max</span><span class="p">)</span>

            <span class="n">absoluteimageindexarray2D</span> <span class="o">=</span> <span class="p">(</span><span class="n">mapstarting_index</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nbmaximages_asked</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nb_lines_max</span><span class="p">,</span> <span class="n">nbimages_per_line</span><span class="p">))</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;absoluteimageindexarray2D&quot;</span><span class="p">,</span> <span class="n">absoluteimageindexarray2D</span><span class="p">)</span>

            <span class="c1">#             jcenter = (centerimageindex - mapstarting_index) % nbimages_per_line</span>
            <span class="c1">#             icenter = int((centerimageindex - mapstarting_index) / nbimages_per_line)</span>
            <span class="c1">#</span>
            <span class="c1">#             print &#39;icenter,jcenter&#39;, icenter, jcenter</span>
            <span class="c1">#             selected2Darray_imageindex = GT.extract_array((icenter, jcenter),</span>
            <span class="c1">#                                                         (imageindexboxY, imageindexboxX),</span>
            <span class="c1">#                                                         absoluteimageindexarray2D)</span>

            <span class="n">selected2Darray_imageindex</span> <span class="o">=</span> <span class="n">GT</span><span class="o">.</span><span class="n">extract2Dslice</span><span class="p">(</span><span class="n">centerimageindex</span><span class="p">,</span>
                                                        <span class="p">(</span><span class="n">imageindexboxY</span><span class="p">,</span> <span class="n">imageindexboxX</span><span class="p">),</span>
                                                        <span class="n">absoluteimageindexarray2D</span><span class="p">)</span>

            <span class="n">nb_lines</span><span class="p">,</span> <span class="n">nbimages_per_line</span> <span class="o">=</span> <span class="n">selected2Darray_imageindex</span><span class="o">.</span><span class="n">shape</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;selected2Darray_imageindex&quot;</span><span class="p">,</span> <span class="n">selected2Darray_imageindex</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nb_lines&quot;</span><span class="p">,</span> <span class="n">nb_lines</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">centerx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Click before on a point in image to select the center of the ROI&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">xpic</span><span class="p">,</span> <span class="n">ypic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>
        <span class="n">boxsize_col</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">boxxctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="n">boxsize_line</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">boxyctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;selected pixel position: xpic, ypic&quot;</span><span class="p">,</span> <span class="n">xpic</span><span class="p">,</span> <span class="n">ypic</span><span class="p">)</span>

        <span class="n">selectedcounters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">cselected</span>

        <span class="c1">#         param = (self.dirname, self.imagefilename, startind, endind, stepind,</span>
        <span class="c1">#                  nb_lines, nbimages_per_line,</span>
        <span class="c1">#                 xpic, ypic,</span>
        <span class="c1">#                 boxsize_col, boxsize_line,</span>
        <span class="c1">#                 selectedcounters)</span>
        <span class="c1">#         MOS.buildMosaic2(param, dirname,</span>
        <span class="c1">#                          ccdlabel=self.CCDlabel,</span>
        <span class="c1">#                          parent=parent)</span>

        <span class="c1"># continuous indices extract</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;len(selected2Darray_imageindex)&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected2Darray_imageindex</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;(nb_lines, nbimages_per_line)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">nb_lines</span><span class="p">,</span> <span class="n">nbimages_per_line</span><span class="p">))</span>
        <span class="c1"># 2D slice (rectangular)indices extract</span>
        <span class="c1">#         selected2Darray_imageindex = None</span>

        <span class="n">dict_param</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;imagesfolder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span>
        <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;filename_representative&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span>
        <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;CCDLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span>
        <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;nbdigits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbdigits</span>

        <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;selected2Darray_imageindex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected2Darray_imageindex</span>
        <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;pixelX_center&quot;</span><span class="p">],</span> <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;pixelY_center&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpic</span><span class="p">,</span> <span class="n">ypic</span>
        <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;pixelboxsize_X&quot;</span><span class="p">],</span> <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;pixelboxsize_Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">boxsize_col</span><span class="p">,</span> <span class="n">boxsize_line</span><span class="p">)</span>

        <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;selectedcounters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selectedcounters</span>

        <span class="c1"># normalization of data according to monitor value read in image header</span>
        <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;NormalizeWithMonitor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">normalizechck</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;NormalizeWithMonitor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;monitoroffset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">monitoroffsetctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="n">outputfolder</span> <span class="o">=</span> <span class="n">dirname</span>
        <span class="n">MOS</span><span class="o">.</span><span class="n">buildMosaic3</span><span class="p">(</span><span class="n">dict_param</span><span class="p">,</span> <span class="n">outputfolder</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">onOpenBImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FileDialog</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Choose an image&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span>
                                                                        <span class="n">defaultDir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">)</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FileDialog</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetMessage</span><span class="p">(</span><span class="s2">&quot;Choose an image as &#39;B&#39; array&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Bdirname</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BImageFilename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">onOpenBlackListFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">myFileDialog</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Choose a List of peaks not to be considered&quot;</span><span class="p">,</span>
                                    <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span>
                                    <span class="n">defaultDir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">)</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">myFileDialog</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetMessage</span><span class="p">(</span><span class="s2">&quot;Choose a List of peaks not to be considered&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>

            <span class="c1">#             self.dirnameBlackList = dlg.GetDirectory()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BlackListFilename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">ReadDetFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">myFileDialog</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                    <span class="s2">&quot;Choose a detector calibration File .det&quot;</span><span class="p">,</span>
                                    <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span>
                                    <span class="n">defaultDir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">,</span>
                                    <span class="n">wildcard</span><span class="o">=</span><span class="s2">&quot;det. calib. files(*.det)|*.det|All files(*)|*&quot;</span><span class="p">)</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">myFileDialog</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetMessage</span><span class="p">(</span><span class="s2">&quot;Choose a detector calibration File .det&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>

            <span class="c1">#             self.dirnameBlackList = dlg.GetDirectory()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DetFilename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CCDcalib</span> <span class="o">=</span> <span class="n">IOLT</span><span class="o">.</span><span class="n">readCalib_det_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># ---   Background correction</span>
    <span class="k">def</span> <span class="nf">OnUseFormula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;read B image&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">secondaryImage</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">secondaryImagefilename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">BImageFilename</span><span class="p">)</span>
        <span class="c1"># this where the formula is used</span>

        <span class="n">formulaexpression</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">formulatxtctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;use formula to calculate new image&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">formulaexpression</span><span class="p">)</span>

        <span class="n">SaturationLevel</span> <span class="o">=</span> <span class="n">DictLT</span><span class="o">.</span><span class="n">dict_CCD</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">newarray</span> <span class="o">=</span> <span class="n">ImProc</span><span class="o">.</span><span class="n">applyformula_on_images</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_B</span><span class="p">,</span>
                                                <span class="n">formulaexpression</span><span class="o">=</span><span class="n">formulaexpression</span><span class="p">,</span>
                                                <span class="n">SaturationLevel</span><span class="o">=</span><span class="n">SaturationLevel</span><span class="p">,</span>
                                                <span class="n">clipintensities</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OnUseFormula resulting histogram&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">newarray</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">newarray</span>

    <span class="k">def</span> <span class="nf">remove_bkg_on_datatodisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO: extend for other image file(only for mccd now) !!</span>
        <span class="c1"># for VHR</span>
        <span class="n">yc</span><span class="p">,</span> <span class="n">xc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">bkgcenter</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">cst</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">bkgconstant</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="n">amp_gauss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">bkgamplitude</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">framedim</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.framedim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">framedim</span><span class="p">)</span>

        <span class="n">Xin</span><span class="p">,</span> <span class="n">Yin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">dim1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">dim2</span><span class="p">]</span>
        <span class="n">cond_circle</span> <span class="o">=</span> <span class="p">(</span><span class="n">Xin</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">dim1</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Yin</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">dim2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="mi">1023</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">amp_gauss</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">data_gauss</span> <span class="o">=</span> <span class="n">fit2d</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">amp_gauss</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">xc</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">yc</span><span class="p">),</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">)(</span><span class="n">Xin</span><span class="p">,</span> <span class="n">Yin</span><span class="p">)</span> <span class="o">+</span> <span class="n">cst</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cond_circle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span> <span class="o">-</span> <span class="n">data_gauss</span><span class="p">,</span>
                                                                                <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data modified ...&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># only constant substraction</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cond_circle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span> <span class="o">-</span> <span class="n">cst</span><span class="p">,</span>
                                                                                <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">)</span>

<div class="viewcode-block" id="MainPeakSearchFrame.onMotion_ToolTip"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.onMotion_ToolTip">[docs]</a>    <span class="k">def</span> <span class="nf">onMotion_ToolTip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;tool tip to show data when mouse hovers on plot</span>
<span class="sd">        Some pixels at the image border could not be detected</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">collisionFound</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">dims</span><span class="p">,</span> <span class="n">dimf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1">#        print &quot;self.data_2D.shape onmotion&quot;, self.data_2D.shape</span>
        <span class="c1"># radius = 0.5</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># mouse is inside the axes</span>
            <span class="c1">#            for i in xrange(len(self.dataX)):</span>
            <span class="c1">#                radius = 1</span>
            <span class="c1">#                if abs(event.xdata - self.dataX[i]) &lt; radius and abs(event.ydata - self.dataY[i]) &lt; radius:</span>
            <span class="c1">#                    top = tip = &#39;x=%f\ny=%f&#39; % (event.xdata, event.ydata)</span>
            <span class="c1">#            for i in xrange(dims * dimf):</span>
            <span class="c1">#                X, Y = self.Xin[0, i % dimf], self.Yin[i % dimf, 0]</span>
            <span class="n">rx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">))</span>
            <span class="n">ry</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">rx</span> <span class="o">-</span> <span class="p">(</span><span class="n">dimf</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">dimf</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ry</span> <span class="o">-</span> <span class="p">(</span><span class="n">dims</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">dims</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
                <span class="c1">#                print X, Y</span>
                <span class="c1">#                print event.xdata, event.ydata</span>

                <span class="n">zvalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span><span class="p">[</span><span class="n">ry</span><span class="p">,</span> <span class="n">rx</span><span class="p">]</span>

                <span class="c1">#                tip = &#39;x=%f\ny=%f\nI=%.5f&#39; % (event.xdata, event.ydata, zvalue)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CropIsOn</span><span class="p">:</span>
                    <span class="c1">#                    tip = &#39;x=%d\ny=%d\nI=%.5f&#39; % (rx + self.centerx - self.boxx,</span>
                    <span class="c1">#                                                  ry + self.centery - self.boxy,</span>
                    <span class="c1">#                                                  zvalue)</span>

                    <span class="n">tip</span> <span class="o">=</span> <span class="s2">&quot;x=</span><span class="si">%d</span><span class="se">\n</span><span class="s2">y=</span><span class="si">%d</span><span class="se">\n</span><span class="s2">I=</span><span class="si">%.5f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">jmin_crop</span><span class="p">,</span> <span class="n">ry</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">imin_crop</span><span class="p">,</span> <span class="n">zvalue</span><span class="p">)</span>
                    <span class="n">xabs</span><span class="p">,</span> <span class="n">yabs</span> <span class="o">=</span> <span class="n">rx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">jmin_crop</span><span class="p">,</span> <span class="n">ry</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">imin_crop</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tip</span> <span class="o">=</span> <span class="s2">&quot;x=</span><span class="si">%d</span><span class="se">\n</span><span class="s2">y=</span><span class="si">%d</span><span class="se">\n</span><span class="s2">I=</span><span class="si">%.5f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">zvalue</span><span class="p">)</span>

                    <span class="n">xabs</span><span class="p">,</span> <span class="n">yabs</span> <span class="o">=</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">show2thetachi</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CCDcalib</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                        <span class="c1">#                         print &quot;self.CCDcalib[&#39;CCDCalibParameters&#39;]&quot;, self.CCDcalib[&#39;CCDCalibParameters&#39;]</span>

                        <span class="n">tth</span><span class="p">,</span> <span class="n">chi</span> <span class="o">=</span> <span class="n">F2TC</span><span class="o">.</span><span class="n">calc_uflab</span><span class="p">([</span><span class="n">xabs</span><span class="p">,</span> <span class="n">xabs</span><span class="p">],</span>
                                                    <span class="p">[</span><span class="n">yabs</span><span class="p">,</span> <span class="n">yabs</span><span class="p">],</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">CCDcalib</span><span class="p">[</span><span class="s2">&quot;CCDCalibParameters&quot;</span><span class="p">],</span>
                                                    <span class="n">returnAngles</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                    <span class="n">pixelsize</span><span class="o">=</span><span class="mf">165.0</span> <span class="o">/</span> <span class="mi">2048</span><span class="p">,</span>
                                                    <span class="n">kf_direction</span><span class="o">=</span><span class="s2">&quot;Z&gt;0&quot;</span><span class="p">)</span>
                        <span class="n">tip</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(2theta, chi)= </span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tth</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">chi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span><span class="o">.</span><span class="n">SetTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">collisionFound</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1">#            break</span>
                <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">collisionFound</span><span class="p">:</span>
            <span class="k">pass</span></div>
            <span class="c1"># if false, it will block others tooltip from buttons, statictext etc...</span>

    <span class="c1">#             self.tooltip.Enable(False)</span>

    <span class="c1"># ---  ----Image display WIDGETS</span>
    <span class="k">def</span> <span class="nf">OnChangeLUT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1">#         print &quot;OnChangeLUT&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myplot</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">comboLUT</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_draw</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">displayIMinMax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">Iminvaltxt</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IminDisplayed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">Imaxvaltxt</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">on_slider_IminDisplayed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IminDisplayed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">slider_vmin</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

        <span class="c1">#         self.viewingLUTpanel.vminctrl.SetValue(int(self.IminDisplayed))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IminDisplayed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IminDisplayed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">slider_vmin</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IminDisplayed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">displayIMinMax</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_draw</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnSpinCtrl_IminDisplayed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">IminDisplayed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">vminctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="n">ImaxDisplayed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">vmaxctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">IminDisplayed</span> <span class="o">&gt;=</span> <span class="n">ImaxDisplayed</span><span class="p">:</span>
            <span class="n">IminDisplayed</span> <span class="o">=</span> <span class="n">ImaxDisplayed</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">slider_vmin</span><span class="o">.</span><span class="n">SetMin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">IminDisplayed</span><span class="p">))</span>
        <span class="c1">#         self.viewingLUTpanel.slider_vmax.SetMin(int(IminDisplayed))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_draw</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_slider_ImaxDisplayed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">slider_vmax</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="c1">#         self.viewingLUTpanel.vmaxctrl.SetValue(int(self.ImaxDisplayed))</span>

        <span class="c1">#        print &quot;self.ImaxDisplayed&quot;, self.ImaxDisplayed</span>
        <span class="c1">#         self.viewingLUTpanel.slider_vmax.SetValue(self.ImaxDisplayed)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IminDisplayed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IminDisplayed</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">slider_vmax</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">displayIMinMax</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_draw</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

<div class="viewcode-block" id="MainPeakSearchFrame.OnSpinCtrl_ImaxDisplayed"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.OnSpinCtrl_ImaxDisplayed">[docs]</a>    <span class="k">def</span> <span class="nf">OnSpinCtrl_ImaxDisplayed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;on change Imax by spin control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#        print &quot;OnSpinCtrl_ImaxDisplayed !!!&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_data_display</span> <span class="o">==</span> <span class="s2">&quot;Raw Image&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnFlyMode</span><span class="p">:</span>
            <span class="n">IminDisplayed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">vminctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="n">ImaxDisplayed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">vmaxctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">IminDisplayed</span> <span class="o">&gt;=</span> <span class="n">ImaxDisplayed</span><span class="p">:</span>
                <span class="n">ImaxDisplayed</span> <span class="o">=</span> <span class="n">IminDisplayed</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">slider_vmax</span><span class="o">.</span><span class="n">SetMax</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ImaxDisplayed</span><span class="p">))</span>
        <span class="c1">#             self.viewingLUTpanel.slider_vmin.SetMax(int(ImaxDisplayed))</span>

        <span class="c1">#            print &quot;raw image ImaxDisplayed&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_data_display</span> <span class="o">==</span> <span class="s2">&quot;Convolved Image&quot;</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ImaxDisplayed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page3</span><span class="o">.</span><span class="n">vmaxctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="c1">#            print &quot;Convolved image ImaxDisplayed&quot;</span>

        <span class="c1">#        print &quot;self.ImaxDisplayed in OnSpinCtrl_ImaxDisplayed&quot;, self.ImaxDisplayed</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_draw</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.Get_XYI_from_fit2dpeaksfile"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.Get_XYI_from_fit2dpeaksfile">[docs]</a>    <span class="k">def</span> <span class="nf">Get_XYI_from_fit2dpeaksfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        useless ?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">F2TC</span><span class="o">.</span><span class="n">Compute_data2thetachi</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                                            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                            <span class="mi">1</span><span class="p">,</span>
                                            <span class="n">sorting_intensity</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span>
                                            <span class="n">param</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">defaultParam</span><span class="p">,</span>
                                            <span class="n">pixelsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">,</span>
                                            <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>  <span class="c1"># only for peaks coming from fit2d doing an y direction inversion</span>
                                        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">addPeaksMarker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># delete previous patches:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">largehollowcircles</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">return</span>

        <span class="c1"># plot some markers at each found blob or peak position</span>

        <span class="c1">#        print &quot;self.largehollowcircles&quot;, self.largehollowcircles</span>
        <span class="c1"># delete previous patches:</span>
        <span class="c1">#        if self.largehollowcircles != []:</span>
        <span class="c1">#            for pat in self.largehollowcircles:</span>
        <span class="c1">#                self.axes.patches.remove(pat)</span>
        <span class="c1">#            for pat in self.smallredcircles:</span>
        <span class="c1">#                self.axes.patches.remove(pat)</span>

        <span class="c1"># delete previous patches:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">largehollowcircles</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># rebuild circular markers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">largehollowcircles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smallredcircles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># correction only to fit peak position to the display</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_definition</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">offset_convention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">10</span><span class="p">,):</span>
                <span class="n">XYlist</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">offset_convention</span><span class="p">,)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">XYlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">offset_convention</span>

            <span class="k">for</span> <span class="n">po</span> <span class="ow">in</span> <span class="n">XYlist</span><span class="p">:</span>

                <span class="n">large_circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">po</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
                <span class="n">center_circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">po</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">large_circle</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">center_circle</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">largehollowcircles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">large_circle</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smallredcircles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center_circle</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_definition</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># print &quot;plotting fit2d peaksearch results&quot;</span>
            <span class="c1"># twicetheta, chi, dataintensity, data_x, data_y = Get_XYI_from_fit2dpeaksfile(self, filename)</span>
            <span class="c1"># this empirical crude correction is here only to fit with the display(TODO: why?)</span>
            <span class="c1"># XX = data_x -0.5 -1</span>
            <span class="c1"># YY = data_y -0.5</span>
            <span class="c1"># PointToPlot = np.transpose(np.array([XX,YY]))</span>
            <span class="n">PointToPlot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">PointToPlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">po</span> <span class="ow">in</span> <span class="n">PointToPlot</span><span class="p">:</span>

                <span class="n">large_circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">po</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
                <span class="n">center_circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">po</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">large_circle</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">center_circle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addPatchRectangleROI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rectboxproperties</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rectboxproperties&quot;</span><span class="p">,</span> <span class="n">rectboxproperties</span><span class="p">)</span>

        <span class="n">labelroiindex</span> <span class="o">=</span> <span class="n">rectboxproperties</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

        <span class="n">rect</span> <span class="o">=</span> <span class="n">PatchRectangle</span><span class="p">(</span><span class="n">rectboxproperties</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span>
                                <span class="n">rectboxproperties</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                <span class="o">-</span><span class="n">rectboxproperties</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                                <span class="n">picker</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                <span class="n">label</span><span class="o">=</span><span class="n">labelroiindex</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;adding labelroiindex&quot;</span><span class="p">,</span> <span class="n">labelroiindex</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ROIs</span><span class="p">[</span><span class="n">labelroiindex</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">rect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROIs</span><span class="p">[</span><span class="n">labelroiindex</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;visible&quot;</span>

    <span class="k">def</span> <span class="nf">RemoveLastRectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#            print &quot;deleted rectangle&quot;</span>

    <span class="k">def</span> <span class="nf">addPatchRectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="n">hsize</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">X</span> <span class="o">-</span> <span class="n">hsize</span><span class="p">,</span> <span class="n">Y</span> <span class="o">-</span> <span class="n">hsize</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">onOpenPeakListBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>

        <span class="n">PListsBoard</span> <span class="o">=</span> <span class="n">PeaksListBoard</span><span class="o">.</span><span class="n">PeaksListBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">PListsBoard</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ShowHisto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">mini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">)</span>
        <span class="n">maxi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">)</span>
        <span class="n">histo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">),</span> <span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span><span class="p">))</span>  <span class="c1"># N,bins</span>
        <span class="n">plothisto</span> <span class="o">=</span> <span class="n">HISTOPLOT</span><span class="o">.</span><span class="n">HistogramPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span> <span class="s2">&quot;Intensity&quot;</span><span class="p">,</span> <span class="n">histo</span><span class="p">,</span> <span class="n">logscale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">plothisto</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># --- cursor</span>
    <span class="k">def</span> <span class="nf">OnPaint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">erase_cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastInfo</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">mouse_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_cursor</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

<div class="viewcode-block" id="MainPeakSearchFrame.draw_cursor"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.draw_cursor">[docs]</a>    <span class="k">def</span> <span class="nf">draw_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;event is a MplEvent.  Draw a cursor over the axes&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">erase_cursor</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastInfo</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">return</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span>
        <span class="n">figheight</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span>
        <span class="c1">#         left, bottom, width, height = ax.bbox.get_bounds()</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="n">figheight</span> <span class="o">-</span> <span class="n">bottom</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">height</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">width</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">figheight</span> <span class="o">-</span> <span class="n">y</span>

        <span class="n">dc</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ClientDC</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">SetLogicalFunction</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">XOR</span><span class="p">)</span>
        <span class="n">wbrush</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Brush</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">wx</span><span class="o">.</span><span class="n">TRANSPARENT</span><span class="p">)</span>
        <span class="n">wpen</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">SOLID</span><span class="p">)</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">SetBrush</span><span class="p">(</span><span class="n">wbrush</span><span class="p">)</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">SetPen</span><span class="p">(</span><span class="n">wpen</span><span class="p">)</span>

        <span class="n">dc</span><span class="o">.</span><span class="n">ResetBoundingBox</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;darwin&quot;</span><span class="p">,):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">WXPYTHON4</span><span class="p">:</span>
                <span class="n">dc</span><span class="o">.</span><span class="n">BeginDrawing</span><span class="p">()</span>

            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">top</span><span class="p">)]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">erase_cursor</span><span class="p">()</span>
            <span class="n">line1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span>
            <span class="n">line2</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="c1"># warning there is a test if lastInfo is a self attribute.</span>
            <span class="c1"># So don&#39;t set self.lastInfo in __init__()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastInfo</span> <span class="o">=</span> <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">dc</span>
            <span class="n">dc</span><span class="o">.</span><span class="n">DrawLine</span><span class="p">(</span><span class="o">*</span><span class="n">line1</span><span class="p">)</span>  <span class="c1"># draw new</span>
            <span class="n">dc</span><span class="o">.</span><span class="n">DrawLine</span><span class="p">(</span><span class="o">*</span><span class="n">line2</span><span class="p">)</span>  <span class="c1"># draw new</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">WXPYTHON4</span><span class="p">:</span>
                <span class="n">dc</span><span class="o">.</span><span class="n">EndDrawing</span><span class="p">()</span>

        <span class="n">xabs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">))</span>
        <span class="n">yabs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span>

        <span class="n">textsb</span> <span class="o">=</span> <span class="s2">&quot;x=</span><span class="si">%d</span><span class="s2"> y=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xabs</span><span class="p">,</span> <span class="n">yabs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewingLUTpanel</span><span class="o">.</span><span class="n">show2thetachi</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CCDcalib</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tth</span><span class="p">,</span> <span class="n">chi</span> <span class="o">=</span> <span class="n">F2TC</span><span class="o">.</span><span class="n">calc_uflab</span><span class="p">([</span><span class="n">xabs</span><span class="p">,</span> <span class="n">xabs</span><span class="p">],</span>
                                            <span class="p">[</span><span class="n">yabs</span><span class="p">,</span> <span class="n">yabs</span><span class="p">],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">CCDcalib</span><span class="p">[</span><span class="s2">&quot;CCDCalibParameters&quot;</span><span class="p">],</span>
                                            <span class="n">returnAngles</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="n">pixelsize</span><span class="o">=</span><span class="mf">165.0</span> <span class="o">/</span> <span class="mi">2048</span><span class="p">,</span>
                                            <span class="n">kf_direction</span><span class="o">=</span><span class="s2">&quot;Z&gt;0&quot;</span><span class="p">)</span>

                <span class="n">textsb</span> <span class="o">+=</span> <span class="s2">&quot;   (2theta, chi)= </span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tth</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">chi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">SetStatusText</span><span class="p">(</span><span class="n">textsb</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">erase_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lastline1</span><span class="p">,</span> <span class="n">lastline2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">lastdc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastInfo</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lastdc</span><span class="o">.</span><span class="n">DrawLine</span><span class="p">(</span><span class="o">*</span><span class="n">lastline1</span><span class="p">)</span>  <span class="c1"># erase old</span>
            <span class="n">lastdc</span><span class="o">.</span><span class="n">DrawLine</span><span class="p">(</span><span class="o">*</span><span class="n">lastline2</span><span class="p">)</span>  <span class="c1"># erase old</span>

    <span class="c1"># --- ---   Convolved Data Functions</span>
    <span class="k">def</span> <span class="nf">ComputeConvolvedData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getConvolvedData</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">page3</span><span class="o">.</span><span class="n">showconvolvedImage_btn</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Show Image&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">page3</span><span class="o">.</span><span class="n">TogglebtnState</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Show_ConvolvedImage</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="MainPeakSearchFrame.getConvolvedData"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.getConvolvedData">[docs]</a>    <span class="k">def</span> <span class="nf">getConvolvedData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; convolve data according to check value of</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: add convolution parameters</span>
        <span class="c1">#        if self.viewingLUTpanel.UseImage.GetValue():</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">FilterImage</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="n">toconvolve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">toconvolve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span> <span class="o">=</span> <span class="n">ImProc</span><span class="o">.</span><span class="n">ConvolvebyKernel</span><span class="p">(</span><span class="n">toconvolve</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">ShowHisto_ConvolvedData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculate Convolved Data&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getConvolvedData</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Use already computed Convolved data&quot;</span><span class="p">)</span>

        <span class="n">mini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span><span class="p">)</span>
        <span class="n">maxi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span><span class="p">)</span>
        <span class="n">histo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ConvolvedData</span><span class="p">),</span> <span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span><span class="p">))</span>  <span class="c1"># N,bins</span>
        <span class="n">plothisto</span> <span class="o">=</span> <span class="n">HISTOPLOT</span><span class="o">.</span><span class="n">HistogramPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span> <span class="s2">&quot;Convolved Intensity&quot;</span><span class="p">,</span> <span class="n">histo</span><span class="p">,</span> <span class="n">logscale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">plothisto</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;histo&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histo</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histo</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">accum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">histo</span><span class="p">[</span><span class="mi">0</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">plotaccum_hotpixelfrequencies</span> <span class="o">=</span> <span class="n">PLOT1D</span><span class="o">.</span><span class="n">Plot1DFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                    <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span>
                                                    <span class="s2">&quot;Accumulated frequency from hottestIntensity&quot;</span><span class="p">,</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">histo</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">accum</span><span class="p">]),</span>
                                                    <span class="n">logscale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">plotaccum_hotpixelfrequencies</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnSaveFigure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>

        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="s2">&quot;Saving in png format. Choose a file&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">,</span>
                            <span class="s2">&quot;&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;*.*&quot;</span><span class="p">,</span>
                            <span class="n">wx</span><span class="o">.</span><span class="n">SAVE</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">OVERWRITE_PROMPT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="c1"># Open the file for write, write, close</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetFilename</span><span class="p">()</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># filename has a extension</span>
                <span class="n">Pre</span><span class="p">,</span> <span class="n">Ext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Ext</span> <span class="o">!=</span> <span class="s2">&quot;png&quot;</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">Pre</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

    <span class="c1"># ---  ----Peak Search and Fit</span>
<div class="viewcode-block" id="MainPeakSearchFrame.SavePeakList_PSPfile"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.SavePeakList_PSPfile">[docs]</a>    <span class="k">def</span> <span class="nf">SavePeakList_PSPfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save peak list and save .psp file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving list of peaks in SavePeakList_PSPfile()&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Peak list is empty !&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
        <span class="c1"># write file with peak search parameters in comments line</span>
        <span class="n">prefix</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">comments_in_file</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">finalfilename</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_LT_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_index_increment</span>

        <span class="c1">#         print &quot;self.dirname&quot;,self.dirname</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outputfolder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outputfolder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writefolder</span>

        <span class="c1">#         print &quot;self.writefolder&quot;,self.writefolder</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.peaklistPixels.shape&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nb_of_peaks</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nb_of_peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># writing ascii peak list and peaksearch parameters</span>
        <span class="n">RMCCD</span><span class="o">.</span><span class="n">writepeaklist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="p">,</span>
                                <span class="n">finalfilename</span><span class="p">,</span>
                                <span class="n">outputfolder</span><span class="o">=</span><span class="n">outputfolder</span><span class="p">,</span>
                                <span class="n">comments</span><span class="o">=</span><span class="n">comments_in_file</span><span class="p">,</span>
                                <span class="n">initialfilename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">))</span>

        <span class="n">pspfile_fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">,</span> <span class="s2">&quot;PeakSearch_</span><span class="si">%s</span><span class="s2">.psp&quot;</span> <span class="o">%</span> <span class="n">finalfilename</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">dictparam</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">)</span>
            <span class="n">dictparam</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span><span class="p">)</span>

            <span class="n">RMCCD</span><span class="o">.</span><span class="n">savePeakSearchConfigFile</span><span class="p">(</span><span class="n">dictparam</span><span class="p">,</span> <span class="n">outputfilename</span><span class="o">=</span><span class="n">pspfile_fullpath</span><span class="p">)</span>

            <span class="n">params_comments</span> <span class="o">=</span> <span class="s2">&quot;Peak Search and Fit parameters</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1"># usercomments = str(self.fitparampanel.peaksearchComments.GetValue())</span>
            <span class="n">usercomments</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">comments_in_file</span> <span class="o">=</span> <span class="n">params_comments</span> <span class="o">+</span> <span class="s2">&quot;# user comments: &quot;</span> <span class="o">+</span> <span class="n">usercomments</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> Peak(s) found.</span><span class="se">\n</span><span class="s2"> List written in </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">PeakSearch Parameters (.psp) file written in </span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">nb_of_peaks</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">outputfolder</span><span class="p">),</span> <span class="n">finalfilename</span> <span class="o">+</span> <span class="s2">&quot;.dat&quot;</span><span class="p">),</span>
                <span class="n">pspfile_fullpath</span><span class="p">),</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">peaks_filename</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_LT&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_index_increment</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.onSaveROIsList"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.onSaveROIsList">[docs]</a>    <span class="k">def</span> <span class="nf">onSaveROIsList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save rois list from current peaks list with boxsize of fitting procedure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Peak list is empty !&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving list of rois from peaks&quot;</span><span class="p">)</span>
        
        <span class="n">prefix</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">finalfilename</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_LT_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_index_increment</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outputfolder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outputfolder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writefolder</span>

        <span class="c1"># halfboxsize for all rois</span>
        <span class="n">boxsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">boxsize</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">boxsize</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nb_of_peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">boxsizearray</span> <span class="o">=</span> <span class="n">boxsize</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nb_of_peaks</span><span class="p">)</span>
            <span class="n">rois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">boxsizearray</span><span class="p">,</span> <span class="n">boxsizearray</span><span class="p">])</span>

        <span class="n">fullpathlistrois</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputfolder</span><span class="p">,</span> <span class="n">finalfilename</span> <span class="o">+</span> <span class="s1">&#39;.rois&#39;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fullpathlistrois</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">rois</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s1">&#39;List of ROIs from peaks saved in </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fullpathlistrois</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.onFitOnePeak"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.onFitOnePeak">[docs]</a>    <span class="k">def</span> <span class="nf">onFitOnePeak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fit one peak centered on where user has clicked</span>

<span class="sd">        in displayed image coordinates: self.centerx, self.centery</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#         self.boxsize_fit = 10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxsize_fit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">boxsize</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="c1"># boxx, boxy = self.boxsize_fit, self.boxsize_fit</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.framedim in onFitOnePeak&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">framedim</span><span class="p">)</span>
        <span class="c1">#        (min_value, max_value,</span>
        <span class="c1">#         min_position, max_position) = ImProc.getExtrema(self.dataimage_ROI,</span>
        <span class="c1">#                                                     [int(self.centerx), int(self.centery)],</span>
        <span class="c1">#                                                     self.boxsize_fit, (self.framedim[1], self.framedim[0]),</span>
        <span class="c1">#                                                     ROIcoords=0, flipxycenter=1)</span>
        <span class="c1">#        print &quot;min,max,posmin,posmax&quot;, (min_value, max_value,</span>
        <span class="c1">#                                        min_position, max_position)</span>

        <span class="c1"># patch switch: framedim</span>
        <span class="n">framedim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">framedim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">framedim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">min_position</span><span class="p">,</span> <span class="n">max_position</span><span class="p">)</span> <span class="o">=</span> <span class="n">ImProc</span><span class="o">.</span><span class="n">getExtrema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">,</span>
                                                                        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">),</span>
                                                                        <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centery</span><span class="p">)],</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">boxsize_fit</span><span class="p">,</span>
                                                                        <span class="n">framedim</span><span class="p">,</span>
                                                                        <span class="n">ROIcoords</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">flipxycenter</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;min,max,posmin,posmax&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">min_position</span><span class="p">,</span> <span class="n">max_position</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Highest intensity %.f at (X,Y): (</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">) &quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="n">max_position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">max_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Peak Amplitude estimate :&quot;</span><span class="p">,</span> <span class="n">max_value</span> <span class="o">-</span> <span class="n">min_value</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integrated Intensity&quot;</span><span class="p">,</span>
            <span class="n">ImProc</span><span class="o">.</span><span class="n">getIntegratedIntensity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">,</span>
                                            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centery</span><span class="p">)],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">boxsize_fit</span><span class="p">,</span>
                                            <span class="n">framedim</span><span class="p">,</span>
                                            <span class="n">thresholdlevel</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                            <span class="n">flipxycenter</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">guessed_amplitude</span> <span class="o">=</span> <span class="n">max_value</span> <span class="o">-</span> <span class="n">min_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guessed_bkg</span> <span class="o">=</span> <span class="n">min_value</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">fitfunc</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;NoFit&quot;</span><span class="p">,):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_peakfit_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">),</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centery</span><span class="p">),</span>
                                                    <span class="n">max_value</span><span class="p">,</span>
                                                    <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                                                    <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                                                    <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                                                    <span class="mf">0.0</span><span class="p">,</span>
                                                    <span class="mf">0.0</span><span class="p">,</span>
                                                    <span class="n">min_value</span><span class="p">,</span>
                                                    <span class="n">max_value</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OnFit</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;got peak with properties:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_peakfit_result</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_peakfit_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#             print &quot;last single peak fit results&quot;, self.last_peakfit_result</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allways_addpeak_chck</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">onAddPeaktoPeaklist</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.OnFit"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.OnFit">[docs]</a>    <span class="k">def</span> <span class="nf">OnFit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fit image array in a ROI with a 2D gaussian shape</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">POSITION_DEFINITION</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">position_definition</span> <span class="o">=</span> <span class="n">POSITION_DEFINITION</span>

        <span class="n">center_pixel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>

        <span class="n">peaklist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">center_pixel</span><span class="p">,</span> <span class="n">center_pixel</span><span class="p">])</span>
        <span class="n">boxsize</span> <span class="o">=</span> <span class="n">xboxsize</span><span class="p">,</span> <span class="n">yboxsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boxsize_fit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boxsize_fit</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">)</span>
        <span class="c1">#         print &quot;dirname&quot;, self.dirname</span>
        <span class="n">CCDLabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span>

        <span class="c1"># use image resulting form formula e.g. : A =  A-B</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">usealsoforfit</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="n">use_data_corrected</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI_display</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">framedim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fliprot</span><span class="p">)</span>
            <span class="n">reject_negative_baseline</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">use_data_corrected</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">reject_negative_baseline</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">guessed_peaksize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">peaksizectrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="n">FitPixelDev</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">FitPixelDev</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="n">tabIsorted</span><span class="p">,</span> <span class="n">params_res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">RMCCD</span><span class="o">.</span><span class="n">fitoneimage_manypeaks</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                                            <span class="n">peaklist</span><span class="p">,</span>
                                            <span class="n">boxsize</span><span class="p">,</span>
                                            <span class="n">CCDLabel</span><span class="o">=</span><span class="n">CCDLabel</span><span class="p">,</span>
                                            <span class="n">dirname</span><span class="o">=</span><span class="n">dirname</span><span class="p">,</span>
                                            <span class="n">position_start</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
                                            <span class="n">type_of_function</span><span class="o">=</span><span class="s2">&quot;gaussian&quot;</span><span class="p">,</span>
                                            <span class="n">guessed_peaksize</span><span class="o">=</span><span class="p">(</span><span class="n">guessed_peaksize</span><span class="p">,</span> <span class="n">guessed_peaksize</span><span class="p">),</span>
                                            <span class="n">xtol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>  <span class="c1"># accept all</span>
                                            <span class="n">FitPixelDev</span><span class="o">=</span><span class="n">FitPixelDev</span><span class="p">,</span>  <span class="c1"># accept all pixel deviation</span>
                                            <span class="n">Ipixmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                            <span class="n">position_definition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">position_definition</span><span class="p">,</span>
                                            <span class="n">use_data_corrected</span><span class="o">=</span><span class="n">use_data_corrected</span><span class="p">,</span>
                                            <span class="n">reject_negative_baseline</span><span class="o">=</span><span class="n">reject_negative_baseline</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tabIsorted&quot;</span><span class="p">,</span> <span class="n">tabIsorted</span><span class="p">)</span>
        <span class="c1">#        print &quot;params_res&quot;, params_res</span>

        <span class="k">if</span> <span class="n">tabIsorted</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Sorry. There is not peak around the region you cliked on...&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># peak_X, peak_Y,peak_I, peak_fwaxmaj, peak_fwaxmin,peak_inclination, Xdev, Ydev, peak_bkg, Ipixmax</span>
        <span class="n">datapeak</span> <span class="o">=</span> <span class="n">tabIsorted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">params_res</span> <span class="o">=</span> <span class="n">params_res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="p">(</span><span class="n">peak_X</span><span class="p">,</span> <span class="n">peak_Y</span><span class="p">,</span> <span class="n">peak_I</span><span class="p">,</span> <span class="n">peak_fwaxmaj</span><span class="p">,</span> <span class="n">peak_fwaxmin</span><span class="p">,</span>
            <span class="n">peak_inclination</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">peak_bkg</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">datapeak</span>

        <span class="n">fitresults</span> <span class="o">=</span> <span class="p">[</span><span class="n">peak_bkg</span><span class="p">,</span> <span class="n">peak_I</span><span class="p">,</span> <span class="n">peak_X</span><span class="p">,</span> <span class="n">peak_Y</span><span class="p">,</span> <span class="n">peak_fwaxmaj</span><span class="p">,</span> <span class="n">peak_fwaxmin</span><span class="p">,</span> <span class="n">peak_inclination</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fitresults&quot;</span><span class="p">,</span> <span class="n">fitresults</span><span class="p">)</span>

        <span class="c1"># parameter for function:</span>
        <span class="n">params_loc</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">params_res</span><span class="p">)</span>
        <span class="c1"># [start_baseline, start_amplitude, start_j, start_i,  start_sigma1, start_sigma2,   start_anglerot])</span>
        <span class="n">params_loc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_res</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">yboxsize</span> <span class="o">-</span> <span class="n">center_pixel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">params_loc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">xboxsize</span> <span class="o">-</span> <span class="n">center_pixel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1">#        if position_definition == 1:</span>
        <span class="c1">#            params_loc[3] -= 1.</span>
        <span class="c1">#            params_loc[2] -= 1.</span>

        <span class="c1">#        print &quot;center_pixel&quot;, center_pixel</span>
        <span class="c1">#        print &quot;params_res&quot;, params_res</span>
        <span class="c1">#        print &quot;params_loc&quot;, params_loc</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_singlefitresults_chck</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>  <span class="c1"># showplot:</span>
            <span class="n">framedim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">framedim</span>
            <span class="c1"># patch ------------------------------------</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;VHR_PSI&quot;</span><span class="p">,</span> <span class="s2">&quot;EIGER_4M&quot;</span><span class="p">):</span>
                <span class="n">framedim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">framedim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">framedim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># ----------------------------</span>
            <span class="c1"># crop data for local fit</span>
            <span class="n">indicesborders</span> <span class="o">=</span> <span class="n">RMCCD</span><span class="o">.</span><span class="n">getindices2cropArray</span><span class="p">(</span><span class="n">center_pixel</span><span class="p">,</span> <span class="p">[</span><span class="n">xboxsize</span><span class="p">,</span> <span class="n">yboxsize</span><span class="p">],</span>
                                                                        <span class="n">framedim</span><span class="p">,</span> <span class="n">flipxycenter</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">,</span> <span class="n">jmax</span> <span class="o">=</span> <span class="n">indicesborders</span>
            <span class="c1">#             print &#39;framedim&#39;, framedim</span>
            <span class="c1">#             print &quot;indicesborders&quot;, indicesborders</span>

            <span class="c1"># avoid to wrong indices when slicing the data</span>
            <span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">,</span> <span class="n">jmax</span> <span class="o">=</span> <span class="n">ImProc</span><span class="o">.</span><span class="n">check_array_indices</span><span class="p">(</span><span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">,</span> <span class="n">jmax</span><span class="p">,</span>
                                                                            <span class="n">framedim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">framedim</span><span class="p">)</span>

            <span class="c1">#             print &quot;imin, imax, jmin, jmax&quot;, imin, imax, jmin, jmax</span>
            <span class="c1">#</span>
            <span class="c1">#             print &quot;self.dataimage_ROI.shape&quot;, self.dataimage_ROI.shape</span>

            <span class="n">dat_ROIpeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataimage_ROI</span><span class="p">[</span><span class="n">imin</span><span class="p">:</span><span class="n">imax</span><span class="p">,</span> <span class="n">jmin</span><span class="p">:</span><span class="n">jmax</span><span class="p">]</span>

            <span class="c1">#            print &quot;max in dat_ROIpeak&quot;, np.amax(dat_ROIpeak)</span>

            <span class="n">fitfunc</span> <span class="o">=</span> <span class="n">fit2d</span><span class="o">.</span><span class="n">twodgaussian</span><span class="p">(</span><span class="n">params_loc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dat_ROIpeak</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;logscale&quot;</span><span class="p">)</span>

                <span class="n">ploplo</span> <span class="o">=</span> <span class="n">IMSHOW</span><span class="o">.</span><span class="n">ImshowFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                            <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span>
                                            <span class="n">dat_ROIpeak</span><span class="p">,</span>
                                            <span class="n">center</span><span class="o">=</span><span class="n">center_pixel</span><span class="p">,</span>
                                            <span class="n">boxsize</span><span class="o">=</span><span class="p">(</span><span class="n">xboxsize</span><span class="p">,</span> <span class="n">yboxsize</span><span class="p">),</span>
                                            <span class="n">fitfunc</span><span class="o">=</span><span class="n">fitfunc</span><span class="p">,</span>
                                            <span class="n">fitresults</span><span class="o">=</span><span class="n">fitresults</span><span class="p">,</span>
                                            <span class="n">cmap</span><span class="o">=</span><span class="n">GT</span><span class="o">.</span><span class="n">GIST_EARTH_R</span><span class="p">,</span>
                                            <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span>
                                            <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span>
                                            <span class="n">logscale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">ploplo</span> <span class="o">=</span> <span class="n">IMSHOW</span><span class="o">.</span><span class="n">ImshowFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                            <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">,</span>
                                            <span class="n">dat_ROIpeak</span><span class="p">,</span>
                                            <span class="n">center</span><span class="o">=</span><span class="n">center_pixel</span><span class="p">,</span>
                                            <span class="n">boxsize</span><span class="o">=</span><span class="p">(</span><span class="n">xboxsize</span><span class="p">,</span> <span class="n">yboxsize</span><span class="p">),</span>
                                            <span class="n">fitfunc</span><span class="o">=</span><span class="n">fitfunc</span><span class="p">,</span>
                                            <span class="n">fitresults</span><span class="o">=</span><span class="n">fitresults</span><span class="p">,</span>
                                            <span class="n">cmap</span><span class="o">=</span><span class="n">GT</span><span class="o">.</span><span class="n">GIST_EARTH_R</span><span class="p">,</span>
                                            <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span>
                                            <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span>
                                            <span class="n">logscale</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">ploplo</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># imsave(&quot;testimage&quot;,log(dat),format=&#39;png&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_peakfit_result</span> <span class="o">=</span> <span class="n">datapeak</span>

        <span class="k">return</span> <span class="n">datapeak</span></div>

    <span class="k">def</span> <span class="nf">onAddPeaktoPeaklist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">dist_tolerance</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1">#         print &quot;initial peaklist&quot;, self.peaklistPixels</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_peakfit_result</span>
            <span class="n">newpeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_peakfit_result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># all peaks</span>
            <span class="n">data_current_peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span>
            <span class="c1">#            print &quot;data_current_peaks.shape&quot;, data_current_peaks.shape</span>
            <span class="k">if</span> <span class="n">data_current_peaks</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">10</span><span class="p">,):</span>
                <span class="n">XYpeaklist</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_current_peaks</span><span class="p">[:</span><span class="mi">2</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">XYpeaklist</span> <span class="o">=</span> <span class="n">data_current_peaks</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>

            <span class="c1"># new fitted peak</span>
            <span class="n">XY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_peakfit_result</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1">#            print &quot;len(self.last_peakfit_result)&quot;, len(self.last_peakfit_result)</span>

            <span class="n">acceptPeak</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">posclose</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">GT</span><span class="o">.</span><span class="n">FindClosestPoint</span><span class="p">(</span><span class="n">XYpeaklist</span><span class="p">,</span> <span class="n">XY</span><span class="p">,</span> <span class="n">returndist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1">#            print &quot;dist&quot;, dist</span>
            <span class="c1">#            print &quot;posclose&quot;, posclose</span>
            <span class="k">if</span> <span class="n">dist</span><span class="p">[</span><span class="n">posclose</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dist_tolerance</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;peak at (</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">) has been updated&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

                <span class="c1"># peak already exists, reset to new input values</span>
                <span class="c1"># data_current_peaks[posclose] = np.zeros(11)  # to test</span>
                <span class="n">data_current_peaks</span><span class="p">[</span><span class="n">posclose</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_peakfit_result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># definitively a new peak to be added</span>
                <span class="n">newpeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_peakfit_result</span>

                <span class="n">acceptPeak</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">acceptPeak</span><span class="p">:</span>
                <span class="c1"># merge:</span>
                <span class="k">if</span> <span class="n">data_current_peaks</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">10</span><span class="p">,):</span>
                    <span class="n">data_current_peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="n">data_current_peaks</span><span class="p">],</span> <span class="p">[</span><span class="n">newpeak</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data_current_peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">data_current_peaks</span><span class="p">,</span> <span class="p">[</span><span class="n">newpeak</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1">#            print &#39;data_current_peaks&#39;, data_current_peaks</span>

            <span class="c1"># sort by third column = peak amplitude</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="o">=</span> <span class="n">data_current_peaks</span><span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">data_current_peaks</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

        <span class="c1">#         print &quot;data_current_peaks&quot;</span>
        <span class="c1">#         print self.peaklistPixels</span>

        <span class="c1"># update marker display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OnReplot</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># add object in OLV peak list</span>
        <span class="k">if</span> <span class="n">ObjectListView_Present</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;newpeak to be added&quot;</span><span class="p">,</span> <span class="n">newpeak</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;with </span><span class="si">%d</span><span class="s2"> elements&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">newpeak</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page4</span><span class="o">.</span><span class="n">AddOneSpot</span><span class="p">(</span><span class="n">newpeak</span><span class="p">)</span>

<div class="viewcode-block" id="MainPeakSearchFrame.onRemovePeaktoPeaklist"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.onRemovePeaktoPeaklist">[docs]</a>    <span class="k">def</span> <span class="nf">onRemovePeaktoPeaklist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">centerXY</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;remove picked peak from the current peaks list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Peak list is empty!&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">closestPeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getClosestPeak</span><span class="p">(</span><span class="n">centerXY</span><span class="o">=</span><span class="n">centerXY</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">closestPeak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">peakProperties</span><span class="p">,</span> <span class="n">index_close</span> <span class="o">=</span> <span class="n">closestPeak</span>
            <span class="n">peakXY</span> <span class="o">=</span> <span class="n">peakProperties</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">deleteOnePeak</span><span class="p">(</span><span class="n">index_close</span><span class="p">,</span> <span class="n">peakXY</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.onRemoveAllPeakstoPeaklist"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.onRemoveAllPeakstoPeaklist">[docs]</a>    <span class="k">def</span> <span class="nf">onRemoveAllPeakstoPeaklist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        remove all spots of the peaks list and update the plot (remove circular markers)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page4</span><span class="o">.</span><span class="n">OnRemoveAll</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.getClosestPeak"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.getClosestPeak">[docs]</a>    <span class="k">def</span> <span class="nf">getClosestPeak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">centerXY</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return peak in self.peaklistPixels</span>
<span class="sd">        that is close to the clicked pixel position or the given value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">TOLERANCE_DIST</span> <span class="o">=</span> <span class="mi">20</span>

        <span class="k">if</span> <span class="n">centerXY</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># where user have clicked</span>
            <span class="n">center_pixel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centery</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">center_pixel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">centerXY</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">centerXY</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1">#        print &quot;self.peaklistPixels&quot;, self.peaklistPixels</span>

        <span class="n">index_close</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">GT</span><span class="o">.</span><span class="n">FindClosestPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">center_pixel</span><span class="p">,</span>
                                                                                    <span class="n">returndist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#        print &quot;dist&quot;, dist</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">TOLERANCE_DIST</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;No Peak in PeakList found close to this pixel position within </span><span class="si">%d</span><span class="s2"> pixels&quot;</span>
                <span class="o">%</span> <span class="n">TOLERANCE_DIST</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">peakProperties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="p">[</span><span class="n">index_close</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">peakProperties</span><span class="p">,</span> <span class="n">index_close</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.deleteOnePeak"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.deleteOnePeak">[docs]</a>    <span class="k">def</span> <span class="nf">deleteOnePeak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_close</span><span class="p">,</span> <span class="n">peakXY</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        delete one peak and update display and lists</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deleting peak #:</span><span class="si">%d</span><span class="s2">  at (</span><span class="si">%.1f</span><span class="s2">,</span><span class="si">%.1f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index_close</span><span class="p">,</span> <span class="n">peakXY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">peakXY</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span><span class="p">,</span> <span class="n">index_close</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># update display</span>

        <span class="c1"># remove marker on image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OnReplot</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># delete object in OLV peak list</span>
        <span class="k">if</span> <span class="n">ObjectListView_Present</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page4</span><span class="o">.</span><span class="n">RemoveOneSpot</span><span class="p">(</span><span class="n">peakXY</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.deleteAllPeaks"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.deleteAllPeaks">[docs]</a>    <span class="k">def</span> <span class="nf">deleteAllPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        delete all peaks and update display and lists</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#         print &quot;Deleting peak #:%d  at (%.1f,%.1f)&quot; % (index_close, peakXY[0], peakXY[1])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># update display</span>

        <span class="c1"># remove marker on image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OnReplot</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># delete object in OLV peak list</span>
        <span class="k">if</span> <span class="n">ObjectListView_Present</span><span class="p">:</span>
            <span class="c1"># self.page4.RemoveOneSpot(peakXY) # ??</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page4</span><span class="o">.</span><span class="n">OnRemoveAll</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># ??</span></div>

<div class="viewcode-block" id="MainPeakSearchFrame.OnPeakSearch"><a class="viewcode-back" href="../../../PeakSearchGUI.html#LaueTools.GUI.PeakSearchGUI.MainPeakSearchFrame.OnPeakSearch">[docs]</a>    <span class="k">def</span> <span class="nf">OnPeakSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>  <span class="c1"># python &amp; Lauetools</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        launch peak search by calling methods in readmccd.py</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">NB_MAX_FITS</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">NbMaxFits</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="n">currentLocalMaximaMethod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">GetCurrentPage</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">currentLocalMaximaMethod</span><span class="o">.</span><span class="n">methodnumber</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Select one of the three tabs for the local Maxima Search Method&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">currentLocalMaximaMethod</span><span class="o">.</span><span class="n">methodnumber</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.method for finding local maxima &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>

        <span class="c1"># read fitting function selected by user</span>
        <span class="n">fitfunc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">fitfunc</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fitfunc for fitting &quot;</span><span class="p">,</span> <span class="n">fitfunc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fitfunc</span> <span class="o">==</span> <span class="s2">&quot;NoFit&quot;</span><span class="p">:</span>
            <span class="n">fit_peaks_gaussian</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">fitfunc</span> <span class="o">==</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">:</span>
            <span class="n">fit_peaks_gaussian</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">fitfunc</span> <span class="o">==</span> <span class="s2">&quot;Lorentzian&quot;</span><span class="p">:</span>
            <span class="n">fit_peaks_gaussian</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fit_peaks_gaussian&quot;</span><span class="p">,</span> <span class="n">fit_peaks_gaussian</span><span class="p">)</span>

        <span class="c1"># default offset to be compatible with XMAS convention of array reading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position_definition</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># build dict of common parameters --------------------------------------</span>
        <span class="n">list_param_key</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;IntensityThreshold&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;PixelNearRadius&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;boxsize&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;xtol&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;FitPixelDev&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;MaxIntensity&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;MinIntensity&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;MaxPeakSize&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;MinPeakSize&quot;</span><span class="p">]</span>

        <span class="n">list_param_val</span> <span class="o">=</span> <span class="p">[</span><span class="n">currentLocalMaximaMethod</span><span class="o">.</span><span class="n">IT</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(),</span>
                            <span class="n">currentLocalMaximaMethod</span><span class="o">.</span><span class="n">PNR</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">boxsize</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(),</span>
                            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">xtol</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()),</span>
                            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">FitPixelDev</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()),</span>
                            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">maxIctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()),</span>
                            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">minIctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()),</span>
                            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">peaksizemaxctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()),</span>
                            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">peaksizeminctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_param_key</span><span class="p">,</span> <span class="n">list_param_val</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="c1"># ----------------------------------------------------------------</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;self.dict_param&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">)</span>
        <span class="c1">#        print &quot;self.method&quot;</span>
        <span class="c1">#        print self.method</span>

        <span class="c1"># Local Maxima search + fit</span>

        <span class="n">imagefilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefilename</span><span class="p">)</span>

        <span class="n">reject_negative_baseline</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">Data_for_localMaxima</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">Fit_with_Data_for_localMaxima</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">formulaexpression</span> <span class="o">=</span> <span class="s2">&quot;A-B&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">UseImage</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="c1"># update raw data and use formula (convolution may be done later)</span>
            <span class="n">Data_for_localMaxima</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnUseFormula</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">reject_negative_baseline</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">formulaexpression</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">formulatxtctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">usealsoforfit</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Fit_with_Data_for_localMaxima = True&quot;</span><span class="p">)</span>
                <span class="n">Data_for_localMaxima</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BImageFilename</span>
                <span class="n">Fit_with_Data_for_localMaxima</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">FilterImage</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="c1"># use only filtered image for finding blobs (local maxima)</span>
            <span class="n">Data_for_localMaxima</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">filteredimage</span>
            <span class="c1">#             Data_for_localMaxima = &#39;auto_background&#39;</span>
            <span class="n">reject_negative_baseline</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">Remove_BlackListedPeaks_fromfile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">maxPixelDistanceRejection</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">RemoveBlackpeaks</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="c1">#             Remove_BlackListedPeaks_fromfile = os.path.join(self.dirnameBlackList,</span>
            <span class="c1">#                                                             self.BlackListFilename)</span>
            <span class="n">Remove_BlackListedPeaks_fromfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BlackListFilename</span>
            <span class="n">maxPixelDistanceRejection</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImageFilterpanel</span><span class="o">.</span><span class="n">BlackListRejection_pixeldistanceMax</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;maxPixelDistanceRejection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxPixelDistanceRejection</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># basic local maxima search (threshold on raw intensity)</span>
            <span class="n">ResPeakSearch</span> <span class="o">=</span> <span class="n">RMCCD</span><span class="o">.</span><span class="n">PeakSearch</span><span class="p">(</span><span class="n">imagefilename</span><span class="p">,</span>
                            <span class="n">stackimageindex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span><span class="p">,</span>
                            <span class="n">CCDLabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">,</span>
                            <span class="n">NumberMaxofFits</span><span class="o">=</span><span class="n">NB_MAX_FITS</span><span class="p">,</span>
                            <span class="n">PixelNearRadius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;PixelNearRadius&quot;</span><span class="p">],</span>
                            <span class="n">removeedge</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                            <span class="n">IntensityThreshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;IntensityThreshold&quot;</span><span class="p">],</span>
                            <span class="n">local_maxima_search_method</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="c1"># thresholdConvolve = 1000,</span>
                            <span class="n">boxsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;boxsize&quot;</span><span class="p">],</span>
                            <span class="n">position_definition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">position_definition</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">fit_peaks_gaussian</span><span class="o">=</span><span class="n">fit_peaks_gaussian</span><span class="p">,</span>
                            <span class="n">xtol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;xtol&quot;</span><span class="p">],</span>
                            <span class="n">FitPixelDev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;FitPixelDev&quot;</span><span class="p">],</span>
                            <span class="n">return_histo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">Saturation_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MaxIntensity&quot;</span><span class="p">],</span>
                            <span class="n">Saturation_value_flatpeak</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MaxIntensity&quot;</span><span class="p">],</span>
                            <span class="n">MinIntensity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MinIntensity&quot;</span><span class="p">],</span>
                            <span class="n">PeakSizeRange</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MinPeakSize&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MaxPeakSize&quot;</span><span class="p">]),</span>
                            <span class="n">write_execution_time</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">Data_for_localMaxima</span><span class="o">=</span><span class="n">Data_for_localMaxima</span><span class="p">,</span>
                            <span class="n">Fit_with_Data_for_localMaxima</span><span class="o">=</span><span class="n">Fit_with_Data_for_localMaxima</span><span class="p">,</span>
                            <span class="n">reject_negative_baseline</span><span class="o">=</span><span class="n">reject_negative_baseline</span><span class="p">,</span>
                            <span class="n">Remove_BlackListedPeaks_fromfile</span><span class="o">=</span><span class="n">Remove_BlackListedPeaks_fromfile</span><span class="p">,</span>
                            <span class="n">maxPixelDistanceRejection</span><span class="o">=</span><span class="n">maxPixelDistanceRejection</span><span class="p">,</span>
                            <span class="n">formulaexpression</span><span class="o">=</span><span class="n">formulaexpression</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span><span class="p">[</span><span class="s2">&quot;fit_peaks_gaussian&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_peaks_gaussian</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span><span class="p">[</span><span class="s2">&quot;local_maxima_search_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span><span class="p">[</span><span class="s2">&quot;position_definition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_definition</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># shifted array maxima search</span>
            <span class="n">ResPeakSearch</span> <span class="o">=</span> <span class="n">RMCCD</span><span class="o">.</span><span class="n">PeakSearch</span><span class="p">(</span><span class="n">imagefilename</span><span class="p">,</span>
                                    <span class="n">stackimageindex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span><span class="p">,</span>
                                    <span class="n">CCDLabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">,</span>
                                    <span class="n">NumberMaxofFits</span><span class="o">=</span><span class="n">NB_MAX_FITS</span><span class="p">,</span>
                                    <span class="n">PixelNearRadius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;PixelNearRadius&quot;</span><span class="p">],</span>
                                    <span class="n">removeedge</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                    <span class="n">IntensityThreshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;IntensityThreshold&quot;</span><span class="p">],</span>
                                    <span class="n">local_maxima_search_method</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">thresholdConvolve</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                    <span class="n">boxsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;boxsize&quot;</span><span class="p">],</span>
                                    <span class="n">position_definition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">position_definition</span><span class="p">,</span>
                                    <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">fit_peaks_gaussian</span><span class="o">=</span><span class="n">fit_peaks_gaussian</span><span class="p">,</span>
                                    <span class="n">xtol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;xtol&quot;</span><span class="p">],</span>
                                    <span class="n">FitPixelDev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;FitPixelDev&quot;</span><span class="p">],</span>
                                    <span class="n">return_histo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">Saturation_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MaxIntensity&quot;</span><span class="p">],</span>
                                    <span class="n">Saturation_value_flatpeak</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MaxIntensity&quot;</span><span class="p">],</span>
                                    <span class="n">MinIntensity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MinIntensity&quot;</span><span class="p">],</span>
                                    <span class="n">PeakSizeRange</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MinPeakSize&quot;</span><span class="p">],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MaxPeakSize&quot;</span><span class="p">]),</span>
                                    <span class="n">write_execution_time</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">Data_for_localMaxima</span><span class="o">=</span><span class="n">Data_for_localMaxima</span><span class="p">,</span>
                                    <span class="n">Fit_with_Data_for_localMaxima</span><span class="o">=</span><span class="n">Fit_with_Data_for_localMaxima</span><span class="p">,</span>
                                    <span class="n">reject_negative_baseline</span><span class="o">=</span><span class="n">reject_negative_baseline</span><span class="p">,</span>
                                    <span class="n">Remove_BlackListedPeaks_fromfile</span><span class="o">=</span><span class="n">Remove_BlackListedPeaks_fromfile</span><span class="p">,</span>
                                    <span class="n">maxPixelDistanceRejection</span><span class="o">=</span><span class="n">maxPixelDistanceRejection</span><span class="p">,</span>
                                    <span class="n">formulaexpression</span><span class="o">=</span><span class="n">formulaexpression</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span><span class="p">[</span><span class="s2">&quot;fit_peaks_gaussian&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_peaks_gaussian</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span><span class="p">[</span><span class="s2">&quot;local_maxima_search_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span><span class="p">[</span><span class="s2">&quot;position_definition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_definition</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># convolution for local maxima search</span>

            <span class="n">Thresconvolve</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page3</span><span class="o">.</span><span class="n">ThresholdConvolveCtrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitparampanel</span><span class="o">.</span><span class="n">keepCentroid</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                <span class="n">peakposition_definition</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">peakposition_definition</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span>

            <span class="n">ResPeakSearch</span> <span class="o">=</span> <span class="n">RMCCD</span><span class="o">.</span><span class="n">PeakSearch</span><span class="p">(</span><span class="n">imagefilename</span><span class="p">,</span>
                                        <span class="n">stackimageindex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stackimageindex</span><span class="p">,</span>
                                        <span class="n">CCDLabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CCDlabel</span><span class="p">,</span>
                                        <span class="n">NumberMaxofFits</span><span class="o">=</span><span class="n">NB_MAX_FITS</span><span class="p">,</span>
                                        <span class="n">PixelNearRadius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;PixelNearRadius&quot;</span><span class="p">],</span>
                                        <span class="n">removeedge</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">IntensityThreshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;IntensityThreshold&quot;</span><span class="p">],</span>
                                        <span class="n">local_maxima_search_method</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">peakposition_definition</span><span class="o">=</span><span class="n">peakposition_definition</span><span class="p">,</span>
                                        <span class="n">thresholdConvolve</span><span class="o">=</span><span class="n">Thresconvolve</span><span class="p">,</span>
                                        <span class="n">boxsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;boxsize&quot;</span><span class="p">],</span>
                                        <span class="n">paramsHat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">paramsHat</span><span class="p">,</span>
                                        <span class="n">position_definition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">position_definition</span><span class="p">,</span>
                                        <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                        <span class="n">fit_peaks_gaussian</span><span class="o">=</span><span class="n">fit_peaks_gaussian</span><span class="p">,</span>
                                        <span class="n">xtol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;xtol&quot;</span><span class="p">],</span>
                                        <span class="n">FitPixelDev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;FitPixelDev&quot;</span><span class="p">],</span>
                                        <span class="n">return_histo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                        <span class="n">Saturation_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MaxIntensity&quot;</span><span class="p">],</span>
                                        <span class="n">Saturation_value_flatpeak</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MaxIntensity&quot;</span><span class="p">],</span>
                                        <span class="n">MinIntensity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MinIntensity&quot;</span><span class="p">],</span>
                                        <span class="n">PeakSizeRange</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MinPeakSize&quot;</span><span class="p">],</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">dict_param</span><span class="p">[</span><span class="s2">&quot;MaxPeakSize&quot;</span><span class="p">]),</span>
                                        <span class="n">write_execution_time</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                        <span class="n">Data_for_localMaxima</span><span class="o">=</span><span class="n">Data_for_localMaxima</span><span class="p">,</span>
                                        <span class="n">Fit_with_Data_for_localMaxima</span><span class="o">=</span><span class="n">Fit_with_Data_for_localMaxima</span><span class="p">,</span>
                                        <span class="n">reject_negative_baseline</span><span class="o">=</span><span class="n">reject_negative_baseline</span><span class="p">,</span>
                                        <span class="n">Remove_BlackListedPeaks_fromfile</span><span class="o">=</span><span class="n">Remove_BlackListedPeaks_fromfile</span><span class="p">,</span>
                                        <span class="n">maxPixelDistanceRejection</span><span class="o">=</span><span class="n">maxPixelDistanceRejection</span><span class="p">,</span>
                                        <span class="n">formulaexpression</span><span class="o">=</span><span class="n">formulaexpression</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span><span class="p">[</span><span class="s2">&quot;fit_peaks_gaussian&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_peaks_gaussian</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span><span class="p">[</span><span class="s2">&quot;local_maxima_search_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span><span class="p">[</span><span class="s2">&quot;position_definition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_definition</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_param_LocalMaxima</span><span class="p">[</span><span class="s2">&quot;thresholdConvolve&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Thresconvolve</span>

        <span class="c1"># print(&quot;ResPeakSearch&quot;, ResPeakSearch)</span>
        <span class="k">if</span> <span class="n">ResPeakSearch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">Isorted</span> <span class="o">=</span> <span class="n">ResPeakSearch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">Isorted</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peaklistPixels</span> <span class="o">=</span> <span class="n">Isorted</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;No Peaks found !! </span><span class="se">\n</span><span class="s2">(some local maxima may have been rejected &quot;</span>
                                                                        <span class="s2">&quot;after fitting)&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;Too many or two less Peaks to fit !! </span><span class="se">\n</span><span class="s2">Try to change some thresholds</span><span class="se">\n</span><span class="s2"> &quot;</span>
                                                                <span class="s2">&quot;or Max. Nb of Fits&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># save peaklist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SavePeakList_PSPfile</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># plot data and markers at peaks position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OnReplot</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotPeaks</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<span class="k">def</span> <span class="nf">start_func</span><span class="p">():</span>
    <span class="n">dictParameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># MarCCD</span>
    <span class="n">dictParameters</span><span class="p">[</span><span class="s2">&quot;imagefilename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ge_blanc_0000.mccd&quot;</span>
    <span class="c1">#     initialParameter[&#39;dirname&#39;] = &#39;/home/micha/lauetools/trunk&#39;</span>
    <span class="n">dictParameters</span><span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LaueToolsProjectFolder</span>
    <span class="n">dictParameters</span><span class="p">[</span><span class="s2">&quot;mapsLUT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;OrRd&quot;</span>
    <span class="n">dictParameters</span><span class="p">[</span><span class="s2">&quot;CCDLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MARCCD165&quot;</span>
    <span class="n">dictParameters</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PeakSearch Board&quot;</span>
    <span class="n">dictParameters</span><span class="p">[</span><span class="s2">&quot;writefolder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>

    <span class="n">_PSGUIApp</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">()</span>
    <span class="n">_PSGUIframe</span> <span class="o">=</span> <span class="n">MainPeakSearchFrame</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dictParameters</span><span class="p">,</span> <span class="s2">&quot;MainPeakSearchFrame&quot;</span><span class="p">)</span>
    <span class="n">_PSGUIframe</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
    <span class="n">_PSGUIApp</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">initialParameter</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;writefolder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/home/micha/LaueTools&quot;</span>

    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;stackedimages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;stackimageindex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;Nbstackedimages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;test_peaksearchframe&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;imagefilename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CdTe_I999_03Jul06_0200.mccd&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;imagefilename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SS_0171.mccd&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/home/micha/lauetools/trunk&quot;</span>

    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;imagefilename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;He60keV_telque_mono_0007.mccd&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./Examples/UO2&quot;</span>

    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;mapsLUT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;OrRd&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;CCDLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MARCCD165&quot;</span>
    
    <span class="c1"># ---------------------</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;imagefilename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ag1_0135_mar.tiff&quot;</span>
    <span class="c1">#    initialParameter[&#39;imagefilename&#39;] = &#39;fake_0000_mar.tiff&#39;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/home/micha/LaueProjects/VHR_Ag&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;mapsLUT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;OrRd&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;CCDLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VHR_Feb13&quot;</span>

    <span class="c1"># ---------------------</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;imagefilename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;run1_0040_mar.tiff&quot;</span>
    <span class="c1">#    initialParameter[&#39;imagefilename&#39;] = &#39;fake_0000_mar.tiff&#39;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/home/micha/LaueProjects/OnChip&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;mapsLUT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;OrRd&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;CCDLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VHR_Feb13&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># MarCCD</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;imagefilename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ge_blanc_0000.mccd&quot;</span>
    <span class="c1">#     initialParameter[&#39;dirname&#39;] = &#39;/home/micha/lauetools/trunk&#39;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;mapsLUT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;OrRd&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;CCDLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MARCCD165&quot;</span>

    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/home/micha/LaueTools/Examples/GeGaN&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;imagefilename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;nanox2_400_0000.mccd&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;CCDLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MARCCD165&quot;</span>

    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/home/micha/LaueTools/MapSn&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;imagefilename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SnsurfscanBig_0180.mccd&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;CCDLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MARCCD165&quot;</span>

    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DictLT</span><span class="o">.</span><span class="n">LAUETOOLSFOLDER</span><span class="p">,</span> <span class="s2">&quot;LaueImages&quot;</span><span class="p">)</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;imagefilename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;AH12_CMT_r14_0200.tif&quot;</span>
    <span class="n">initialParameter</span><span class="p">[</span><span class="s2">&quot;CCDLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sCMOS&quot;</span>

    <span class="n">PSGUIApp</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">()</span>
    <span class="n">PSGUIframe</span> <span class="o">=</span> <span class="n">MainPeakSearchFrame</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">initialParameter</span><span class="p">,</span> <span class="s2">&quot;MainPeakSearchFrame&quot;</span><span class="p">)</span>
    <span class="n">PSGUIframe</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
    <span class="n">PSGUIApp</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, J.S. Micha, O. Robach., S. Tardif

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>